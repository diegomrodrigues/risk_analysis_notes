## Backtesting VAR: Avalia√ß√£o da Calibra√ß√£o Atrav√©s do N√∫mero de Exce√ß√µes

<img src="C:\Users\diego.rodrigues\Documents\Risk Analysis\01. Value at Risk Models\02. Backtesting VaR\02. Backtesting Fundamentals\_files\78f839847a6ffd3570ebd227053d58052ac4a2a5ae27bc93a1e3e997cfe4242a.jpg" alt="78f839847a6ffd3570ebd227053d58052ac4a2a5ae27bc93a1e3e997cfe4242a" style="zoom: 25%;" />

### Introdu√ß√£o

Dando continuidade √† nossa explora√ß√£o sobre o *backtesting* de modelos VAR, e como consolidado nos cap√≠tulos anteriores, este cap√≠tulo se concentrar√° na an√°lise do n√∫mero de exce√ß√µes como um indicador chave da calibra√ß√£o do modelo, abordando tanto a identifica√ß√£o de modelos que subestimam o risco quanto aqueles que s√£o excessivamente conservadores [^1]. Discutimos como o *backtesting* compara as previs√µes do modelo VAR com os retornos reais ou hipot√©ticos, e como as exce√ß√µes representam as viola√ß√µes das previs√µes [^2, ^3]. Agora, nos aprofundaremos em como interpretar o n√∫mero de exce√ß√µes em rela√ß√£o ao n√≠vel de confian√ßa do modelo e suas implica√ß√µes para a gest√£o de risco, construindo sobre os conceitos j√° apresentados de retornos reais, hipot√©ticos e *cleaned*, bem como a visualiza√ß√£o das exce√ß√µes em gr√°ficos.

### Conceitos Fundamentais
O conceito central do *backtesting* √© avaliar se o n√∫mero de exce√ß√µes, ou seja, as inst√¢ncias em que as perdas reais excedem o VAR previsto, est√° alinhado com o n√≠vel de confian√ßa do modelo VAR [^1]. Um modelo VAR com um n√≠vel de confian√ßa de 99% implica que, em m√©dia, as perdas devem exceder o VAR em aproximadamente 1% do tempo. Se o n√∫mero de exce√ß√µes observado em um per√≠odo de *backtesting* √© significativamente diferente desse valor esperado, isso sugere que o modelo n√£o est√° bem calibrado. Como visto anteriormente, a distribui√ß√£o do n√∫mero de exce√ß√µes, sob as hip√≥teses de um modelo bem especificado e retornos i.i.d., segue uma distribui√ß√£o binomial [Lema 1].

**A Rela√ß√£o entre Exce√ß√µes e Calibra√ß√£o do Modelo:**
Um n√∫mero excessivo de exce√ß√µes indica que o modelo VAR est√° subestimando o risco [^2]. Isso pode ser devido a premissas defeituosas, par√¢metros incorretos ou √† incapacidade do modelo de capturar certos riscos [^1]. Por outro lado, um n√∫mero muito baixo de exce√ß√µes sugere que o modelo VAR est√° sendo excessivamente conservador, o que pode levar a aloca√ß√µes ineficientes de capital [^2]. O ideal √© que o n√∫mero de exce√ß√µes esteja dentro de uma faixa aceit√°vel, compat√≠vel com o n√≠vel de confian√ßa do modelo, indicando um modelo bem calibrado [^2].

> üí° **A import√¢ncia do n√≠vel de confian√ßa:** O n√≠vel de confian√ßa do modelo VAR determina a frequ√™ncia esperada de exce√ß√µes. Um modelo VAR com n√≠vel de confian√ßa de 95%, por exemplo, dever√° ter exce√ß√µes em aproximadamente 5% dos dias de *backtesting*. A escolha do n√≠vel de confian√ßa deve ser feita com base nas necessidades e toler√¢ncia ao risco da institui√ß√£o financeira [^5].

**Lema 4.1:** *Se $p$ √© a probabilidade de exce√ß√£o (1 - n√≠vel de confian√ßa) e $T$ √© o n√∫mero de observa√ß√µes no per√≠odo de backtesting, ent√£o o n√∫mero esperado de exce√ß√µes $E[N]$ √© dado por $E[N] = pT$.*
*Proof:*
I. Seja $X_i$ uma vari√°vel aleat√≥ria de Bernoulli que assume o valor 1 se houver uma exce√ß√£o no dia $i$ e 0 caso contr√°rio.
II. A probabilidade de uma exce√ß√£o no dia $i$ √© dada por $P(X_i = 1) = p$, onde $p = 1 - c$ e $c$ √© o n√≠vel de confian√ßa do VAR.
III. Seja $N$ o n√∫mero total de exce√ß√µes em $T$ dias. Ent√£o $N = \sum_{i=1}^T X_i$.
IV. O valor esperado de $N$ √© a soma dos valores esperados de cada $X_i$: $E[N] = \sum_{i=1}^T E[X_i] = \sum_{i=1}^T p = pT$. ‚ñ†

> üí° **Exemplo Num√©rico:** Suponha que voc√™ esteja fazendo *backtesting* de um modelo VAR com um n√≠vel de confian√ßa de 99% (p = 0.01) para um per√≠odo de 250 dias (T = 250). O n√∫mero esperado de exce√ß√µes √© $E[N] = 0.01 \times 250 = 2.5$. Isso significa que, em m√©dia, espera-se que o modelo VAR seja violado 2.5 vezes nesse per√≠odo.

**Lema 4.2:** *A vari√¢ncia do n√∫mero de exce√ß√µes $Var[N]$ √© dada por $Var[N] = p(1-p)T$.*
*Proof:*
I. Dado que as vari√°veis indicadoras $X_i$ (do Lema 4.1) s√£o independentes, a vari√¢ncia da soma √© a soma das vari√¢ncias.
II. A vari√¢ncia de uma vari√°vel de Bernoulli $X_i$ √© $Var[X_i] = p(1-p)$.
III. Portanto, a vari√¢ncia do n√∫mero total de exce√ß√µes √© dada por $Var[N] = \sum_{i=1}^T Var[X_i] = \sum_{i=1}^T p(1-p) = p(1-p)T$. ‚ñ†

> üí° **Exemplo Num√©rico:** Usando o mesmo exemplo anterior, com p = 0.01 e T = 250, a vari√¢ncia do n√∫mero de exce√ß√µes √© $Var[N] = 0.01(1-0.01)250 = 2.475$. O desvio padr√£o do n√∫mero de exce√ß√µes √© $\sqrt{2.475} \approx 1.57$. Isso indica a dispers√£o esperada em torno do n√∫mero m√©dio de exce√ß√µes.

**Teorema 5:** *Sob a hip√≥tese nula de que o modelo VAR est√° bem calibrado, o n√∫mero de exce√ß√µes deve seguir uma distribui√ß√£o binomial com par√¢metros $T$ e $p$, $N \sim Binomial(T, p)$, onde $p$ √© a probabilidade de exce√ß√£o (1 - n√≠vel de confian√ßa) e $T$ o n√∫mero de observa√ß√µes.*

*Proof:*
I. Do Lema 4.1 e 4.2, temos que o n√∫mero esperado de exce√ß√µes √© $E[N]=pT$ e a vari√¢ncia √© $Var[N]=p(1-p)T$.
II. Se as exce√ß√µes ocorrem de forma independente, com probabilidade $p$ a cada dia, ent√£o a vari√°vel $N$ que descreve o n√∫mero total de exce√ß√µes segue uma distribui√ß√£o binomial $Binomial(T, p)$.
III. Portanto, sob a hip√≥tese nula de que o modelo VAR est√° bem calibrado, o n√∫mero de exce√ß√µes √© uma vari√°vel aleat√≥ria binomialmente distribu√≠da. ‚ñ†

**Teorema 5.1:** *Para amostras grandes, onde $T$ √© grande, a distribui√ß√£o binomial do n√∫mero de exce√ß√µes pode ser aproximada por uma distribui√ß√£o normal, $N \sim \mathcal{N}(pT, p(1-p)T)$.*

*Proof:*
I. Pelo Teorema Central do Limite, a soma de vari√°veis aleat√≥rias independentes de Bernoulli (que definem a distribui√ß√£o binomial) converge para uma distribui√ß√£o normal, quando o n√∫mero de amostras √© suficientemente grande.
II. Portanto, quando $T$ √© grande, podemos aproximar a distribui√ß√£o do n√∫mero de exce√ß√µes por uma distribui√ß√£o normal com m√©dia $pT$ e vari√¢ncia $p(1-p)T$.
III.  Esta aproxima√ß√£o normal facilita o c√°lculo de intervalos de confian√ßa e o uso de testes de hip√≥tese para amostras grandes. ‚ñ†

**Aproxima√ß√£o Normal e o Z-score:**
Para facilitar o teste de hip√≥tese, podemos utilizar a aproxima√ß√£o normal da distribui√ß√£o binomial para calcular o z-score. O z-score mede quantos desvios padr√µes o n√∫mero observado de exce√ß√µes est√° distante do valor esperado, sob a hip√≥tese de que o modelo esteja bem calibrado. O z-score √© dado por:

$$ z = \frac{N - pT}{\sqrt{p(1-p)T}} $$

onde:
*   $N$ √© o n√∫mero de exce√ß√µes observadas
*   $p$ √© a probabilidade de exce√ß√£o (1 - n√≠vel de confian√ßa)
*   $T$ √© o n√∫mero de observa√ß√µes
*  $pT$ √© o valor esperado de exce√ß√µes, $\mu$
*  $\sqrt{p(1-p)T}$ √© o desvio padr√£o de exce√ß√µes, $\sigma$.

Um valor de $|z| > 1.96$ (para um n√≠vel de signific√¢ncia de 5% em um teste bilateral) indica que o n√∫mero de exce√ß√µes observado √© estatisticamente diferente do esperado, levando √† rejei√ß√£o da hip√≥tese nula e concluindo que o modelo n√£o est√° bem calibrado [^6].

> üí° **Interpretando o z-score:** Um z-score positivo indica que o n√∫mero de exce√ß√µes √© maior do que o esperado, sugerindo que o modelo pode estar subestimando o risco. Um z-score negativo indica que o n√∫mero de exce√ß√µes √© menor do que o esperado, sugerindo que o modelo pode estar sendo excessivamente conservador.

**Proposi√ß√£o 4:** *A aproxima√ß√£o normal da distribui√ß√£o binomial, e o z-score associado, permite um teste de hip√≥tese simplificado para grandes amostras, oferecendo uma forma conveniente de verificar se o n√∫mero de exce√ß√µes √© consistente com a premissa de um modelo bem calibrado. Esta aproxima√ß√£o oferece um m√©todo eficiente e confi√°vel para validar a calibra√ß√£o do modelo VAR quando o tamanho da amostra √© grande.*

*Proof:*
I.  O Teorema 5.1 estabelece que, para amostras grandes, a distribui√ß√£o binomial pode ser aproximada por uma distribui√ß√£o normal.
II. O z-score padroniza a diferen√ßa entre o n√∫mero de exce√ß√µes observado e o esperado em termos de desvios padr√£o, o que permite usar uma distribui√ß√£o normal padr√£o para testar hip√≥teses.
III. Usando os valores cr√≠ticos da distribui√ß√£o normal padr√£o (como 1.96 para um teste bilateral com um n√≠vel de signific√¢ncia de 5%), podemos rejeitar ou n√£o a hip√≥tese nula de que o modelo VAR est√° bem calibrado.
IV. Portanto, a aproxima√ß√£o normal e o z-score fornecem uma ferramenta pr√°tica e estatisticamente v√°lida para verificar a calibra√ß√£o do modelo VAR em situa√ß√µes com grandes tamanhos de amostra. ‚ñ†

> üí° **Exemplo Num√©rico:** Vamos supor que um modelo VAR com n√≠vel de confian√ßa de 99% foi usado para o *backtesting* em um per√≠odo de 252 dias, e foram observadas 7 exce√ß√µes. A probabilidade de exce√ß√£o √© p = 0.01.
>
> *   O n√∫mero esperado de exce√ß√µes √© $E[N] = pT = 0.01 \times 252 = 2.52$.
> *   O desvio padr√£o do n√∫mero de exce√ß√µes √© $\sqrt{p(1-p)T} = \sqrt{0.01 \times 0.99 \times 252} \approx 1.58$.
> *   O z-score √© $z = \frac{7 - 2.52}{1.58} \approx 2.83$.
>
> Como o z-score (2.83) √© maior que 1.96, rejeitamos a hip√≥tese nula e conclu√≠mos que o modelo VAR n√£o est√° bem calibrado. Isso sugere que o modelo est√° subestimando o risco, dado que o n√∫mero de exce√ß√µes observado √© estatisticamente alto.

**Proposi√ß√£o 4.1** *Al√©m do teste do z-score, intervalos de confian√ßa podem ser constru√≠dos em torno do n√∫mero esperado de exce√ß√µes usando a aproxima√ß√£o normal, fornecendo um intervalo onde o n√∫mero observado de exce√ß√µes deve estar para que o modelo seja considerado bem calibrado.*

*Proof:*
I.  Como demonstrado no Teorema 5.1, a distribui√ß√£o do n√∫mero de exce√ß√µes pode ser aproximada por uma distribui√ß√£o normal com m√©dia $pT$ e desvio padr√£o $\sqrt{p(1-p)T}$.
II. Um intervalo de confian√ßa de $(1-\alpha)\%$ para o n√∫mero de exce√ß√µes, $N$, pode ser constru√≠do usando a aproxima√ß√£o normal como: $pT \pm z_{\alpha/2} \sqrt{p(1-p)T}$ onde $z_{\alpha/2}$ √© o valor cr√≠tico da distribui√ß√£o normal padr√£o para o n√≠vel de signific√¢ncia $\alpha$.
III. Se o n√∫mero observado de exce√ß√µes estiver dentro deste intervalo, a hip√≥tese nula de um modelo bem calibrado n√£o √© rejeitada.
IV. A constru√ß√£o de intervalos de confian√ßa fornece uma vis√£o complementar ao teste do z-score, permitindo avaliar se o n√∫mero de exce√ß√µes observado est√° dentro de uma faixa aceit√°vel, dado o n√≠vel de confian√ßa e o tamanho da amostra. ‚ñ†

**Exemplo Num√©rico:**
Vamos retomar o exemplo anterior, com $p=0.01$ e $T=252$. Para um n√≠vel de confian√ßa de 95% ($\alpha = 0.05$), o valor cr√≠tico $z_{\alpha/2} = 1.96$.
*   O n√∫mero esperado de exce√ß√µes √© $E[N] = pT = 0.01 \times 252 = 2.52$.
*   O desvio padr√£o do n√∫mero de exce√ß√µes √© $\sqrt{p(1-p)T} = \sqrt{0.01 \times 0.99 \times 252} \approx 1.58$.
*  O intervalo de confian√ßa de 95% √© dado por $2.52 \pm 1.96 \times 1.58 \approx 2.52 \pm 3.10$.
* O intervalo √© ent√£o aproximadamente [-0.58, 5.62]. Como o n√∫mero de exce√ß√µes n√£o pode ser negativo, o intervalo de confian√ßa efetivo √© [0, 5.62].

Se observarmos, por exemplo, 7 exce√ß√µes, vemos que este n√∫mero est√° fora do intervalo de confian√ßa, rejeitando a hip√≥tese nula de que o modelo esteja bem calibrado. Este resultado, como esperado, est√° de acordo com o resultado do teste do z-score do exemplo anterior. O intervalo de confian√ßa nos d√° uma faixa de valores aceit√°veis para o n√∫mero de exce√ß√µes, complementando a informa√ß√£o dada pelo z-score.

**Erro Tipo 1 e Tipo 2:**
Ao realizar um teste de hip√≥tese para avaliar a calibra√ß√£o do modelo, corremos o risco de cometer dois tipos de erro:
*   **Erro Tipo 1:** Rejeitar a hip√≥tese nula quando ela √© verdadeira (rejeitar um modelo VAR que est√° bem calibrado).
*   **Erro Tipo 2:** N√£o rejeitar a hip√≥tese nula quando ela √© falsa (aceitar um modelo VAR que n√£o est√° bem calibrado).

A escolha do n√≠vel de signific√¢ncia do teste de hip√≥tese afeta a probabilidade de cometer esses erros [^6]. Um n√≠vel de signific√¢ncia menor diminui a probabilidade de erro tipo 1, mas aumenta a probabilidade de erro tipo 2. Como foi discutido anteriormente, √© importante balancear esses dois tipos de erro para obter um teste poderoso e evitar decis√µes equivocadas. [^6]

> üí° **O tradeoff entre erros:**  A escolha de um n√≠vel de signific√¢ncia de 5% significa que estamos dispostos a correr um risco de 5% de rejeitar um modelo bem calibrado. Ao aumentar o n√≠vel de signific√¢ncia, diminu√≠mos o risco de rejeitar um modelo bem calibrado (erro tipo 1) mas aumentamos o risco de aceitar um modelo mal calibrado (erro tipo 2). Por exemplo, se aumentarmos o n√≠vel de signific√¢ncia para 10%, √© menos prov√°vel que rejeitemos um bom modelo, mas aumentamos a chance de aceitar um modelo ruim.

**A Import√¢ncia do Tamanho da Amostra:**
O tamanho da amostra utilizada no *backtesting* (n√∫mero de observa√ß√µes) tem um impacto significativo na precis√£o da avalia√ß√£o. Amostras maiores oferecem maior poder estat√≠stico para identificar modelos mal calibrados, como tamb√©m discutido em observa√ß√µes anteriores [^2].

> üí° **Impacto do tamanho da amostra:** Com um n√∫mero pequeno de observa√ß√µes, √© mais dif√≠cil detectar desvios na calibra√ß√£o do modelo, e o teste pode ser menos poderoso, tornando mais dif√≠cil discernir entre um modelo bom e um ruim, e aumentando a chance de cometer erros do tipo 2. Amostras maiores, como observado anteriormente, reduzem a chance de aceitar um modelo mal calibrado. Por exemplo, se tivermos um backtesting com apenas 50 dias de dados, um pequeno desvio do n√∫mero esperado de exce√ß√µes pode ser apenas ru√≠do, enquanto em um backtesting de 500 dias, esse mesmo desvio pode ser estatisticamente significativo.

**An√°lise da S√©rie Temporal das Exce√ß√µes:**
Al√©m de analisar o n√∫mero total de exce√ß√µes, √© importante analisar a s√©rie temporal das exce√ß√µes. A ocorr√™ncia de *clusters* de exce√ß√µes (ou seja, exce√ß√µes concentradas em um per√≠odo espec√≠fico) pode indicar que o modelo n√£o est√° capturando alguma forma de depend√™ncia temporal no risco, como o efeito de volatilidade agrupada. Como visto anteriormente, a an√°lise da autocorrela√ß√£o de $D_t = R_t - R^*_t$ pode revelar padr√µes sistem√°ticos que demandam investiga√ß√£o adicional.

> üí° **Depend√™ncia temporal:** A depend√™ncia temporal nas exce√ß√µes pode ser um sinal de que o modelo VAR est√° sendo afetado por algum fator que n√£o foi levado em considera√ß√£o, como modelos que ignoram a volatilidade condicional ou modelos com premissas incorretas sobre a distribui√ß√£o dos retornos, como observado em lemas anteriores. Se, por exemplo, as exce√ß√µes ocorrem consecutivamente por v√°rios dias, isso pode indicar que o modelo n√£o est√° capturando um regime de alta volatilidade.
**Lema 5.2:** *A autocorrela√ß√£o amostral das vari√°veis indicadoras de exce√ß√£o $X_i$ pode ser usada para identificar depend√™ncias temporais na ocorr√™ncia de exce√ß√µes.*

*Proof (Outline):*
I.  Definimos $X_i$ como uma vari√°vel de Bernoulli que indica a ocorr√™ncia de uma exce√ß√£o no dia $i$, onde $X_i=1$ se h√° uma exce√ß√£o e $X_i=0$ caso contr√°rio.
II. A autocorrela√ß√£o amostral da s√©rie $X_i$ no *lag* $k$ √© dada por $ \hat{\rho}_k = \frac{\sum_{t=1}^{T-k}(X_t - \bar{X})(X_{t+k} - \bar{X})}{\sum_{t=1}^T(X_t - \bar{X})^2}$, onde $\bar{X}$ √© a m√©dia amostral dos $X_i$.
III. Se as exce√ß√µes forem independentes ao longo do tempo, a autocorrela√ß√£o amostral deve ser pr√≥xima de zero para todos os *lags* $k>0$.
IV. Autocorrela√ß√µes amostrais significativamente diferentes de zero indicam depend√™ncia temporal na ocorr√™ncia de exce√ß√µes, podendo indicar um problema de m√° especifica√ß√£o do modelo VAR, como a n√£o considera√ß√£o da volatilidade condicional ou outros fatores que afetem a ocorr√™ncia de exce√ß√µes.‚ñ†

**Observa√ß√£o:** √â importante destacar que o uso da autocorrela√ß√£o amostral √© uma abordagem explorat√≥ria, e que o significado estat√≠stico das autocorrela√ß√µes deve ser avaliado com testes de hip√≥tese espec√≠ficos.

**A Cr√≠tica dos Testes Baseados em Exce√ß√µes:**
Embora os testes baseados no n√∫mero de exce√ß√µes sejam comuns e f√°ceis de implementar, eles possuem algumas limita√ß√µes, especialmente quando se trabalha com um n√≠vel de confian√ßa alto, que leva a um n√∫mero pequeno de exce√ß√µes, ou com amostras pequenas. Esses testes podem ter pouco poder para detectar desvios do modelo. Modelos com baixas taxas de exce√ß√µes podem apresentar riscos significativos em termos de magnitude das perdas, e estes podem passar despercebidos ao analisar apenas a quantidade de exce√ß√µes. Como observado anteriormente, √© importante analisar conjuntamente a frequ√™ncia e magnitude das exce√ß√µes [Proposi√ß√£o 3.1]. Tamb√©m √© crucial considerar que os testes estat√≠sticos s√£o v√°lidos apenas se as premissas dos testes s√£o satisfeitas, como a independ√™ncia e estacionariedade dos retornos, que nem sempre se aplicam na pr√°tica, como visto nos lemas anteriores.

**Teorema 5.2:** *A precis√£o dos testes de backtesting aumenta com o tamanho da amostra e a redu√ß√£o do n√≠vel de confian√ßa do VAR, pois ambos aumentam o n√∫mero de exce√ß√µes esperadas, o que aumenta o poder estat√≠stico para detectar modelos mal calibrados.*

*Proof:*
I. O poder de um teste estat√≠stico √© a probabilidade de rejeitar a hip√≥tese nula quando ela √© falsa.
II. Aumentar o tamanho da amostra aumenta a precis√£o do teste, pois temos mais informa√ß√£o sobre a distribui√ß√£o das exce√ß√µes, e diminui o erro padr√£o da amostra, diminuindo os intervalos de confian√ßa associados.
III. Reduzir o n√≠vel de confian√ßa do VAR (e consequentemente aumentar $p$) aumenta o n√∫mero esperado de exce√ß√µes, o que tamb√©m melhora a precis√£o, pois os testes estat√≠sticos s√£o mais poderosos quando h√° mais observa√ß√µes do evento sendo testado.
IV. Portanto, tanto o aumento do tamanho da amostra quanto a redu√ß√£o do n√≠vel de confian√ßa melhoram a capacidade do *backtesting* de identificar modelos mal calibrados. ‚ñ†

**Lema 5.1:** *O teste de Kupiec √© um teste estat√≠stico de raz√£o de verossimilhan√ßa, usado para testar se a frequ√™ncia de exce√ß√µes observada √© consistente com a frequ√™ncia esperada sob a hip√≥tese de um modelo VAR bem calibrado.*

*Proof (Outline)*:
I.  O teste de Kupiec se baseia na raz√£o de verossimilhan√ßa entre duas hip√≥teses: a hip√≥tese nula de que o modelo est√° bem calibrado (a probabilidade de exce√ß√£o √© $p$) e uma hip√≥tese alternativa de que a probabilidade de exce√ß√£o √© diferente, denotada por $\hat{p}=N/T$, a probabilidade de exce√ß√µes observada na amostra.
II.  A estat√≠stica do teste de Kupiec √© dada por: $LR = -2 \ln \left( \frac{p^N(1-p)^{T-N}}{\hat{p}^N(1-\hat{p})^{T-N}} \right)$, onde $N$ √© o n√∫mero de exce√ß√µes observadas, $T$ √© o n√∫mero de observa√ß√µes e $p$ √© a probabilidade de exce√ß√£o sob a hip√≥tese nula.
III.  Sob a hip√≥tese nula, a estat√≠stica do teste converge para uma distribui√ß√£o $\chi^2$ com um grau de liberdade.
IV. Portanto, o teste de Kupiec fornece um meio formal para avaliar se a frequ√™ncia de exce√ß√µes observada √© estatisticamente diferente da frequ√™ncia esperada sob um modelo bem calibrado, sendo uma alternativa aos testes do z-score ou aos intervalos de confian√ßa baseados na aproxima√ß√£o normal. ‚ñ†

**Observa√ß√£o:** O teste de Kupiec, embora seja uma alternativa ao teste do z-score, possui limita√ß√µes semelhantes, como a necessidade de um n√∫mero de amostras razo√°vel para uma boa acur√°cia. Ele tamb√©m n√£o leva em conta a ordem temporal das exce√ß√µes, sendo mais um teste sobre a frequ√™ncia das mesmas. O teste de Kupiec pode ser mais apropriado para amostras menores, onde a aproxima√ß√£o normal pode n√£o ser adequada, embora ele tamb√©m tenha poder de teste limitado para amostras pequenas. Por exemplo, se o n√∫mero esperado de exce√ß√µes √© menor que 5, a aproxima√ß√£o normal pode n√£o ser precisa, e o teste de Kupiec pode ser mais adequado.

**Teorema 5.3:** *A an√°lise do n√∫mero de exce√ß√µes deve ser complementada por testes que considerem a magnitude das exce√ß√µes, pois modelos podem apresentar um n√∫mero aceit√°vel de exce√ß√µes, mas com perdas muito elevadas, que n√£o s√£o capturadas por testes que se concentram apenas na frequ√™ncia.*

*Proof (Outline):*
I. Testes baseados no n√∫mero de exce√ß√µes, como os testes do z-score ou de Kupiec, apenas verificam a frequ√™ncia com que o VAR √© excedido, mas n√£o a magnitude dessas viola√ß√µes.
II. Modelos mal calibrados podem, por exemplo, apresentar poucas exce√ß√µes, mas com perdas muito elevadas quando as exce√ß√µes ocorrem, indicando um problema de subestima√ß√£o da cauda da distribui√ß√£o das perdas.
III. Portanto, √© essencial realizar testes complementares que considerem a magnitude das perdas que excedem o VAR, como testes que avaliam a distribui√ß√£o das exce√ß√µes, para identificar problemas na calibra√ß√£o do modelo que n√£o s√£o capturados apenas pela frequ√™ncia das exce√ß√µes.
IV. Analisar conjuntamente a frequ√™ncia e a magnitude das exce√ß√µes garante uma avalia√ß√£o mais abrangente do modelo VAR.‚ñ†

**Proposi√ß√£o 4.2:** *A an√°lise conjunta da s√©rie temporal de exce√ß√µes e de sua distribui√ß√£o emp√≠rica, complementa os testes baseados na frequ√™ncia das mesmas, permitindo identificar se o modelo subestima o risco em situa√ß√µes espec√≠ficas ou se possui alguma defici√™ncia de modelagem que gere padr√µes sistem√°ticos de exce√ß√µes.*

*Proof (Outline):*
I. A an√°lise da s√©rie temporal das exce√ß√µes, como mencionado anteriormente, permite identificar padr√µes como clusters de exce√ß√µes, que indicam uma poss√≠vel depend√™ncia temporal que o modelo n√£o captura.
II. A an√°lise da distribui√ß√£o emp√≠rica das exce√ß√µes (i.e., o valor das perdas quando o VAR √© excedido) revela informa√ß√µes sobre a severidade das exce√ß√µes, complementando o que foi abordado no Teorema 5.3.
III. Juntos, esses dois tipos de an√°lise fornecem uma vis√£o mais completa do desempenho do modelo VAR, permitindo identificar se o modelo subestima o risco em situa√ß√µes espec√≠ficas, apresenta padr√µes sistem√°ticos, ou se precisa de melhorias em seus par√¢metros ou estrutura.
IV. Desta forma, as informa√ß√µes obtidas combinando an√°lises de s√©ries temporais e da distribui√ß√£o emp√≠rica de exce√ß√µes auxiliam na identifica√ß√£o de modelos que n√£o est√£o bem calibrados e que podem apresentar riscos significativos para a institui√ß√£o financeira. ‚ñ†

**Teorema 5.4:** *A avalia√ß√£o do backtesting deve considerar n√£o apenas o n√∫mero total de exce√ß√µes, mas tamb√©m a distribui√ß√£o de seus valores, particularmente a severidade das maiores perdas. M√©tricas como Expected Shortfall (ES), tamb√©m conhecido como Conditional VAR (CVAR), podem ser utilizadas como m√©tricas complementares.*

*Proof (Outline):*
I. O n√∫mero total de exce√ß√µes e os testes associados se concentram na frequ√™ncia das viola√ß√µes do VAR, sem considerar a magnitude das perdas que excedem o limite.
II. Modelos que parecem bem calibrados com base apenas na frequ√™ncia das exce√ß√µes, podem apresentar um n√∫mero baixo de exce√ß√µes, mas com perdas extremamente elevadas quando o VAR √© excedido, o que implica em subestima√ß√£o do risco.
III. Metricas como o ES (ou CVAR), que medem a perda esperada dado que uma exce√ß√£o ocorreu, fornecem uma vis√£o mais completa do risco, permitindo avaliar a severidade das perdas na cauda da distribui√ß√£o e complementando a an√°lise baseada apenas na contagem de exce√ß√µes.
IV. Portanto, a utiliza√ß√£o de m√©tricas de risco como o ES junto √† contagem de exce√ß√µes melhora a capacidade de detec√ß√£o de modelos que subestimam o risco, oferecendo uma avalia√ß√£o mais completa e robusta da adequa√ß√£o do modelo VAR. ‚ñ†
> üí° **Exemplo Num√©rico:** Considere dois modelos VAR, ambos com 3 exce√ß√µes em um per√≠odo de 250 dias (n√≠vel de confian√ßa de 99%). O primeiro modelo tem exce√ß√µes de magnitudes -1.5%, -1.8%, e -2.0% enquanto o segundo tem exce√ß√µes de magnitudes -1.0%, -2.5% e -3.5%. Apesar de ambos terem o mesmo n√∫mero de exce√ß√µes, o segundo modelo tem uma severidade maior nas exce√ß√µes. Analisar apenas o n√∫mero de exce√ß√µes poderia nos levar a considerar que os dois modelos s√£o equivalentes, mas ao analisar as magnitudes, vemos que o segundo √© mais arriscado.

### Conclus√£o
Em suma, a an√°lise do n√∫mero de exce√ß√µes √© um passo crucial no *backtesting* de modelos VAR. A compara√ß√£o entre o n√∫mero observado de exce√ß√µes e o n√∫mero esperado, levando em considera√ß√£o o n√≠vel de confian√ßa do modelo e os testes estat√≠sticos apropriados, oferece uma vis√£o valiosa sobre a calibra√ß√£o do modelo. A decis√£o sobre a aceita√ß√£o ou rejei√ß√£o de um modelo deve ser feita com base em crit√©rios estat√≠sticos e bom senso, reconhecendo as limita√ß√µes dos testes e a import√¢ncia do contexto em que o modelo est√° sendo utilizado. Como visto anteriormente, √© crucial o entendimento das premissas dos testes, e que o processo de *backtesting* seja implementado de forma cont√≠nua, buscando sempre a melhoria na qualidade dos modelos. A an√°lise deve ser complementada pela visualiza√ß√£o das exce√ß√µes e pela considera√ß√£o da magnitude e frequ√™ncia dessas ocorr√™ncias, como tamb√©m discutido previamente. O correto uso e interpreta√ß√£o do n√∫mero de exce√ß√µes permite que as institui√ß√µes financeiras tomem decis√µes mais informadas e gerenciem seus riscos de forma mais eficaz.

### Refer√™ncias
[^1]: *This chapter turns to backtesting techniques for verifying the accuracy of VAR models. Backtesting is a formal statistical framework that consists of verifying that actual losses are in line with projected losses.*
[^2]: *When the model is perfectly calibrated, the number of observations falling outside VAR should be in line with the confidence level.*
[^3]: *Observations that lie above the diagonal line indicate days when the absolute value of the P&L exceeded the VAR.*
[^4]: *Sometimes an approximation is obtained by using a cleaned return, which is the actual return minus all non-mark-to-market items, such as fees, commissions, and net interest income.*
[^5]: *At the outset, it should be noted that this decision must be made at some confidence level.*
[^6]: *The issue is how to make this decision. This accept or reject decision is a classic statistical decision problem.*
<!-- END -->
