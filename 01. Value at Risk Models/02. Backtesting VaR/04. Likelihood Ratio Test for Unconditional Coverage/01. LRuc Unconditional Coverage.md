# Backtesting VAR: O Teste da Raz√£o de Verossimilhan√ßa para Cobertura Incondicional

## Introdu√ß√£o

Como discutido anteriormente, os modelos de Value-at-Risk (VAR) s√£o ferramentas cruciais para a gest√£o de riscos financeiros, mas sua utilidade depende da precis√£o com que predizem as perdas potenciais[^1]. A valida√ß√£o do modelo, que inclui o *backtesting*, √© essencial para garantir essa precis√£o[^1]. Este cap√≠tulo se aprofunda no *backtesting* de modelos VAR, especificamente no uso do teste da raz√£o de verossimilhan√ßa (Likelihood Ratio test) para verificar a cobertura incondicional. Este teste avalia se a taxa de falha observada em um modelo VAR √© consistente com a taxa de falha esperada, fornecendo uma avalia√ß√£o cr√≠tica da calibra√ß√£o do modelo.

## Conceitos Fundamentais

O *backtesting* de um modelo VAR envolve a compara√ß√£o sistem√°tica das previs√µes VAR hist√≥ricas com os retornos subsequentes do portf√≥lio[^1]. O objetivo √© verificar se as perdas reais est√£o alinhadas com as perdas projetadas. Um modelo bem calibrado deve ter um n√∫mero de *exce√ß√µes* (isto √©, ocorr√™ncias em que a perda real excede a previs√£o VAR) em linha com o n√≠vel de confian√ßa especificado[^2].

O teste da raz√£o de verossimilhan√ßa (LR) para cobertura incondicional, denotado como $\text{LR}_{\text{uc}}$, √© uma ferramenta estat√≠stica que formaliza esse processo[^9]. Este teste examina se a propor√ß√£o de vezes que o VAR √© excedido em uma amostra (a *taxa de falha*) √© estatisticamente consistente com a taxa de falha esperada, dada a confian√ßa do VAR[^5]. A hip√≥tese nula para este teste √© que o modelo VAR est√° corretamente calibrado.

Para entender o $\text{LR}_{\text{uc}}$, precisamos introduzir alguns conceitos-chave:

1. **Taxa de Falha (Failure Rate):** A taxa de falha √© a propor√ß√£o de vezes que as perdas reais excedem o VAR previsto em um per√≠odo de amostra. Se um modelo VAR √© especificado com 99% de confian√ßa, espera-se que as exce√ß√µes ocorram em aproximadamente 1% do tempo[^2]. Formalmente, a taxa de falha √© calculada como $N/T$, onde *N* √© o n√∫mero de exce√ß√µes observadas e *T* √© o n√∫mero total de observa√ß√µes.

2. **Hip√≥tese Nula (Null Hypothesis):** A hip√≥tese nula para o teste $\text{LR}_{\text{uc}}$ √© que o modelo VAR est√° corretamente calibrado, ou seja, a taxa de falha observada (N/T) √© igual √† taxa de falha esperada, que √© (1-c), onde *c* √© o n√≠vel de confian√ßa do VAR[^5]. Por exemplo, se o VAR √© calculado com 99% de confian√ßa, a taxa de falha esperada seria 1%.

3. **Teste N√£o Param√©trico:** O teste $\text{LR}_{\text{uc}}$ √© um teste *n√£o param√©trico*, o que significa que ele n√£o assume uma distribui√ß√£o espec√≠fica para os retornos do portf√≥lio[^5]. Isso o torna robusto para diferentes tipos de dados, incluindo distribui√ß√µes normais, assim√©tricas, com caudas pesadas ou mesmo que variam com o tempo[^5].

**Proposi√ß√£o 1.** *A taxa de falha observada, $N/T$, pode ser vista como uma estimativa da probabilidade de ocorr√™ncia de exce√ß√µes. Em uma amostra suficientemente grande, espera-se que essa estimativa se aproxime da taxa de falha esperada (1-c), dado que o modelo VAR est√° bem calibrado.*

> üí° **Exemplo Num√©rico:** Suponha que um modelo VAR com n√≠vel de confian√ßa de 95% seja usado para prever as perdas di√°rias de um portf√≥lio. Ap√≥s 500 dias, observamos 30 exce√ß√µes (dias em que a perda real excedeu o VAR previsto). A taxa de falha observada seria $N/T = 30/500 = 0.06$ ou 6%. A taxa de falha esperada, com um n√≠vel de confian√ßa de 95%, √© $1 - 0.95 = 0.05$ ou 5%. Este exemplo ilustra como a taxa de falha observada √© uma estimativa da probabilidade de exce√ß√µes e como ela pode ser comparada com a taxa esperada.

**Lema 1.** *Sob a hip√≥tese nula, a estat√≠stica $N$, o n√∫mero de exce√ß√µes observadas, segue uma distribui√ß√£o binomial com par√¢metros $T$ (n√∫mero total de observa√ß√µes) e $p$ (taxa de falha esperada). Isso significa que $N \sim \text{Binomial}(T, p)$.*

*Prova:*
1. Cada observa√ß√£o (dia) pode resultar em duas possibilidades: ou ocorre uma exce√ß√£o (a perda excede o VAR) ou n√£o ocorre.
2. A probabilidade de uma exce√ß√£o ocorrer em um determinado dia √© constante e igual a $p$, que √© a taxa de falha esperada.
3. As ocorr√™ncias de exce√ß√µes em diferentes dias s√£o independentes, ou seja, a ocorr√™ncia de uma exce√ß√£o em um dia n√£o afeta a probabilidade de ocorr√™ncia em outro dia.
4. Dado que temos *T* tentativas independentes (dias), cada uma com probabilidade *p* de sucesso (ocorr√™ncia de uma exce√ß√£o), a distribui√ß√£o de *N*, o n√∫mero total de exce√ß√µes, segue uma distribui√ß√£o binomial com par√¢metros *T* e *p*.

Portanto, $N \sim \text{Binomial}(T, p)$. ‚ñ†

**Lema 1.1.** *A m√©dia e a vari√¢ncia da distribui√ß√£o binomial de $N$ s√£o dadas por $E[N] = Tp$ e $Var[N] = Tp(1-p)$, respectivamente.*

*Prova:*
1. A m√©dia (valor esperado) de uma distribui√ß√£o binomial √© definida como o produto do n√∫mero de tentativas ($T$) e a probabilidade de sucesso em cada tentativa ($p$). Portanto, $E[N] = Tp$.
2. A vari√¢ncia de uma distribui√ß√£o binomial √© definida como o produto do n√∫mero de tentativas ($T$), a probabilidade de sucesso ($p$) e a probabilidade de fracasso $(1-p)$. Portanto, $Var[N] = Tp(1-p)$. ‚ñ†

> üí° **Exemplo Num√©rico:** Se tivermos 250 observa√ß√µes ($T = 250$) e a taxa de falha esperada for de 1% ($p = 0.01$), ent√£o o n√∫mero esperado de exce√ß√µes seria $E[N] = 250 \times 0.01 = 2.5$. A vari√¢ncia seria $Var[N] = 250 \times 0.01 \times (1 - 0.01) = 2.475$. Este exemplo mostra como calcular o valor esperado e a vari√¢ncia do n√∫mero de exce√ß√µes usando os par√¢metros da distribui√ß√£o binomial.

**Lema 1.2.** *A distribui√ß√£o binomial de N pode ser aproximada por uma distribui√ß√£o normal com m√©dia $Tp$ e vari√¢ncia $Tp(1-p)$ quando T √© grande (pelo Teorema do Limite Central). Esta aproxima√ß√£o √© √∫til para derivar o teste $\text{LR}_{\text{uc}}$.*

## C√°lculo do $\text{LR}_{\text{uc}}$

O $\text{LR}_{\text{uc}}$ √© calculado usando a seguinte f√≥rmula:

$$\text{LR}_{\text{uc}} = -2 \ln[(1 - p)^{T-N} p^N] + 2 \ln{[1 - (N/T)]^{T-N} (N/T)^N}$$[^9]

Onde:
- *p* √© a taxa de falha esperada (1 - n√≠vel de confian√ßa)
- *N* √© o n√∫mero de exce√ß√µes observadas
- *T* √© o n√∫mero total de observa√ß√µes

O primeiro termo da equa√ß√£o representa a log-verossimilhan√ßa sob a hip√≥tese nula e o segundo termo representa a log-verossimilhan√ßa para o n√∫mero de exce√ß√µes observadas[^9]. O teste √© constru√≠do para verificar se a diferen√ßa entre essas duas verossimilhan√ßas √© significativamente grande, o que indicaria que o modelo n√£o √© calibrado corretamente.

Sob a hip√≥tese nula, a estat√≠stica $\text{LR}_{\text{uc}}$ segue assintoticamente uma distribui√ß√£o qui-quadrado com um grau de liberdade[^9]. Isso significa que, para amostras grandes, podemos usar a distribui√ß√£o qui-quadrado para avaliar a signific√¢ncia estat√≠stica do resultado do teste.

## Interpreta√ß√£o do Teste

### 1. Valor Cr√≠tico

Com um n√≠vel de confian√ßa de 95%, o valor cr√≠tico da distribui√ß√£o qui-quadrado com um grau de liberdade √© de 3.841[^9]. Se o valor calculado de $\text{LR}_{\text{uc}}$ for maior que 3.841, rejeitamos a hip√≥tese nula, o que sugere que o modelo VAR est√° mal calibrado.

### 2. Tipo de Erro I e II

√â importante entender que, como em todos os testes de hip√≥teses, existem dois tipos de erros que podemos cometer[^8, ^11]:

- **Erro do Tipo I (Falso Positivo):** Rejeitamos a hip√≥tese nula quando ela √© verdadeira. Ou seja, conclu√≠mos que o modelo VAR est√° mal calibrado, quando na verdade ele est√° bem calibrado[^5].
- **Erro do Tipo II (Falso Negativo):** N√£o rejeitamos a hip√≥tese nula quando ela √© falsa. Ou seja, conclu√≠mos que o modelo VAR est√° bem calibrado, quando na verdade ele est√° mal calibrado[^5].

√â necess√°rio equilibrar esses dois tipos de erros ao escolher o n√≠vel de confian√ßa do teste[^8].
*A probabilidade de cometer um erro do tipo I √© diretamente controlada pelo n√≠vel de confian√ßa do teste, e a probabilidade de cometer um erro do tipo II diminui quando aumentamos o n√∫mero de observa√ß√µes*.

> üí° **Exemplo Num√©rico:** Suponha que, em um cen√°rio com um modelo VAR bem calibrado com 99% de confian√ßa, observamos um valor $\text{LR}_{\text{uc}}$ de 4.5 (com um valor cr√≠tico de 3.841 para um n√≠vel de confian√ßa de 95%). Este valor nos levaria a rejeitar a hip√≥tese nula, cometendo um Erro do Tipo I. Por outro lado, se tivermos um modelo VAR que est√° com uma taxa de falha de 3% quando a esperada √© de 1% (mal calibrado) mas, por uma amostra pequena, obtemos um valor $\text{LR}_{\text{uc}}$ de 2.1, falhar√≠amos em rejeitar a hip√≥tese nula, cometendo um Erro do Tipo II.

A tabela a seguir sumariza os poss√≠veis cen√°rios:

| Decis√£o do Teste $\text{LR}_{\text{uc}}$ | Modelo VAR Bem Calibrado | Modelo VAR Mal Calibrado |
| ---------------------------------------- | ------------------------ | ------------------------ |
| Rejeita Hip√≥tese Nula                    | Erro do Tipo I           | Decis√£o Correta          |
| N√£o Rejeita Hip√≥tese Nula                | Decis√£o Correta          | Erro do Tipo II          |

### 3. Poder do Teste

O poder do teste se refere √† probabilidade de rejeitar corretamente um modelo VAR mal calibrado[^8]. O poder do teste $\text{LR}_{\text{uc}}$ √© geralmente baixo, especialmente para valores pequenos de *p* (ou seja, quando o n√≠vel de confian√ßa do VAR √© alto) e quando o n√∫mero de observa√ß√µes √© baixo[^9]. Isto √© porque a ocorr√™ncia de exce√ß√µes nesses cen√°rios √© rara, e s√£o necess√°rios mais dados para detectar um desvio significativo da taxa de falha esperada.

**Teorema 1.** *O teste $\text{LR}_{\text{uc}}$ pode ser interpretado como um teste da raz√£o de verossimilhan√ßa entre a hip√≥tese nula (o modelo VAR est√° bem calibrado) e a hip√≥tese alternativa (o modelo VAR n√£o est√° bem calibrado). O termo $-2 \ln[(1 - p)^{T-N} p^N]$ representa a log-verossimilhan√ßa sob a hip√≥tese nula, enquanto o termo $-2 \ln{[1 - (N/T)]^{T-N} (N/T)^N}$ representa a log-verossimilhan√ßa sob a hip√≥tese alternativa de que a taxa de falha observada √© a melhor estimativa da taxa de falha verdadeira.*

**Teorema 1.1** *Uma formula√ß√£o equivalente para o teste $\text{LR}_{\text{uc}}$ que pode ser mais intuitiva em certas situa√ß√µes √©:*

$$\text{LR}_{\text{uc}} = 2 \left[ N \ln\left(\frac{N/T}{p}\right) + (T-N) \ln\left(\frac{1-N/T}{1-p}\right) \right]$$

*Prova:*
1. Come√ßamos com a f√≥rmula original:
   $$\text{LR}_{\text{uc}} = -2 \ln[(1 - p)^{T-N} p^N] + 2 \ln{[1 - (N/T)]^{T-N} (N/T)^N}$$

2. Usando propriedades dos logaritmos, expandimos cada termo:
   $$\text{LR}_{\text{uc}} = -2[(T-N)\ln(1-p) + N\ln(p)] + 2[(T-N)\ln(1-N/T) + N\ln(N/T)]$$

3. Distribuindo o -2 e 2 nos termos dentro dos colchetes:
   $$\text{LR}_{\text{uc}} = -2(T-N)\ln(1-p) -2N\ln(p) + 2(T-N)\ln(1-N/T) + 2N\ln(N/T)$$

4. Reorganizando os termos:
   $$\text{LR}_{\text{uc}} = 2N\ln(N/T) - 2N\ln(p) + 2(T-N)\ln(1-N/T) - 2(T-N)\ln(1-p)$$

5. Fatorando 2N e 2(T-N):
   $$\text{LR}_{\text{uc}} = 2N[\ln(N/T) - \ln(p)] + 2(T-N)[\ln(1-N/T) - \ln(1-p)]$$

6. Usando as propriedades dos logaritmos de que $\ln(a)-\ln(b) = \ln(a/b)$:
   $$\text{LR}_{\text{uc}} = 2 \left[ N \ln\left(\frac{N/T}{p}\right) + (T-N) \ln\left(\frac{1-N/T}{1-p}\right) \right]$$

Portanto, a formula√ß√£o equivalente para o teste $\text{LR}_{\text
