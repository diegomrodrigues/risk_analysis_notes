## Verifica√ß√£o do Modelo com Base nas Taxas de Falha: Teste do Z-Score e Regras de Decis√£o
### Introdu√ß√£o
Dando continuidade √† discuss√£o sobre a verifica√ß√£o de modelos VAR baseada nas taxas de falha, este cap√≠tulo aborda a aplica√ß√£o do *z-score* como estat√≠stica de teste e a defini√ß√£o das regras de decis√£o para avaliar a calibra√ß√£o dos modelos. Nos cap√≠tulos anteriores, foi discutida a import√¢ncia do *backtesting* [^1], a aproxima√ß√£o da distribui√ß√£o binomial pela distribui√ß√£o normal para grandes amostras [^5], o c√°lculo do *z-score* [^6], e a defini√ß√£o da regra de decis√£o baseada em valores cr√≠ticos [^10]. Esta se√ß√£o se concentrar√° na aplica√ß√£o pr√°tica do *z-score* para testes de hip√≥tese, na sua rela√ß√£o com o teste qui-quadrado, e em como definir valores de corte e interpretar os resultados do teste. O objetivo √© fornecer um entendimento completo de como utilizar o *z-score* para avaliar se um modelo VAR est√° corretamente calibrado.

### Conceitos Fundamentais

Como estabelecido anteriormente, o *z-score* √© uma medida que quantifica o desvio entre o n√∫mero de exce√ß√µes observadas ($x$) e o n√∫mero de exce√ß√µes esperado ($pT$), expresso em unidades de desvio padr√£o [^6]. A f√≥rmula para calcular o *z-score* √©:

$$ z = \frac{x - pT}{\sqrt{p(1-p)T}} $$ [^6]

onde $x$ √© o n√∫mero de exce√ß√µes observadas, $p$ √© a probabilidade de exce√ß√£o definida pelo modelo VAR e $T$ √© o n√∫mero de observa√ß√µes. Para um $T$ grande, este *z-score* segue aproximadamente uma distribui√ß√£o normal padr√£o com m√©dia 0 e vari√¢ncia 1 [^11]. Esta propriedade √© essencial para realizar testes de hip√≥tese, pois permite usar valores cr√≠ticos da distribui√ß√£o normal padr√£o para definir as regi√µes de rejei√ß√£o da hip√≥tese nula.

**Lema 12** A estat√≠stica z, calculada como $ z = \frac{x - pT}{\sqrt{p(1-p)T}} $, converge assintoticamente para uma distribui√ß√£o normal padr√£o, com m√©dia 0 e vari√¢ncia 1, para valores grandes de $T$.

*Prova:*
I. O n√∫mero de exce√ß√µes $x$ segue uma distribui√ß√£o binomial com par√¢metros $T$ e $p$, onde $T$ √© o n√∫mero de observa√ß√µes e $p$ √© a probabilidade de exce√ß√£o.
II. O Teorema do Limite Central garante que, para valores grandes de $T$, a distribui√ß√£o da m√©dia amostral de vari√°veis independentes e identicamente distribu√≠das aproxima-se de uma distribui√ß√£o normal.
III. O n√∫mero de exce√ß√µes, $x$, pode ser visto como uma soma de vari√°veis de Bernoulli, com m√©dia $pT$ e vari√¢ncia $p(1-p)T$.
IV. Portanto, para valores grandes de $T$, a estat√≠stica $z = \frac{x - pT}{\sqrt{p(1-p)T}}$ se aproxima de uma distribui√ß√£o normal padr√£o com m√©dia 0 e vari√¢ncia 1.
V. Este resultado √© crucial para realizar testes de hip√≥tese sobre a calibra√ß√£o de modelos VAR usando o z-score. ‚ñ†

> üí° **Exemplo Num√©rico:**  Considere um modelo VAR com um n√≠vel de confian√ßa de 99% (probabilidade de exce√ß√£o $p = 0.01$) e um per√≠odo de backtesting de $T = 500$ dias. O n√∫mero esperado de exce√ß√µes seria $E(x) = pT = 0.01 \times 500 = 5$. O desvio padr√£o seria $\sqrt{p(1-p)T} = \sqrt{0.01 \times 0.99 \times 500} \approx 2.22$. Se observarmos $x = 10$ exce√ß√µes, o z-score seria: $z = \frac{10 - 5}{2.22} \approx 2.25$. Para grandes valores de $T$, podemos assumir que o z-score segue uma distribui√ß√£o normal com m√©dia 0 e vari√¢ncia 1.

**Lema 12.1** O teste de hip√≥tese usando o z-score √© um teste bicaudal e a hip√≥tese nula √© rejeitada se o valor absoluto de $z$ for maior que o valor de corte.

*Prova:*
I. Em um teste de hip√≥tese para avaliar a calibra√ß√£o de um modelo VAR, a hip√≥tese nula √© que o modelo est√° corretamente calibrado, ou seja, a taxa de falha observada √© consistente com a taxa de falha esperada.
II. A hip√≥tese alternativa √© que o modelo n√£o est√° corretamente calibrado, e que o n√∫mero de exce√ß√µes √© diferente do esperado.
III. O teste bicaudal √© utilizado quando estamos interessados em detectar desvios tanto positivos (mais exce√ß√µes do que o esperado) quanto negativos (menos exce√ß√µes do que o esperado) em rela√ß√£o √† taxa de falha esperada.
IV. Rejeitamos a hip√≥tese nula se o valor absoluto do z-score, $|z|$, exceder um determinado valor de corte, o qual √© determinado com base no n√≠vel de confian√ßa desejado.
V. Este crit√©rio implica que se a amostra observada se encontra numa regi√£o onde se espera ocorrer apenas uma pequena percentagem das amostras caso a hip√≥tese nula fosse verdadeira, ent√£o √© mais apropriado concluir que a hip√≥tese nula √© falsa, e que o modelo est√° mal calibrado.
VI. Portanto, a regra de decis√£o envolve comparar o valor absoluto do *z-score* com um valor cr√≠tico $z_{\alpha/2}$ correspondente ao n√≠vel de signific√¢ncia escolhido, com o objetivo de determinar se a hip√≥tese nula deve ou n√£o ser rejeitada.  ‚ñ†

> üí° **Exemplo Num√©rico:** Em um teste de hip√≥tese com um n√≠vel de confian√ßa de 95%, o valor cr√≠tico para um teste bicaudal √© $z_{0.025} = 1.96$. Se o valor absoluto do z-score for maior do que 1.96, rejeitamos a hip√≥tese nula de que o modelo VAR est√° bem calibrado. Para um n√≠vel de confian√ßa de 99%, o valor cr√≠tico aumenta para aproximadamente 2.576, sendo necess√°rio um desvio ainda maior para rejeitar a hip√≥tese nula.
```python
from scipy.stats import norm

alpha_95 = 0.05
z_critical_95 = norm.ppf(1 - alpha_95/2)
alpha_99 = 0.01
z_critical_99 = norm.ppf(1 - alpha_99/2)
print(f"Critical z-score for 95% confidence level: {z_critical_95:.3f}")
print(f"Critical z-score for 99% confidence level: {z_critical_99:.3f}")
```
Output:
```
Critical z-score for 95% confidence level: 1.960
Critical z-score for 99% confidence level: 2.576
```

**Proposi√ß√£o 15** A escolha do n√≠vel de signific√¢ncia $\alpha$ do teste de hip√≥tese afeta o valor de corte $z_{\alpha/2}$ e, consequentemente, o balan√ßo entre erros tipo I e tipo II.

*Prova:*
I. O n√≠vel de signific√¢ncia $\alpha$ representa a probabilidade de rejeitar a hip√≥tese nula quando ela √© verdadeira (erro tipo I).
II. Reduzir $\alpha$ (por exemplo, de 5% para 1%) torna o teste mais rigoroso, diminuindo a probabilidade de rejeitar um modelo bem calibrado. No entanto, isso tamb√©m aumenta a probabilidade de n√£o rejeitar um modelo que est√° mal calibrado (erro tipo II).
III. Aumentar o n√≠vel de signific√¢ncia $\alpha$ aumenta a probabilidade de rejeitar um modelo bem calibrado (erro tipo I), mas reduz a probabilidade de n√£o detectar um modelo que est√° mal calibrado (diminuindo o erro tipo II).
IV. A escolha de $\alpha$ envolve um *trade-off* entre os erros do tipo I e do tipo II, e deve ser feita com base nas consequ√™ncias relativas de cada tipo de erro no contexto do problema.
V. Portanto, a escolha do n√≠vel de signific√¢ncia $\alpha$ influencia diretamente o valor de corte $z_{\alpha/2}$ e o balan√ßo entre os erros tipo I e tipo II.  ‚ñ†

> üí° **Exemplo Num√©rico:** Se escolhermos um n√≠vel de signific√¢ncia $\alpha = 0.05$ (5%), e o valor absoluto do z-score for maior que 1.96, rejeitamos a hip√≥tese nula. Se reduzirmos o n√≠vel de signific√¢ncia para $\alpha = 0.01$ (1%), o valor cr√≠tico aumenta para 2.576. Com o n√≠vel de 1%, reduzimos a probabilidade de rejeitar um modelo bem calibrado, mas aumentamos a probabilidade de n√£o identificar um modelo que est√° mal calibrado.
```mermaid
graph LR
    A[N√≠vel de Signific√¢ncia] --> B{Valor Cr√≠tico};
    B --> C[Regi√£o de Rejei√ß√£o];
    C --> D{Erro Tipo I};
     C --> E{Erro Tipo II};
```
**Lema 12.2** A regi√£o de aceita√ß√£o da hip√≥tese nula √© definida como o intervalo entre os valores cr√≠ticos inferior e superior do z-score, correspondentes ao n√≠vel de confian√ßa escolhido.

*Prova:*
I. No teste de hip√≥tese com z-score, a hip√≥tese nula √© que o modelo VAR est√° bem calibrado.
II. A regi√£o de aceita√ß√£o da hip√≥tese nula √© o intervalo de valores do z-score para os quais n√£o temos evid√™ncia estat√≠stica suficiente para rejeitar a hip√≥tese nula.
III. Para um teste bicaudal com um n√≠vel de signific√¢ncia $\alpha$, os valores cr√≠ticos s√£o $z_{\alpha/2}$ e $-z_{\alpha/2}$.
IV. A regi√£o de aceita√ß√£o √©, portanto, definida pelo intervalo: $-z_{\alpha/2} \leq z \leq z_{\alpha/2}$.
V. Se o valor do z-score calculado a partir dos dados de backtesting estiver dentro deste intervalo, n√£o rejeitamos a hip√≥tese nula.
VI. Portanto, a regi√£o de aceita√ß√£o √© definida com base nos valores cr√≠ticos que correspondem ao n√≠vel de confian√ßa escolhido. ‚ñ†

> üí° **Exemplo Num√©rico:** Em um teste com um n√≠vel de confian√ßa de 95%, a regi√£o de aceita√ß√£o do z-score √© definida pelo intervalo -1.96 a 1.96. Se o z-score calculado for 1.5, n√£o rejeitamos a hip√≥tese nula, pois o valor est√° dentro do intervalo de aceita√ß√£o. Se o z-score fosse 2.2, rejeitar√≠amos a hip√≥tese nula, pois o valor est√° fora do intervalo de aceita√ß√£o.

**Lema 13** O teste de hip√≥tese usando o z-score √© equivalente a um teste qui-quadrado com 1 grau de liberdade.

*Prova:*
I. A estat√≠stica de teste do qui-quadrado com 1 grau de liberdade √© dada por $\chi^2 = \frac{(O-E)^2}{E}$, onde $O$ √© o n√∫mero de observa√ß√µes (exce√ß√µes) e $E$ √© o n√∫mero esperado de observa√ß√µes (exce√ß√µes).
II. No contexto do backtesting de modelos VAR, $O=x$, e $E=pT$.
III. Substituindo estes valores na f√≥rmula do qui-quadrado, temos $\chi^2 = \frac{(x-pT)^2}{pT}$.
IV. Como a vari√¢ncia de uma distribui√ß√£o binomial √© $p(1-p)T$, podemos aproximar a estat√≠stica qui-quadrado por  $\chi^2 = \frac{(x-pT)^2}{p(1-p)T}$, quando a probabilidade de sucesso n√£o for muito baixa ou muito alta.
V. Ao elevar ao quadrado o z-score definido como $ z = \frac{x - pT}{\sqrt{p(1-p)T}} $, obtemos $z^2 = \frac{(x-pT)^2}{p(1-p)T}$, que √© igual √† estat√≠stica do teste qui-quadrado.
VI. Como o quadrado de uma vari√°vel normal padr√£o segue uma distribui√ß√£o qui-quadrado com 1 grau de liberdade, o quadrado da estat√≠stica z segue aproximadamente uma distribui√ß√£o qui-quadrado com 1 grau de liberdade, provando a equival√™ncia dos testes. ‚ñ†

> üí° **Exemplo Num√©rico:** Se tivermos um z-score de 2.5, o quadrado desse valor seria 6.25. Este valor corresponde √† estat√≠stica de um teste qui-quadrado com 1 grau de liberdade. A probabilidade de observar um valor t√£o grande ou maior numa distribui√ß√£o qui-quadrado com 1 grau de liberdade √© aproximadamente 0.012, o que √© o mesmo que calcular o p-valor para um teste bicaudal de hip√≥tese com a estat√≠stica z.

O teste de hip√≥tese usando o *z-score*, juntamente com a regra de decis√£o definida pelos valores de corte ou p-valores, permite verificar se o n√∫mero de exce√ß√µes observadas em um per√≠odo de *backtesting* √© consistente com o n√≠vel de confian√ßa do modelo VAR. Esta metodologia oferece uma forma objetiva e padronizada para avaliar a qualidade da calibra√ß√£o dos modelos VAR, facilitando a tomada de decis√µes informadas no √¢mbito da gest√£o de risco.

**Proposi√ß√£o 16** O teste de hip√≥tese com z-score √© um teste estat√≠stico para avaliar se a taxa de falha observada em um backtesting √© consistente com a probabilidade de exce√ß√£o do modelo, e n√£o avalia outros aspectos do modelo VAR.
*Prova:*
I. O teste de hip√≥tese baseado no z-score avalia o desvio entre o n√∫mero de exce√ß√µes observado e o n√∫mero esperado, com base na probabilidade de exce√ß√£o do modelo.
II. A estat√≠stica z √© uma fun√ß√£o apenas do n√∫mero de exce√ß√µes, da probabilidade de exce√ß√£o e do n√∫mero total de observa√ß√µes.
III. O teste de hip√≥tese, portanto, se baseia em avaliar se o n√∫mero de exce√ß√µes √© consistente com o esperado, e n√£o considera outras caracter√≠sticas do modelo VAR, como a sua capacidade de capturar efeitos de diversifica√ß√£o, ou de reagir a mudan√ßas nas condi√ß√µes de mercado.
IV. Consequentemente, o teste de hip√≥tese baseado no z-score deve ser complementado com outras ferramentas de avalia√ß√£o, para que se possa ter uma vis√£o mais completa do desempenho do modelo VAR.  ‚ñ†

> üí° **Exemplo Num√©rico:** Suponha que um modelo VAR apresente uma taxa de falha consistente com o n√≠vel de confian√ßa especificado (ou seja, o teste do z-score n√£o rejeita a hip√≥tese nula). Mesmo assim, esse modelo pode ser insens√≠vel a mudan√ßas no mercado ou n√£o capturar adequadamente o risco de eventos extremos. Portanto, o *backtesting* deve ser complementado com outras formas de avalia√ß√£o, como testes de *stress* e *benchmarking* com outros modelos.

**Corol√°rio 12** A corre√ß√£o de continuidade melhora a precis√£o do teste de hip√≥tese baseado no z-score.

*Prova:*
I. A corre√ß√£o de continuidade ajusta os limites da vari√°vel discreta para que se aproximem melhor da distribui√ß√£o cont√≠nua.
II. Ao calcular a probabilidade de observar $x$ ou menos exce√ß√µes, o valor discreto $x$ √© mapeado para $x+0.5$ na escala cont√≠nua.
III. Ao calcular a probabilidade de observar $x$ ou mais exce√ß√µes, o valor discreto $x$ √© mapeado para $x-0.5$ na escala cont√≠nua.
IV. A aplica√ß√£o desta corre√ß√£o ao z-score resulta em:
$$ z_{cc} = \begin{cases} \frac{x + 0.5 - pT}{\sqrt{p(1-p)T}} & \text{ se } x < pT \\ \frac{x - 0.5 - pT}{\sqrt{p(1-p)T}} & \text{ se } x > pT \end{cases} $$
V. O uso do z-score com corre√ß√£o de continuidade proporciona uma melhor aproxima√ß√£o da distribui√ß√£o binomial pela distribui√ß√£o normal, principalmente em amostras pequenas, e quando $p$ est√° longe de 0.5.
VI. Portanto, o z-score corrigido melhora a qualidade do teste de hip√≥tese, especialmente quando as condi√ß√µes para a aproxima√ß√£o normal n√£o s√£o totalmente satisfeitas.  ‚ñ†

> üí° **Exemplo Num√©rico:** Se um modelo VAR com $p=0.01$ √© submetido a um backtest com $T=100$ e observamos 3 exce√ß√µes ($x=3$). O z-score sem corre√ß√£o √© $z=\frac{3 - 0.01\times100}{\sqrt{0.01\times0.99\times100}} \approx 2.01$, enquanto que, com a corre√ß√£o de continuidade, ter√≠amos $z_{cc} = \frac{3-0.5 - 0.01\times100}{\sqrt{0.01\times0.99\times100}} \approx 1.51$. A corre√ß√£o de continuidade reduz o valor do z-score, tornando o teste menos propenso a rejeitar um modelo que possa estar bem calibrado. O valor do z-score tamb√©m poderia ter sido corrigido para $z_{cc} = \frac{3+0.5 - 0.01\times100}{\sqrt{0.01\times0.99\times100}} \approx 2.52$, caso estiv√©ssemos a testar a hip√≥tese de que o n√∫mero de exce√ß√µes √© muito baixo, ao inv√©s de testar a hip√≥tese de que o n√∫mero de exce√ß√µes √© muito alto.

**Lema 13.1** Quando o tamanho da amostra √© pequeno, o teste exato binomial pode ser utilizado como uma alternativa ao teste do z-score.

*Prova:*
I. O teste exato binomial calcula a probabilidade exata de observar um n√∫mero de exce√ß√µes t√£o extremo ou mais extremo do que o observado, dada a probabilidade de exce√ß√£o $p$ do modelo.
II. A probabilidade de observar $x$ ou mais exce√ß√µes √© dada pela soma das probabilidades binomiais:
$P(X \geq x) = \sum_{k=x}^{T} \binom{T}{k} p^k (1-p)^{T-k}$.
III. Da mesma forma, a probabilidade de observar $x$ ou menos exce√ß√µes √©:
$P(X \leq x) = \sum_{k=0}^{x} \binom{T}{k} p^k (1-p)^{T-k}$.
IV. O teste exato binomial n√£o requer a aproxima√ß√£o normal, e √© v√°lido mesmo para pequenos valores de $T$ e para valores de $p$ pr√≥ximos de 0 ou 1.
V. Este m√©todo √© mais computacionalmente intenso do que a aproxima√ß√£o normal, mas fornece resultados precisos quando as condi√ß√µes para a aproxima√ß√£o normal n√£o s√£o satisfeitas.
VI. Assim, o teste exato binomial √© uma alternativa valiosa ao z-score quando a aproxima√ß√£o normal n√£o √© adequada, especialmente em amostras pequenas. ‚ñ†

> üí° **Exemplo Num√©rico:** Considere um modelo VAR com $p=0.01$ e um backtesting de $T=20$ dias. Se observarmos 2 exce√ß√µes, para testar a hip√≥tese de que o modelo est√° bem calibrado, usar√≠amos o teste exato binomial para calcular a probabilidade de observar 2 ou mais exce√ß√µes, utilizando a distribui√ß√£o binomial, e n√£o recorrer√≠amos √† aproxima√ß√£o normal. O teste exato binomial √© mais preciso do que a aproxima√ß√£o normal neste caso, devido ao pequeno tamanho da amostra.

**Lema 13.2** O teste de raz√£o de verossimilhan√ßa (LR) √© uma alternativa ao z-score, e pode ser usado em cen√°rios onde a aproxima√ß√£o normal da distribui√ß√£o binomial n√£o √© apropriada, em particular para pequenos valores de T ou quando $p$ est√° longe de 0.5.

*Prova:*
I. O teste de raz√£o de verossimilhan√ßa compara a verossimilhan√ßa dos dados sob a hip√≥tese nula com a verossimilhan√ßa sob a hip√≥tese alternativa.
II. A hip√≥tese nula √© que a probabilidade de exce√ß√£o √© $p$, definida pelo modelo. A hip√≥tese alternativa √© que a probabilidade de exce√ß√£o √© diferente de $p$, e √© igual √† taxa de falha observada, $\hat{p}$.
III. A estat√≠stica do teste de raz√£o de verossimilhan√ßa √© dada por: $LR = -2 \ln \frac{L(p;x)}{L(\hat{p};x)}$, onde $L(p;x)$ √© a verossimilhan√ßa sob a hip√≥tese nula, e $L(\hat{p};x)$ √© a verossimilhan√ßa sob a hip√≥tese alternativa.
IV. Sob a hip√≥tese nula, a estat√≠stica LR segue assintoticamente uma distribui√ß√£o qui-quadrado com 1 grau de liberdade. Rejeitamos a hip√≥tese nula se a estat√≠stica LR for maior do que o valor cr√≠tico da distribui√ß√£o qui-quadrado para o n√≠vel de signific√¢ncia desejado.
V. Este teste n√£o depende da aproxima√ß√£o normal da distribui√ß√£o binomial, e pode ser usado em amostras pequenas.
VI. Portanto, o teste de raz√£o de verossimilhan√ßa √© uma alternativa robusta ao teste do z-score para validar a calibra√ß√£o de modelos VAR. ‚ñ†

> üí° **Exemplo Num√©rico:** Retomando o exemplo anterior de um modelo VAR com $p=0.01$ e um backtesting de $T=20$, se observarmos 2 exce√ß√µes, o teste de raz√£o de verossimilhan√ßa √© dado por $LR = -2 \ln \frac{L(0.01; 2)}{L(0.1; 2)}$, e este valor √© comparado com o valor cr√≠tico de uma distribui√ß√£o qui-quadrado com 1 grau de liberdade. A vantagem do teste de raz√£o de verossimilhan√ßa √© que ele n√£o precisa da aproxima√ß√£o normal, e √© v√°lido para amostras pequenas, como no exemplo.
```python
from scipy.stats import chi2
from scipy.special import comb
import numpy as np

def likelihood(T, x, p):
    return comb(T, x, exact=True) * (p**x) * ((1-p)**(T-x))

T = 20
p = 0.01
x = 2
p_hat = x / T
LR = -2 * np.log(likelihood(T, x, p) / likelihood(T, x, p_hat))
critical_value = chi2.ppf(0.95, 1)

print(f"Likelihood Ratio Statistic: {LR:.2f}")
print(f"Critical Value: {critical_value:.2f}")

if LR > critical_value:
    print("Reject the null hypothesis")
else:
    print("Fail to reject the null hypothesis")
```
Output:
```
Likelihood Ratio Statistic: 1.95
Critical Value: 3.84
Fail to reject the null hypothesis
```
Neste exemplo, a estat√≠stica LR √© 1.95, que √© menor que o valor cr√≠tico (3.84), portanto, n√£o rejeitamos a hip√≥tese nula.

**Proposi√ß√£o 17** A escolha do per√≠odo de *backtesting* $T$ influencia a pot√™ncia do teste de hip√≥tese e a precis√£o da avalia√ß√£o do modelo.
*Prova:*
I. A pot√™ncia de um teste de hip√≥tese, que √© a probabilidade de rejeitar a hip√≥tese nula quando ela √© falsa, aumenta com o tamanho da amostra.
II. Um per√≠odo de backtesting $T$ mais longo aumenta o n√∫mero de observa√ß√µes, o que aumenta a pot√™ncia do teste e a probabilidade de detetar um modelo VAR mal calibrado.
III. Por outro lado, um per√≠odo de backtesting muito curto pode n√£o ser suficiente para obter uma estimativa precisa da taxa de falha do modelo, resultando em testes com baixa pot√™ncia e maior probabilidade de erros tipo II.
IV. No entanto, um per√≠odo de backtesting muito longo pode incluir dados de condi√ß√µes de mercado diferentes, o que pode distorcer a an√°lise do modelo e tornar as premissas de estacionariedade inv√°lidas.
V. Portanto, a escolha do per√≠odo de backtesting $T$ deve ser feita com cuidado, considerando um balan√ßo entre a precis√£o do teste e a relev√¢ncia dos dados para as condi√ß√µes atuais do mercado. ‚ñ†
> üí° **Exemplo Num√©rico:** Suponha que temos um modelo VAR que √© relativamente est√°vel e as condi√ß√µes de mercado n√£o mudaram muito durante o per√≠odo de backtesting. Um backtesting mais longo, por exemplo, 1000 dias, fornecer√° mais dados do que um per√≠odo de 250 dias. Um per√≠odo mais longo aumentar√° a pot√™ncia do teste. No entanto, se as condi√ß√µes de mercado tiverem mudado muito durante o per√≠odo de backtesting, uma amostra mais longa pode n√£o refletir as atuais caracter√≠sticas do modelo, e um per√≠odo mais curto poderia ser mais apropriado.

**Lema 14** O uso de *p-valores* fornece uma maneira mais refinada de avaliar o teste de hip√≥tese do que o uso de valores cr√≠ticos, ao quantificar a probabilidade exata de observar os resultados obtidos ou resultados mais extremos.
*Prova:*
I. O *p-valor* √© definido como a probabilidade de observar uma estat√≠stica de teste t√£o extrema ou mais extrema do que a estat√≠stica observada, dado que a hip√≥tese nula √© verdadeira.
II. Ao contr√°rio dos valores cr√≠ticos, que definem um limiar para rejeitar ou n√£o a hip√≥tese nula, o *p-valor* fornece uma medida de qu√£o forte √© a evid√™ncia contra a hip√≥tese nula.
III. Se o *p-valor* √© menor do que o n√≠vel de signific√¢ncia $\alpha$, rejeitamos a hip√≥tese nula.
IV. No entanto, o *p-valor* fornece uma vis√£o mais completa da evid√™ncia contra a hip√≥tese nula, ao permitir quantificar a probabilidade exata de obter um valor igual ou mais extremo do que o observado.
V. A interpreta√ß√£o do *p-valor* permite entender a for√ßa da evid√™ncia contra a hip√≥tese nula. Um p-valor muito baixo indica que h√° evid√™ncias muito fortes contra a hip√≥tese nula, e um p-valor maior indica que a evid√™ncia contra a hip√≥tese nula √© fraca.
VI. Portanto, o uso de *p-valores* oferece uma forma mais matizada e informativa de avaliar o teste de hip√≥tese, complementando a regra de decis√£o baseada em valores cr√≠ticos. ‚ñ†
> üí° **Exemplo Num√©rico:** Suponha que o z-score observado seja 2.1. Em um teste bicaudal, o p-valor correspondente √© aproximadamente 0.0357, que √© a probabilidade de observar um z-score com valor absoluto maior do que 2.1. Se o n√≠vel de signific√¢ncia fosse 5% (0.05), rejeitar√≠amos a hip√≥tese nula. No entanto, se o n√≠vel de signific√¢ncia fosse 1% (0.01), n√£o rejeitar√≠amos. O p-valor de 0.0357 indica que a evid√™ncia contra a hip√≥tese nula √© moderada, e que rejeitar a hip√≥tese nula tem um risco associado.

**Proposi√ß√£o 18** Em situa√ß√µes onde as exce√ß√µes n√£o s√£o independentes, o teste do z-score pode levar a resultados incorretos.
*Prova:*
I. O teste do z-score baseia-se na premissa de que as exce√ß√µes s√£o eventos independentes, o que implica que a ocorr√™ncia de uma exce√ß√£o n√£o afeta a probabilidade de ocorr√™ncia de outra exce√ß√£o.
II. Em cen√°rios onde as exce√ß√µes est√£o correlacionadas, esta premissa √© violada, o que pode levar a resultados errados do teste do z-score.
III. A presen√ßa de depend√™ncia temporal nas exce√ß√µes (por exemplo, se uma exce√ß√£o tornar mais prov√°vel a ocorr√™ncia de outra exce√ß√£o no dia seguinte) pode levar a um z-score subestimado ou sobrestimado.
IV. Portanto, √© essencial verificar a independ√™ncia das exce√ß√µes antes de aplicar o teste do z-score e considerar outras alternativas quando existe depend√™ncia temporal.
V. Consequentemente, o teste do z-score deve ser utilizado com cautela quando se sabe ou se suspeita que as exce√ß√µes n√£o s√£o independentes. ‚ñ†

> üí° **Exemplo Num√©rico:** Considere um modelo VAR onde as perdas s√£o altamente concentradas em certos per√≠odos, por exemplo, durante per√≠odos de volatilidade elevada. Nestes casos, a ocorr√™ncia de uma exce√ß√£o pode tornar mais prov√°vel a ocorr√™ncia de outra exce√ß√£o no dia seguinte. O teste do z-score, que assume a independ√™ncia das exce√ß√µes, pode levar a conclus√µes erradas. Nesses casos, testes alternativos, como o teste de Kupiec, ou testes baseados em dura√ß√µes, podem ser mais apropriados.

**Proposi√ß√£o 19** Modelos VAR com diferentes probabilidades de exce√ß√£o, p, podem ser comparados usando o teste do z-score, desde que o n√∫mero de observa√ß√µes, T, seja suficientemente grande.
*Prova:*
I. O teste do z-score √© uma estat√≠stica padronizada que permite comparar o n√∫mero de exce√ß√µes observadas com o n√∫mero de exce√ß√µes esperado, utilizando como m√©trica o desvio padr√£o da amostra.
II. A estat√≠stica z transforma o n√∫mero de exce√ß√µes numa vari√°vel que segue aproximadamente uma distribui√ß√£o normal padr√£o, independente da probabilidade de exce√ß√£o p, desde que o n√∫mero de observa√ß√µes T seja grande.
III. Isto permite que modelos com diferentes n√≠veis de confian√ßa sejam comparados na mesma escala, atrav√©s da an√°lise dos respectivos z-scores ou p-valores.
IV. A compara√ß√£o de z-scores ou p-valores, mesmo entre modelos com diferentes probabilidades de exce√ß√£o, permite avaliar a calibra√ß√£o relativa dos modelos.
V. Portanto, o teste do z-score oferece uma forma padronizada de comparar diferentes modelos, desde que o tamanho da amostra seja suficientemente grande. ‚ñ†

> üí° **Exemplo Num√©rico:** Suponha que temos dois modelos VAR, um com um n√≠vel de confian√ßa de 99% ($p=0.01$) e outro com um n√≠vel de confian√ßa de 95% ($p=0.05$). Para comparar os dois modelos, podemos fazer um backtesting com um n√∫mero de observa√ß√µes T grande, calcular os respectivos z-scores e p-valores para cada modelo. Atrav√©s da compara√ß√£o desses valores, podemos avaliar qual dos modelos est√° melhor calibrado.

**Proposi√ß√£o 20** O teste do z-score, apesar de √∫til, deve ser utilizado em conjunto com outras m√©tricas e testes de backtesting para uma avalia√ß√£o robusta do modelo VAR.
*Prova:*
I. O teste do z-score avalia apenas a precis√£o da calibra√ß√£o do modelo, atrav√©s da compara√ß√£o da taxa de falha observada e esperada.
II. O teste do z-score n√£o avalia outros aspectos do modelo, como a precis√£o das previs√µes dos retornos, a capacidade de capturar a din√¢mica da volatilidade, ou de reagir a eventos extremos.
III. Uma an√°lise completa do modelo VAR requer o uso de m√©tricas adicionais, como a magnitude das perdas nas exce√ß√µes (ex: an√°lise dos excessos), o tempo entre exce√ß√µes, e a adequa√ß√£o da distribui√ß√£o de probabilidade assumida para as perdas.
IV. Outros testes de backtesting, como o teste de Kupiec, ou o teste de Christoffersen, podem tamb√©m fornecer *insights* complementares sobre o desempenho do modelo VAR.
V. Portanto, o teste do z-score deve ser visto como parte de um conjunto mais abrangente de t√©cnicas de backtesting, e n√£o como uma ferramenta √∫nica para avaliar a qualidade de um modelo VAR. ‚ñ†

> üí° **Exemplo Num√©rico:** Um modelo VAR pode passar no teste do z-score, mas ainda assim apresentar *clusters* de exce√ß√µes, ou apresentar um excesso m√©dio das perdas acima do VAR muito elevado. Isso mostraria que o modelo, apesar de aparentemente bem calibrado, pode n√£o estar capturando a din√¢mica das perdas corretamente, e que outros testes e m√©tricas devem ser utilizados.

### Conclus√£o

Este cap√≠tulo apresentou a aplica√ß√£o pr√°tica da estat√≠stica *z* para a avalia√ß√£o de modelos VAR, enfatizando a sua rela√ß√£o com o teste qui-quadrado. A estat√≠stica z, com um valor de corte apropriado (ou usando o *p-valor* associado), permite verificar se o n√∫mero de exce√ß√µes em um *backtesting* se desvia significativamente do n√∫mero de exce√ß√µes esperado sob a hip√≥tese de que o modelo VAR est√° corretamente calibrado. A escolha do n√≠vel de confian√ßa e a compreens√£o do *trade-off* entre erros do tipo I e tipo II s√£o elementos essenciais na aplica√ß√£o de testes de hip√≥tese com o z-score. Foi discutido tamb√©m como a corre√ß√£o de continuidade pode melhorar a precis√£o do teste em certas situa√ß√µes. Para amostras pequenas ou quando $p$ se desvia de 0.5, o teste exato binomial, ou o teste da raz√£o de verossimilhan√ßa, podem ser utilizados como uma alternativa ao teste do z-score. A an√°lise dos resultados do teste deve ser complementada com outras t√©cnicas de avalia√ß√£o para uma compreens√£o mais completa das limita√ß√µes e vantagens do modelo VAR analisado. A escolha do per√≠odo de backtesting, $T$, tamb√©m influencia a pot√™ncia do teste, e deve ser feita com cuidado, considerando um balan√ßo entre a precis√£o e a relev√¢ncia do per√≠odo. O uso de *p-valores* complementa a regra de decis√£o baseada em valores cr√≠ticos, oferecendo uma forma mais refinada de avaliar o teste de hip√≥tese. Adicionalmente, foi discutida a premissa de independ√™ncia das exce√ß√µes, e a necessidade de utilizar testes alternativos em cen√°rios onde esta condi√ß√£o n√£o √© v√°lida. Finalmente, demonstrou-se como o teste do z-score pode ser utilizado para comparar modelos VAR com diferentes n√≠veis de confian√ßa, desde que o tamanho da amostra seja suficientemente grande. A regi√£o de aceita√ß√£o foi definida como o intervalo de valores do z-score onde n√£o rejeitamos a hip√≥tese nula. Foi discutido tamb√©m que o teste do z-score, apesar de √∫til, deve ser utilizado em conjunto com outras m√©tricas e testes para uma avalia√ß√£o mais robusta do modelo VAR.

### Refer√™ncias
[^1]: *‚ÄúThis chapter turns to backtesting techniques for verifying the accuracy of VAR models.‚Äù*
[^5]: *‚ÄúThe simplest method to verify the accuracy of the model is to record the failure rate, which gives the proportion of times VAR is exceeded in a given sample...Ideally, the failure rate should give an unbiased measure of p, that is, should converge to p as the sample size increases...We want to know, at a given confidence level, whether N is too small or too large under the null hypothesis that p = 0.01 in a sample of size T.‚Äù*
[^6]: *‚Äúz= (x-pT)/sqrt(p(1-p)T) ~ N(0, 1)...If the decision rule is defined at the two-tailed 95 percent test confidence level, then the cutoff value of |z| is 1.96...Based on Equation (6.2), we have z = (x-pT)/‚àöp(1-p) T = (20 - 0.05 √ó 252)/‚àö0.05(0.95) 252 = 2.14...Therefore, we reject the hypothesis that the VAR model is unbiased.‚Äù*
[^10]: *‚ÄúThe issue is how to make this decision. This accept or reject decision is a classic statistical decision problem. At the outset, it should be noted that this decision must be made at some confidence level.‚Äù*
[^11]: *‚ÄúThe distribution could be normal, or skewed, or with heavy tails, or time-varying. We simply count the number of exceptions. As a result, this approach is fully nonparametric.‚Äù*
<!-- END -->
