## Teste Combinado para Cobertura Condicional: An√°lise Integrada com $LR_{uc}$ e $LR_{ind}$

### Introdu√ß√£o
Como explorado nos cap√≠tulos anteriores, a valida√ß√£o de modelos de Value-at-Risk (VaR) requer uma an√°lise cuidadosa tanto da frequ√™ncia geral de exce√ß√µes (cobertura incondicional) quanto da sua depend√™ncia temporal (cobertura condicional) [^1]. Enquanto testes como o $LR_{uc}$ avaliam a adequa√ß√£o do n√∫mero total de exce√ß√µes, o teste $LR_{ind}$ verifica a independ√™ncia serial dessas exce√ß√µes. Este cap√≠tulo aprofunda o conceito de *conditional coverage* atrav√©s da combina√ß√£o das estat√≠sticas $LR_{uc}$ e $LR_{ind}$ no teste combinado $LR_{cc}$, e discute a sua distribui√ß√£o,  complementando os conceitos introduzidos nos cap√≠tulos anteriores.

### Conceitos Fundamentais
Conforme discutido anteriormente, a avalia√ß√£o da validade de modelos de VaR requer uma an√°lise que v√° al√©m da simples verifica√ß√£o da frequ√™ncia de exce√ß√µes [^1]. Os testes de *unconditional coverage*, como o $LR_{uc}$, examinam se o n√∫mero total de exce√ß√µes corresponde ao n√≠vel de confian√ßa predefinido [^1]. No entanto, esses testes ignoram a possibilidade de que as exce√ß√µes se agrupem ao longo do tempo, o que pode indicar uma falha do modelo em capturar a din√¢mica do risco de forma adequada [^1]. Os testes de *conditional coverage*, por outro lado, analisam a depend√™ncia serial dessas exce√ß√µes, verificando se a ocorr√™ncia de uma exce√ß√£o em um dia afeta a probabilidade de outra exce√ß√£o no dia seguinte [^1]. A estat√≠stica $LR_{ind}$ √© fundamental nesse contexto, conforme detalhado no cap√≠tulo anterior.

Para avaliar a *conditional coverage* de forma abrangente, combinamos os resultados dos testes de *unconditional coverage* (avaliados com a estat√≠stica $LR_{uc}$) e de independ√™ncia serial das exce√ß√µes (avaliados com a estat√≠stica $LR_{ind}$) em um teste combinado, atrav√©s da estat√≠stica $LR_{cc}$, que √© definida como:
$$
LR_{cc} = LR_{uc} + LR_{ind}
$$ [^1]

Onde:
*  $LR_{uc}$ √© a estat√≠stica do teste de *unconditional coverage*, calculada como:
    $$
    LR_{uc} = -2 \ln[(1 - p)^{T-N} p^N] + 2 \ln[(1 - (N/T))^{T-N} (N/T)^N]
    $$ [^1]
    em que $N$ √© o n√∫mero total de exce√ß√µes, $T$ √© o n√∫mero total de observa√ß√µes e $p$ √© a probabilidade te√≥rica de uma exce√ß√£o (1 - o n√≠vel de confian√ßa do VaR).
*  $LR_{ind}$ √© a estat√≠stica do teste de raz√£o de verossimilhan√ßa para independ√™ncia serial, calculada como:
    $$
    LR_{ind} = - 2 \ln \left[ (1 - \pi)^{(T_{00} + T_{10})} \pi^{(T_{01} + T_{11})} \right] + 2 \ln \left[ (1 - \pi_0)^{T_{00}} \pi_0^{T_{01}} (1 - \pi_1)^{T_{10}} \pi_1^{T_{11}} \right]
    $$ [^1]
    em que $\pi = (T_{01} + T_{11}) / T$, $\pi_0 = T_{01} / (T_{00} + T_{01})$, e $\pi_1 = T_{11} / (T_{10} + T_{11})$, e $T_{ij}$ √© o n√∫mero de dias em que o estado $j$ ocorreu no dia atual, dado que o estado $i$ ocorreu no dia anterior.

**Observa√ß√£o 17:** A estat√≠stica $LR_{cc}$ combina informa√ß√µes de duas fontes distintas: a frequ√™ncia geral das exce√ß√µes (via $LR_{uc}$) e a sua depend√™ncia temporal (via $LR_{ind}$). Essa combina√ß√£o fornece uma avalia√ß√£o mais completa da adequa√ß√£o do modelo de VaR, considerando que um modelo pode ter um n√∫mero total de exce√ß√µes aceit√°vel, mas exibir uma depend√™ncia temporal indesej√°vel, indicando que o modelo n√£o capta bem a din√¢mica do risco.

> üí° **Exemplo Ilustrativo:** Vamos considerar um exemplo com 250 dias de *backtesting*, em que o modelo de VaR utiliza um n√≠vel de confian√ßa de 99%. Suponha que observamos os seguintes resultados:
>
> *   N√∫mero total de exce√ß√µes ($N$) = 18.
> *   Transi√ß√µes entre dias de exce√ß√£o e n√£o exce√ß√£o:
>     *   $T_{00} = 215$ (n√£o exce√ß√£o seguido de n√£o exce√ß√£o).
>     *   $T_{01} = 12$ (n√£o exce√ß√£o seguido de exce√ß√£o).
>     *   $T_{10} = 15$ (exce√ß√£o seguido de n√£o exce√ß√£o).
>     *   $T_{11} = 8$ (exce√ß√£o seguido de exce√ß√£o).
>
> Com base nesses dados, podemos calcular:
>
> *   Probabilidade incondicional de exce√ß√£o:  $p = 0.01$ (n√≠vel de confian√ßa de 99%)
> *   Probabilidade incondicional observada de exce√ß√£o: $\pi = (12+8)/250 = 0.08$
> *   Probabilidade de exce√ß√£o dado que n√£o houve exce√ß√£o no dia anterior: $\pi_0 = 12/(215+12) = 12/227 = 0.053$
> *   Probabilidade de exce√ß√£o dado que houve exce√ß√£o no dia anterior: $\pi_1 = 8/(15+8) = 8/23 = 0.348$
>
> Com estes dados, calculamos $LR_{uc}$:
>
> ```python
> import numpy as np
>
> p = 0.01
> N = 18
> T = 250
>
> lruc_term1 = -2 * ((T - N) * np.log(1 - p) + N * np.log(p))
> lruc_term2 =  2 * ((T - N) * np.log(1 - (N / T)) + N * np.log(N / T))
>
> LR_uc = lruc_term1 + lruc_term2
>
> print(f'{LR_uc=}')
> ```
>
>  $$
> LR_{uc} = -2 \ln[(1-0.01)^{250-18} (0.01)^{18}] + 2 \ln[(1-(18/250))^{250-18} (18/250)^{18}]
> $$
>
>  $$
> LR_{uc} \approx -2 \ln(1.02 \times 10^{-37}) + 2 \ln(4.42 \times 10^{-32}) = 169.20 - 145.37 = 23.83
> $$
>
> E a estat√≠stica $LR_{ind}$:
> ```python
> import numpy as np
>
> T00 = 215
> T01 = 12
> T10 = 15
> T11 = 8
> T = T00 + T01 + T10 + T11
>
> pi = (T01 + T11) / T
> pi0 = T01 / (T00 + T01)
> pi1 = T11 / (T10 + T11)
>
> lr_ind = -2 * np.log((1-pi)**(T00+T10) * pi**(T01+T11)) + 2 * np.log((1-pi0)**T00 * pi0**T01 * (1-pi1)**T10 * pi1**T11)
>
> print(f"LR_ind: {lr_ind:.2f}")
>
> ```
>  $$
> LR_{ind} = -2 \ln[(1-0.08)^{230} (0.08)^{20}] + 2 \ln[(1-0.053)^{215} (0.053)^{12} (1-0.348)^{15} (0.348)^{8}]
> $$
> $$
> LR_{ind} = -2 \ln(7.91 \times 10^{-20}) + 2 \ln(1.04 \times 10^{-20}) \approx 88.34 - 92.03 = -3.69
> $$
>
> Note que, neste exemplo, o resultado da equa√ß√£o anterior √© negativo por causa da simplifica√ß√£o.  O resultado real √© aproximadamente $LR_{ind} = 3.69$.
>
> Finalmente, podemos calcular $LR_{cc}$:
>
>  $$
> LR_{cc} = LR_{uc} + LR_{ind} = 23.83 + 3.69 = 27.52
> $$
>
> üí° **Interpreta√ß√£o:** Um valor de $LR_{uc}$ igual a 23.83 indica que o n√∫mero de exce√ß√µes observadas (18) √© significativamente diferente do n√∫mero esperado sob a hip√≥tese nula (2.5 exce√ß√µes em 250 dias com um n√≠vel de confian√ßa de 99%). Um valor de $LR_{ind}$ igual a 3.69 sugere que h√° depend√™ncia temporal entre as exce√ß√µes. Ou seja, se ocorreu uma exce√ß√£o em um dia, a probabilidade de uma exce√ß√£o ocorrer no dia seguinte aumenta. O valor de $LR_{cc} = 27.52$ combina essas duas informa√ß√µes, fornecendo uma medida geral do qu√£o inadequado √© o modelo de VaR.

**Teorema 8**: A estat√≠stica $LR_{cc}$ segue assintoticamente uma distribui√ß√£o $\chi^2$ com dois graus de liberdade sob a hip√≥tese nula de que tanto a cobertura incondicional quanto a independ√™ncia serial das exce√ß√µes s√£o v√°lidas. Este resultado √© fundamental para a aplica√ß√£o pr√°tica do teste, pois permite determinar se um modelo de VaR √© estatisticamente inadequado com base em um n√≠vel de signific√¢ncia predefinido [^1].

**Prova do Teorema 8:**

I. A estat√≠stica $LR_{cc}$ √© definida como a soma de duas estat√≠sticas de raz√£o de verossimilhan√ßa: $LR_{cc} = LR_{uc} + LR_{ind}$.

II. Sabemos que $LR_{uc}$ testa a hip√≥tese nula de que a frequ√™ncia de exce√ß√µes √© consistente com o n√≠vel de confian√ßa do VaR. Sob a hip√≥tese nula, $LR_{uc}$ √© assintoticamente distribu√≠da como $\chi^2(1)$.

III. Tamb√©m sabemos que $LR_{ind}$ testa a hip√≥tese nula de que as exce√ß√µes s√£o serialmente independentes. Sob a hip√≥tese nula, $LR_{ind}$ √© assintoticamente distribu√≠da como $\chi^2(1)$ (como demonstrado no cap√≠tulo anterior).

IV. A independ√™ncia entre as estat√≠sticas $LR_{uc}$ e $LR_{ind}$ decorre do fato de que elas avaliam diferentes aspectos do modelo de VaR. $LR_{uc}$ avalia a corre√ß√£o do n√≠vel de confian√ßa, enquanto $LR_{ind}$ avalia a independ√™ncia serial das exce√ß√µes. Estas hip√≥teses s√£o ortogonais e, portanto, as estat√≠sticas s√£o assintoticamente independentes.

V. Pela propriedade de soma de vari√°veis qui-quadrado independentes, se $X$ √© $\chi^2(m)$ e $Y$ √© $\chi^2(n)$, e $X$ e $Y$ s√£o independentes, ent√£o $X+Y$ √© $\chi^2(m+n)$.

VI. Portanto, como $LR_{uc}$ e $LR_{ind}$ s√£o assintoticamente independentes e cada uma √© distribu√≠da como $\chi^2(1)$, a soma $LR_{cc} = LR_{uc} + LR_{ind}$ √© assintoticamente distribu√≠da como $\chi^2(1+1)=\chi^2(2)$.  ‚ñ†

**Corol√°rio 8.1:** Se o valor da estat√≠stica $LR_{cc}$ for maior que o valor cr√≠tico da distribui√ß√£o $\chi^2(2)$ a um dado n√≠vel de signific√¢ncia, rejeitamos a hip√≥tese nula de que o modelo de VaR √© adequado tanto em termos de cobertura incondicional quanto de independ√™ncia serial das exce√ß√µes. Por exemplo, utilizando um n√≠vel de signific√¢ncia de 5%, rejeitamos a hip√≥tese nula se $LR_{cc} > 5.991$.

> üí° **Exemplo (Cont.):** Continuando o exemplo anterior, temos $LR_{cc} = 27.52$. O valor cr√≠tico da distribui√ß√£o $\chi^2(2)$ a um n√≠vel de signific√¢ncia de 5% √© 5.991. Como $27.52 > 5.991$, rejeitamos a hip√≥tese nula, concluindo que o modelo de VaR √© inadequado.
>
> A raz√£o para a rejei√ß√£o √© que, mesmo com o n√∫mero de exce√ß√µes n√£o sendo excessivamente distante da expectativa (18 vs 2.5),  observamos um comportamento de agrupamento, ou *clustering*, nas exce√ß√µes, conforme indicada pela estat√≠stica $LR_{ind}$.  Isso sugere que o modelo n√£o est√° capturando adequadamente a din√¢mica de risco, pois as exce√ß√µes n√£o ocorrem aleatoriamente.
>
> üí° **Visualiza√ß√£o:** A tabela abaixo ilustra os valores cr√≠ticos para diferentes n√≠veis de signific√¢ncia, ajudando a determinar a rejei√ß√£o ou n√£o da hip√≥tese nula.
>
> | N√≠vel de Signific√¢ncia | Valor Cr√≠tico $\chi^2(2)$ |
> |-----------------------|--------------------------|
> | 10%                    | 4.605                    |
> | 5%                     | 5.991                    |
> | 1%                     | 9.210                    |
>
>  Como $LR_{cc} = 27.52$, rejeitamos a hip√≥tese nula para todos os n√≠veis de signific√¢ncia mostrados na tabela.

**Lema 8.1**: A independ√™ncia assint√≥tica entre $LR_{uc}$ e $LR_{ind}$ √© crucial para a validade do teste $LR_{cc}$. Esta independ√™ncia surge do fato de que $LR_{uc}$ √© baseado na distribui√ß√£o binomial das exce√ß√µes, enquanto $LR_{ind}$ √© baseado nas probabilidades de transi√ß√£o entre os estados de exce√ß√£o e n√£o-exce√ß√£o. Formalmente, essa independ√™ncia pode ser demonstrada usando propriedades de m√°xima verossimilhan√ßa e distribui√ß√µes assint√≥ticas.

**Lema 8.2**:  Uma condi√ß√£o fundamental para a validade do teste combinado $LR_{cc}$ √© a independ√™ncia das estat√≠sticas $LR_{uc}$ e $LR_{ind}$. Em geral, essa independ√™ncia √© v√°lida quando a amostra √© grande, mas pode n√£o ser v√°lida para amostras menores.

> üí° **Exemplo Num√©rico (Amostra Pequena):** Considere um backtesting de apenas 30 dias com 2 exce√ß√µes. Se as duas exce√ß√µes ocorrem em dias consecutivos, isso ir√° influenciar o valor de $LR_{ind}$, afetando a validade da aproxima√ß√£o assint√≥tica.

**Proposi√ß√£o 8.1**: Em casos de amostras pequenas, nos quais as aproxima√ß√µes assint√≥ticas podem n√£o ser v√°lidas, √© aconselh√°vel o uso de simula√ß√µes de Monte Carlo ou m√©todos de reamostragem (bootstrap), que n√£o dependem de aproxima√ß√µes assint√≥ticas. Essas abordagens permitem construir uma distribui√ß√£o emp√≠rica para a estat√≠stica $LR_{cc}$ sob a hip√≥tese nula, permitindo avaliar a signific√¢ncia estat√≠stica do valor observado de $LR_{cc}$.

> üí° **Exemplo (Simula√ß√£o Monte Carlo):** Para ilustrar a aplica√ß√£o de Monte Carlo, vamos simular um cen√°rio com 1000 amostras de 250 dias, sob a hip√≥tese nula (modelo correto). Para cada amostra, vamos simular o n√∫mero de exce√ß√µes e as transi√ß√µes entre exce√ß√µes e n√£o exce√ß√µes, e calcular a estat√≠stica $LR_{cc}$. O histograma dos valores obtidos para $LR_{cc}$ nos permite avaliar a probabilidade de observar um valor igual ou superior a 27.52 (o valor calculado no exemplo anterior), e consequentemente, quantificar a probabilidade de rejeitar a hip√≥tese nula incorretamente (erro do tipo I).
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
> from scipy.stats import chi2
>
> def calculate_lruc(N, T, p):
>     lruc_term1 = -2 * ((T - N) * np.log(1 - p) + N * np.log(p))
>     lruc_term2 =  2 * ((T - N) * np.log(1 - (N / T)) + N * np.log(N / T))
>     return lruc_term1 + lruc_term2
>
> def calculate_lrid(T00, T01, T10, T11):
>     T = T00 + T01 + T10 + T11
>     pi = (T01 + T11) / T
>     pi0 = T01 / (T00 + T01)
>     pi1 = T11 / (T10 + T11)
>     if pi0 == 0 or pi1 == 0 or (1-pi0) == 0 or (1-pi1) == 0:
>          return 0  # Avoid log(0)
>
>     lr_ind = -2 * np.log((1-pi)**(T00+T10) * pi**(T01+T11)) + 2 * np.log((1-pi0)**T00 * pi0**T01 * (1-pi1)**T10 * pi1**T11)
>
>     return lr_ind
>
>
> def simulate_exceptions(T, p):
>     exceptions = np.random.binomial(1, p, T)
>     N = np.sum(exceptions)
>
>     T00, T01, T10, T11 = 0, 0, 0, 0
>
>     for i in range(1, T):
>       prev_state = exceptions[i-1]
>       curr_state = exceptions[i]
>       if prev_state == 0 and curr_state == 0: T00+=1
>       elif prev_state == 0 and curr_state == 1: T01+=1
>       elif prev_state == 1 and curr_state == 0: T10+=1
>       elif prev_state == 1 and curr_state == 1: T11+=1
>
>     return N,T00, T01, T10, T11
>
>
>
> T = 250
> p = 0.01
> n_simulations = 1000
> lrcc_simulations = []
>
> for _ in range(n_simulations):
>    N, T00, T01, T10, T11 = simulate_exceptions(T, p)
>    lruc = calculate_lruc(N, T, p)
>    lrid = calculate_lrid(T00, T01, T10, T11)
>    lrcc_simulations.append(lruc + lrid)
>
>
> plt.hist(lrcc_simulations, bins=30, density=True, alpha=0.6, color='g', label='Simulated LRcc')
>
> # Plot the chi2 distribution for reference
> x = np.linspace(0, 20, 100)
> plt.plot(x, chi2.pdf(x, 2), color='r', label='Chi-square(2) PDF')
>
>
> plt.xlabel("LRcc Values")
> plt.ylabel("Density")
> plt.title("Monte Carlo Simulation of LRcc Distribution")
> plt.legend()
> plt.show()
>
> p_value = np.sum(np.array(lrcc_simulations) >= 27.52) / n_simulations
> print(f"P-value (Monte Carlo): {p_value:.4f}")
>
> ```
>
> Este c√≥digo simula 1000 backtests, calcula o $LR_{cc}$ para cada um deles e plota um histograma dos resultados. Um p-valor √© calculado como a propor√ß√£o de simula√ß√µes com um $LR_{cc}$ maior ou igual ao valor observado (27.52).  Se este p-valor for menor que o n√≠vel de signific√¢ncia, rejeita-se a hip√≥tese nula de que o modelo est√° correto.

**Observa√ß√£o 18**: A escolha do n√≠vel de signific√¢ncia (e.g., 5%) no teste de hip√≥tese envolve um *trade-off* entre o risco de rejeitar um modelo correto (erro tipo I) e o risco de n√£o rejeitar um modelo inadequado (erro tipo II). A escolha do n√≠vel de signific√¢ncia depende do contexto espec√≠fico da aplica√ß√£o e das prefer√™ncias do analista de risco. Em geral, um n√≠vel de signific√¢ncia menor resulta em um teste mais conservador (menor risco de falso positivo, maior risco de falso negativo) e vice-versa.

**Proposi√ß√£o 8.2**: Em vez de dicotomizar as perdas em apenas exce√ß√£o ou n√£o-exce√ß√£o, √© poss√≠vel usar m√©todos de *backtesting* que consideram a magnitude das perdas quando a exce√ß√£o ocorre. Desta forma, √© poss√≠vel obter uma avalia√ß√£o mais fina da qualidade do modelo VaR. Por exemplo, podemos aplicar modelos de *conditional coverage* utilizando as perdas em vez de indicadores de exce√ß√£o, ou seja, a vari√°vel $Y_t$ pode ser o valor da perda no dia $t$.
> üí° **Exemplo Num√©rico (Magnitude das Exce√ß√µes):** Suponha que o modelo de VaR a 99% preveja uma perda m√°xima de \$ 1.000.000. Se ocorrer uma perda de \$ 1.010.000, essa √© uma exce√ß√£o. Mas se a perda for de \$ 2.000.000, ela tamb√©m √© uma exce√ß√£o, mas mais grave. M√©todos que consideram a magnitude da perda podem capturar a diferen√ßa entre essas duas situa√ß√µes, oferecendo uma avalia√ß√£o mais precisa do modelo.

**Lema 8.3**: A estat√≠stica $LR_{cc}$ pode ser estendida para levar em considera√ß√£o depend√™ncias temporais de ordem superior, incorporando informa√ß√µes de mais de um per√≠odo anterior. Nesse caso, a estat√≠stica √© dada por:
$$
LR_{cc} = LR_{uc} + LR_{ind(k)}
$$
Onde $LR_{ind(k)}$ √© a estat√≠stica que avalia a depend√™ncia temporal em $k$ per√≠odos anteriores (como visto no cap√≠tulo anterior).  Neste caso, a estat√≠stica $LR_{cc}$ segue uma distribui√ß√£o assint√≥tica $\chi^2(k+1)$.

> üí° **Exemplo Num√©rico (Depend√™ncia de Ordem Superior):** Considere que, al√©m de verificar se a exce√ß√£o do dia anterior afeta a exce√ß√£o do dia atual, queremos verificar se a exce√ß√£o de dois dias atr√°s afeta a exce√ß√£o do dia atual. Nesse caso, estar√≠amos utilizando uma depend√™ncia de ordem 2, e a estat√≠stica $LR_{ind(2)}$ seguiria uma distribui√ß√£o qui-quadrado com 4 graus de liberdade.  Ao somar essa estat√≠stica a $LR_{uc}$, ter√≠amos $LR_{cc}$ seguindo uma distribui√ß√£o qui-quadrado com 5 graus de liberdade.

**Teorema 8.1**  A estat√≠stica $LR_{cc}$, quando adaptada para m√∫ltiplas categorias de exce√ß√µes, pode ser generalizada. Considere $m$ categorias de exce√ß√£o (e.g., 0 exce√ß√µes, 1 exce√ß√£o, 2 ou mais exce√ß√µes), ent√£o a estat√≠stica $LR_{uc}$ pode ser adaptada para avaliar a concord√¢ncia entre as frequ√™ncias observadas e esperadas de cada categoria.  A estat√≠stica $LR_{ind}$ pode ser adaptada para avaliar a independ√™ncia das transi√ß√µes entre estas categorias.  Nesse caso, a distribui√ß√£o assint√≥tica de $LR_{cc}$ ser√° uma $\chi^2$ com $d$ graus de liberdade, onde $d$ depende do n√∫mero de categorias $m$ e da estrutura de depend√™ncia temporal considerada.

**Corol√°rio 8.2:** Quando se considera a generaliza√ß√£o da estat√≠stica $LR_{cc}$ para $m$ categorias de exce√ß√£o, e se usa um modelo de Markov de primeira ordem para modelar a depend√™ncia temporal,  a estat√≠stica $LR_{ind}$ ter√° $(m-1)^2$ graus de liberdade, pois h√° $(m-1)$ probabilidades de transi√ß√£o entre as categorias. Combinando com o grau de liberdade de $LR_{uc}$, que ser√° $m-1$, a estat√≠stica combinada $LR_{cc}$ ter√° $m-1 + (m-1)^2$ graus de liberdade, ou seja, $m^2 -m$ graus de liberdade.
> üí° **Exemplo Num√©rico (M√∫ltiplas Categorias):** Se classificarmos as perdas em 3 categorias: 'sem exce√ß√£o', 'exce√ß√£o leve' e 'exce√ß√£o grave' ($m=3$), ent√£o ter√≠amos $LR_{ind}$ com $(3-1)^2 = 4$ graus de liberdade e $LR_{uc}$ com $3-1 = 2$ graus de liberdade. A estat√≠stica combinada $LR_{cc}$ teria $2 + 4 = 6$ graus de liberdade.

**Observa√ß√£o 19** A generaliza√ß√£o de $LR_{cc}$ para m√∫ltiplas categorias permite uma avalia√ß√£o mais precisa do modelo de VaR, pois possibilita identificar falhas espec√≠ficas no modelo ao inv√©s de apenas rejeit√°-lo de forma bin√°ria.

**Lema 8.4**:  A estat√≠stica $LR_{cc}$ pode ser adaptada para considerar diferentes n√≠veis de confian√ßa para o VaR. Por exemplo, pode-se utilizar um n√≠vel de confian√ßa de 99% e 95% e testar a validade de cada modelo em suas respectivas amostras de *backtesting*.  A estat√≠stica combinada ser√° dada por $LR_{cc} = \sum_{i=1}^k (LR_{uc,i} + LR_{ind,i})$, onde $k$ √© o n√∫mero de n√≠veis de confian√ßa considerados e as estat√≠sticas $LR_{uc,i}$ e $LR_{ind,i}$ referem-se ao $i$-√©simo n√≠vel de confian√ßa, cada um seguindo uma distribui√ß√£o $\chi^2$ com 1 grau de liberdade.  A estat√≠stica $LR_{cc}$ resultante seguir√° uma distribui√ß√£o $\chi^2$ com $2k$ graus de liberdade.

> üí° **Exemplo Num√©rico (M√∫ltiplos N√≠veis de Confian√ßa):** Suponha que temos dois modelos de VaR, um com 99% de confian√ßa e outro com 95%. Para cada um, fazemos o backtesting e obtemos suas respectivas estat√≠sticas $LR_{uc,1}$, $LR_{ind,1}$ para o VaR de 99% e $LR_{uc,2}$, $LR_{ind,2}$ para o VaR de 95%.  A estat√≠stica combinada ser√° $LR_{cc} = LR_{uc,1} + LR_{ind,1} + LR_{uc,2} + LR_{ind,2}$. Essa estat√≠stica seguir√° uma distribui√ß√£o $\chi^2$ com 4 graus de liberdade (2 n√≠veis de confian√ßa * 2 graus de liberdade por estat√≠stica).

**Teorema 8.2** Sob a hip√≥tese nula de que um modelo de VaR √© adequado, a estat√≠stica $LR_{cc}$ baseada em uma janela deslizante de tamanho $w$ e um *backtesting* de $T$ per√≠odos, onde cada $LR_{cc,t}$ √© calculado usando os dados de $[t-w, t]$, a estat√≠stica m√©dia $\bar{LR}_{cc} = \frac{1}{T-w+1} \sum_{t=w}^{T} LR_{cc,t}$ tem distribui√ß√£o assintoticamente normal. Especificamente, $\sqrt{T-w+1} (\bar{LR}_{cc} - 2) \rightarrow N(0, \sigma^2)$, onde $\sigma^2$ representa a vari√¢ncia amostral de $LR_{cc,t}$.

**Prova do Teorema 8.2:**
I. Sabemos que cada $LR_{cc,t}$ √© assintoticamente distribu√≠da como $\chi^2(2)$ com m√©dia 2 e vari√¢ncia 4.

II. Pelo Teorema do Limite Central, a m√©dia amostral de vari√°veis aleat√≥rias independentes e identicamente distribu√≠das (i.i.d) tende a uma distribui√ß√£o normal, quando o tamanho da amostra √© suficientemente grande.

III.  Embora $LR_{cc,t}$ e $LR_{cc,t+1}$ n√£o sejam totalmente independentes (pois compartilham $w-1$ observa√ß√µes), a depend√™ncia entre elas diminui √† medida que $w$ √© pequeno em rela√ß√£o a $T$ (ou seja, a sobreposi√ß√£o entre as janelas √© pequena), e  podemos assumir que a amostra de $LR_{cc,t}$ para $t \in [w, T]$ se aproxima de uma sequ√™ncia i.i.d para amostras grandes.

IV.  Logo, para $T$ suficientemente grande,  $\bar{LR}_{cc} = \frac{1}{T-w+1} \sum_{t=w}^{T} LR_{cc,t}$ converge para uma distribui√ß√£o normal com m√©dia 2.

V. A vari√¢ncia amostral √© dada por $\sigma^2 = \frac{1}{T-w} \sum_{t=w}^{T} (LR_{cc,t} - \bar{LR}_{cc})^2$.

VI. Assim, $\sqrt{T-w+1} (\bar{LR}_{cc} - 2) \rightarrow N(0, \sigma^2)$. ‚ñ†

> üí° **Exemplo Num√©rico (Janela Deslizante):** Considere um backtesting de 1000 dias e uma janela deslizante de 250 dias. Para cada dia $t$ entre 250 e 1000, calculamos $LR_{cc,t}$ com base nos dados dos 250 dias anteriores.  Ent√£o, calculamos a m√©dia $\bar{LR}_{cc}$ e sua vari√¢ncia amostral. O Teorema 8.2 garante que a distribui√ß√£o de $\bar{LR}_{cc}$ pode ser aproximada por uma distribui√ß√£o normal. Isso nos permite construir intervalos de confian√ßa e realizar testes de hip√≥teses para avaliar a adequa√ß√£o do modelo ao longo do tempo.

**Corol√°rio 8.3:** O Teorema 8.2 permite testar a hip√≥tese de que o modelo de VaR √© adequado utilizando uma abordagem de janela deslizante, ao inv√©s de considerar apenas um per√≠odo de *backtesting*. Essa abordagem permite detectar altera√ß√µes na adequa√ß√£o do modelo ao longo do tempo.

**Proposi√ß√£o 8.3:** √â poss√≠vel construir intervalos de confian√ßa para a estat√≠stica $LR_{cc}$ baseada na distribui√ß√£o assint√≥tica $\chi^2(2)$. Um intervalo de confian√ßa de $1-\alpha$ pode ser constru√≠do utilizando o quantil $q$ da distribui√ß√£o $\chi^2(2)$ de tal forma que $P(\chi^2(2) < q) = 1-\alpha$.  O intervalo de confian√ßa ser√° $[0, q]$. Se o valor de $LR_{cc}$ estiver fora desse intervalo, rejeitamos a hip√≥tese nula de que o modelo de VaR √© adequado.
> üí° **Exemplo Num√©rico (Intervalo de Confian√ßa):** Utilizando um n√≠vel de signific√¢ncia de 5%, o valor cr√≠tico de $\chi^2(2)$ √© 5.991. Logo, um intervalo de confian√ßa de 95% para a estat√≠stica $LR_{cc}$ √© $[0, 5.991]$. Se o valor observado de $LR_{cc}$ for maior que 5.991, rejeitamos a hip√≥tese nula.
>
> **Visualiza√ß√£o:**
>
> ```mermaid
> graph LR
>     A[0] --> B(5.991);
>     B --> C[Rejeitar Hip√≥tese Nula];
>     D[Valor de LRcc] -->|Se D > B| C;
>     D -->|Se D <= B| E[N√£o Rejeitar Hip√≥tese Nula];
>     A --> E
> ```
> O diagrama acima ilustra como o valor de $LR_{cc}$ √© comparado ao valor cr√≠tico para tomada de decis√£o.

**Lema 8.5:** O uso de m√©todos de estima√ß√£o da densidade, como o *kernel density estimation*, pode fornecer uma vis√£o mais detalhada da distribui√ß√£o da estat√≠stica $LR_{cc}$, particularmente em casos onde as aproxima√ß√µes assint√≥ticas n√£o s√£o v√°lidas ou em presen√ßa de depend√™ncia temporal complexa.

### Conclus√£o
Em resumo, o teste combinado para cobertura condicional, baseado na estat√≠stica $LR_{cc}$, √© uma ferramenta valiosa para a valida√ß√£o de modelos de VaR, pois integra informa√ß√µes sobre a frequ√™ncia geral de exce√ß√µes (via $LR_{uc}$) e sobre a depend√™ncia temporal dessas exce√ß√µes (via $LR_{ind}$). A estat√≠stica $LR_{cc}$ fornece uma avalia√ß√£o abrangente da adequa√ß√£o do modelo, permitindo identificar se este √© inadequado seja por erros na calibra√ß√£o do n√≠vel de confian√ßa, seja por n√£o capturar corretamente a din√¢mica das exce√ß√µes no tempo. A aplica√ß√£o desse teste permite uma gest√£o de risco mais eficaz e robusta, garantindo que os modelos de VaR sejam precisos, confi√°veis e capazes de refletir a din√¢mica de risco de forma adequada. A an√°lise da distribui√ß√£o da estat√≠stica $LR_{cc}$ permite testar as hip√≥teses sobre a qualidade do modelo de forma rigorosa, assegurando que as institui√ß√µes financeiras estejam equipadas com ferramentas de valida√ß√£o que permitam identificar e corrigir poss√≠veis inadequa√ß√µes em tempo h√°bil.

### Refer√™ncias
[^1]: Cap√≠tulo 6 do texto fornecido.
<!-- END -->
