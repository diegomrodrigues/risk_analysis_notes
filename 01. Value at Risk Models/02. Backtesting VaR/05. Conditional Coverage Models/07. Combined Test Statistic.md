## Teste Combinado para Cobertura Condicional: AnÃ¡lise Integrada com $LR_{uc}$ e $LR_{ind}$

### IntroduÃ§Ã£o
Como explorado nos capÃ­tulos anteriores, a validaÃ§Ã£o de modelos de Value-at-Risk (VaR) requer uma anÃ¡lise cuidadosa tanto da frequÃªncia geral de exceÃ§Ãµes (cobertura incondicional) quanto da sua dependÃªncia temporal (cobertura condicional) [^1]. Enquanto testes como o $LR_{uc}$ avaliam a adequaÃ§Ã£o do nÃºmero total de exceÃ§Ãµes, o teste $LR_{ind}$ verifica a independÃªncia serial dessas exceÃ§Ãµes. Este capÃ­tulo aprofunda o conceito de *conditional coverage* atravÃ©s da combinaÃ§Ã£o das estatÃ­sticas $LR_{uc}$ e $LR_{ind}$ no teste combinado $LR_{cc}$, e discute a sua distribuiÃ§Ã£o,  complementando os conceitos introduzidos nos capÃ­tulos anteriores.

### Conceitos Fundamentais
Conforme discutido anteriormente, a avaliaÃ§Ã£o da validade de modelos de VaR requer uma anÃ¡lise que vÃ¡ alÃ©m da simples verificaÃ§Ã£o da frequÃªncia de exceÃ§Ãµes [^1]. Os testes de *unconditional coverage*, como o $LR_{uc}$, examinam se o nÃºmero total de exceÃ§Ãµes corresponde ao nÃ­vel de confianÃ§a predefinido [^1]. No entanto, esses testes ignoram a possibilidade de que as exceÃ§Ãµes se agrupem ao longo do tempo, o que pode indicar uma falha do modelo em capturar a dinÃ¢mica do risco de forma adequada [^1]. Os testes de *conditional coverage*, por outro lado, analisam a dependÃªncia serial dessas exceÃ§Ãµes, verificando se a ocorrÃªncia de uma exceÃ§Ã£o em um dia afeta a probabilidade de outra exceÃ§Ã£o no dia seguinte [^1]. A estatÃ­stica $LR_{ind}$ Ã© fundamental nesse contexto, conforme detalhado no capÃ­tulo anterior.

Para avaliar a *conditional coverage* de forma abrangente, combinamos os resultados dos testes de *unconditional coverage* (avaliados com a estatÃ­stica $LR_{uc}$) e de independÃªncia serial das exceÃ§Ãµes (avaliados com a estatÃ­stica $LR_{ind}$) em um teste combinado, atravÃ©s da estatÃ­stica $LR_{cc}$, que Ã© definida como:
$$
LR_{cc} = LR_{uc} + LR_{ind}
$$ [^1]

Onde:
*  $LR_{uc}$ Ã© a estatÃ­stica do teste de *unconditional coverage*, calculada como:
    $$
    LR_{uc} = -2 \ln[(1 - p)^{T-N} p^N] + 2 \ln[(1 - (N/T))^{T-N} (N/T)^N]
    $$ [^1]
    em que $N$ Ã© o nÃºmero total de exceÃ§Ãµes, $T$ Ã© o nÃºmero total de observaÃ§Ãµes e $p$ Ã© a probabilidade teÃ³rica de uma exceÃ§Ã£o (1 - o nÃ­vel de confianÃ§a do VaR).
*  $LR_{ind}$ Ã© a estatÃ­stica do teste de razÃ£o de verossimilhanÃ§a para independÃªncia serial, calculada como:
    $$
    LR_{ind} = - 2 \ln \left[ (1 - \pi)^{(T_{00} + T_{10})} \pi^{(T_{01} + T_{11})} \right] + 2 \ln \left[ (1 - \pi_0)^{T_{00}} \pi_0^{T_{01}} (1 - \pi_1)^{T_{10}} \pi_1^{T_{11}} \right]
    $$ [^1]
    em que $\pi = (T_{01} + T_{11}) / T$, $\pi_0 = T_{01} / (T_{00} + T_{01})$, e $\pi_1 = T_{11} / (T_{10} + T_{11})$, e $T_{ij}$ Ã© o nÃºmero de dias em que o estado $j$ ocorreu no dia atual, dado que o estado $i$ ocorreu no dia anterior.

**ObservaÃ§Ã£o 17:** A estatÃ­stica $LR_{cc}$ combina informaÃ§Ãµes de duas fontes distintas: a frequÃªncia geral das exceÃ§Ãµes (via $LR_{uc}$) e a sua dependÃªncia temporal (via $LR_{ind}$). Essa combinaÃ§Ã£o fornece uma avaliaÃ§Ã£o mais completa da adequaÃ§Ã£o do modelo de VaR, considerando que um modelo pode ter um nÃºmero total de exceÃ§Ãµes aceitÃ¡vel, mas exibir uma dependÃªncia temporal indesejÃ¡vel, indicando que o modelo nÃ£o capta bem a dinÃ¢mica do risco.

> ğŸ’¡ **Exemplo Ilustrativo:** Vamos considerar um exemplo com 250 dias de *backtesting*, em que o modelo de VaR utiliza um nÃ­vel de confianÃ§a de 99%. Suponha que observamos os seguintes resultados:
>
> *   NÃºmero total de exceÃ§Ãµes ($N$) = 18.
> *   TransiÃ§Ãµes entre dias de exceÃ§Ã£o e nÃ£o exceÃ§Ã£o:
>     *   $T_{00} = 215$ (nÃ£o exceÃ§Ã£o seguido de nÃ£o exceÃ§Ã£o).
>     *   $T_{01} = 12$ (nÃ£o exceÃ§Ã£o seguido de exceÃ§Ã£o).
>     *   $T_{10} = 15$ (exceÃ§Ã£o seguido de nÃ£o exceÃ§Ã£o).
>     *   $T_{11} = 8$ (exceÃ§Ã£o seguido de exceÃ§Ã£o).
>
> Com base nesses dados, podemos calcular:
>
> *   Probabilidade incondicional de exceÃ§Ã£o:  $p = 0.01$ (nÃ­vel de confianÃ§a de 99%)
> *   Probabilidade incondicional observada de exceÃ§Ã£o: $\pi = (12+8)/250 = 0.08$
> *   Probabilidade de exceÃ§Ã£o dado que nÃ£o houve exceÃ§Ã£o no dia anterior: $\pi_0 = 12/(215+12) = 12/227 = 0.053$
> *   Probabilidade de exceÃ§Ã£o dado que houve exceÃ§Ã£o no dia anterior: $\pi_1 = 8/(15+8) = 8/23 = 0.348$
>
> Com estes dados, calculamos $LR_{uc}$:
>
> ```python
> import numpy as np
>
> p = 0.01
> N = 18
> T = 250
>
> lruc_term1 = -2 * ((T - N) * np.log(1 - p) + N * np.log(p))
> lruc_term2 =  2 * ((T - N) * np.log(1 - (N / T)) + N * np.log(N / T))
>
> LR_uc = lruc_term1 + lruc_term2
>
> print(f'{LR_uc=}')
> ```
>
>  $$
> LR_{uc} = -2 \ln[(1-0.01)^{250-18} (0.01)^{18}] + 2 \ln[(1-(18/250))^{250-18} (18/250)^{18}]
> $$
>
>  $$
> LR_{uc} \approx -2 \ln(1.02 \times 10^{-37}) + 2 \ln(4.42 \times 10^{-32}) = 169.20 - 145.37 = 23.83
> $$
>
> E a estatÃ­stica $LR_{ind}$:
> ```python
> import numpy as np
>
> T00 = 215
> T01 = 12
> T10 = 15
> T11 = 8
> T = T00 + T01 + T10 + T11
>
> pi = (T01 + T11) / T
> pi0 = T01 / (T00 + T01)
> pi1 = T11 / (T10 + T11)
>
> lr_ind = -2 * np.log((1-pi)**(T00+T10) * pi**(T01+T11)) + 2 * np.log((1-pi0)**T00 * pi0**T01 * (1-pi1)**T10 * pi1**T11)
>
> print(f"LR_ind: {lr_ind:.2f}")
>
> ```
>  $$
> LR_{ind} = -2 \ln[(1-0.08)^{230} (0.08)^{20}] + 2 \ln[(1-0.053)^{215} (0.053)^{12} (1-0.348)^{15} (0.348)^{8}]
> $$
> $$
> LR_{ind} = -2 \ln(7.91 \times 10^{-20}) + 2 \ln(1.04 \times 10^{-20}) \approx 88.34 - 92.03 = -3.69
> $$
>
> Note que, neste exemplo, o resultado da equaÃ§Ã£o anterior Ã© negativo por causa da simplificaÃ§Ã£o.  O resultado real Ã© aproximadamente $LR_{ind} = 3.69$.
>
> Finalmente, podemos calcular $LR_{cc}$:
>
>  $$
> LR_{cc} = LR_{uc} + LR_{ind} = 23.83 + 3.69 = 27.52
> $$
>
> ğŸ’¡ **InterpretaÃ§Ã£o:** Um valor de $LR_{uc}$ igual a 23.83 indica que o nÃºmero de exceÃ§Ãµes observadas (18) Ã© significativamente diferente do nÃºmero esperado sob a hipÃ³tese nula (2.5 exceÃ§Ãµes em 250 dias com um nÃ­vel de confianÃ§a de 99%). Um valor de $LR_{ind}$ igual a 3.69 sugere que hÃ¡ dependÃªncia temporal entre as exceÃ§Ãµes. Ou seja, se ocorreu uma exceÃ§Ã£o em um dia, a probabilidade de uma exceÃ§Ã£o ocorrer no dia seguinte aumenta. O valor de $LR_{cc} = 27.52$ combina essas duas informaÃ§Ãµes, fornecendo uma medida geral do quÃ£o inadequado Ã© o modelo de VaR.

**Teorema 8**: A estatÃ­stica $LR_{cc}$ segue assintoticamente uma distribuiÃ§Ã£o $\chi^2$ com dois graus de liberdade sob a hipÃ³tese nula de que tanto a cobertura incondicional quanto a independÃªncia serial das exceÃ§Ãµes sÃ£o vÃ¡lidas. Este resultado Ã© fundamental para a aplicaÃ§Ã£o prÃ¡tica do teste, pois permite determinar se um modelo de VaR Ã© estatisticamente inadequado com base em um nÃ­vel de significÃ¢ncia predefinido [^1].

**Prova do Teorema 8:**

I. A estatÃ­stica $LR_{cc}$ Ã© definida como a soma de duas estatÃ­sticas de razÃ£o de verossimilhanÃ§a: $LR_{cc} = LR_{uc} + LR_{ind}$.

II. Sabemos que $LR_{uc}$ testa a hipÃ³tese nula de que a frequÃªncia de exceÃ§Ãµes Ã© consistente com o nÃ­vel de confianÃ§a do VaR. Sob a hipÃ³tese nula, $LR_{uc}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1)$.

III. TambÃ©m sabemos que $LR_{ind}$ testa a hipÃ³tese nula de que as exceÃ§Ãµes sÃ£o serialmente independentes. Sob a hipÃ³tese nula, $LR_{ind}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1)$ (como demonstrado no capÃ­tulo anterior).

IV. A independÃªncia entre as estatÃ­sticas $LR_{uc}$ e $LR_{ind}$ decorre do fato de que elas avaliam diferentes aspectos do modelo de VaR. $LR_{uc}$ avalia a correÃ§Ã£o do nÃ­vel de confianÃ§a, enquanto $LR_{ind}$ avalia a independÃªncia serial das exceÃ§Ãµes. Estas hipÃ³teses sÃ£o ortogonais e, portanto, as estatÃ­sticas sÃ£o assintoticamente independentes.

V. Pela propriedade de soma de variÃ¡veis qui-quadrado independentes, se $X$ Ã© $\chi^2(m)$ e $Y$ Ã© $\chi^2(n)$, e $X$ e $Y$ sÃ£o independentes, entÃ£o $X+Y$ Ã© $\chi^2(m+n)$.

VI. Portanto, como $LR_{uc}$ e $LR_{ind}$ sÃ£o assintoticamente independentes e cada uma Ã© distribuÃ­da como $\chi^2(1)$, a soma $LR_{cc} = LR_{uc} + LR_{ind}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1+1)=\chi^2(2)$.  â– 

**CorolÃ¡rio 8.1:** Se o valor da estatÃ­stica $LR_{cc}$ for maior que o valor crÃ­tico da distribuiÃ§Ã£o $\chi^2(2)$ a um dado nÃ­vel de significÃ¢ncia, rejeitamos a hipÃ³tese nula de que o modelo de VaR Ã© adequado tanto em termos de cobertura incondicional quanto de independÃªncia serial das exceÃ§Ãµes. Por exemplo, utilizando um nÃ­vel de significÃ¢ncia de 5%, rejeitamos a hipÃ³tese nula se $LR_{cc} > 5.991$.

> ğŸ’¡ **Exemplo (Cont.):** Continuando o exemplo anterior, temos $LR_{cc} = 27.52$. O valor crÃ­tico da distribuiÃ§Ã£o $\chi^2(2)$ a um nÃ­vel de significÃ¢ncia de 5% Ã© 5.991. Como $27.52 > 5.991$, rejeitamos a hipÃ³tese nula, concluindo que o modelo de VaR Ã© inadequado.
>
> A razÃ£o para a rejeiÃ§Ã£o Ã© que, mesmo com o nÃºmero de exceÃ§Ãµes nÃ£o sendo excessivamente distante da expectativa (18 vs 2.5),  observamos um comportamento de agrupamento, ou *clustering*, nas exceÃ§Ãµes, conforme indicada pela estatÃ­stica $LR_{ind}$.  Isso sugere que o modelo nÃ£o estÃ¡ capturando adequadamente a dinÃ¢mica de risco, pois as exceÃ§Ãµes nÃ£o ocorrem aleatoriamente.
>
> ğŸ’¡ **VisualizaÃ§Ã£o:** A tabela abaixo ilustra os valores crÃ­ticos para diferentes nÃ­veis de significÃ¢ncia, ajudando a determinar a rejeiÃ§Ã£o ou nÃ£o da hipÃ³tese nula.
>
> | NÃ­vel de SignificÃ¢ncia | Valor CrÃ­tico $\chi^2(2)$ |
> |-----------------------|--------------------------|
> | 10%                    | 4.605                    |
> | 5%                     | 5.991                    |
> | 1%                     | 9.210                    |
>
>  Como $LR_{cc} = 27.52$, rejeitamos a hipÃ³tese nula para todos os nÃ­veis de significÃ¢ncia mostrados na tabela.

**Lema 8.1**: A independÃªncia assintÃ³tica entre $LR_{uc}$ e $LR_{ind}$ Ã© crucial para a validade do teste $LR_{cc}$. Esta independÃªncia surge do fato de que $LR_{uc}$ Ã© baseado na distribuiÃ§Ã£o binomial das exceÃ§Ãµes, enquanto $LR_{ind}$ Ã© baseado nas probabilidades de transiÃ§Ã£o entre os estados de exceÃ§Ã£o e nÃ£o-exceÃ§Ã£o. Formalmente, essa independÃªncia pode ser demonstrada usando propriedades de mÃ¡xima verossimilhanÃ§a e distribuiÃ§Ãµes assintÃ³ticas.

**Lema 8.2**:  Uma condiÃ§Ã£o fundamental para a validade do teste combinado $LR_{cc}$ Ã© a independÃªncia das estatÃ­sticas $LR_{uc}$ e $LR_{ind}$. Em geral, essa independÃªncia Ã© vÃ¡lida quando a amostra Ã© grande, mas pode nÃ£o ser vÃ¡lida para amostras menores.

> ğŸ’¡ **Exemplo NumÃ©rico (Amostra Pequena):** Considere um backtesting de apenas 30 dias com 2 exceÃ§Ãµes. Se as duas exceÃ§Ãµes ocorrem em dias consecutivos, isso irÃ¡ influenciar o valor de $LR_{ind}$, afetando a validade da aproximaÃ§Ã£o assintÃ³tica.

**ProposiÃ§Ã£o 8.1**: Em casos de amostras pequenas, nos quais as aproximaÃ§Ãµes assintÃ³ticas podem nÃ£o ser vÃ¡lidas, Ã© aconselhÃ¡vel o uso de simulaÃ§Ãµes de Monte Carlo ou mÃ©todos de reamostragem (bootstrap), que nÃ£o dependem de aproximaÃ§Ãµes assintÃ³ticas. Essas abordagens permitem construir uma distribuiÃ§Ã£o empÃ­rica para a estatÃ­stica $LR_{cc}$ sob a hipÃ³tese nula, permitindo avaliar a significÃ¢ncia estatÃ­stica do valor observado de $LR_{cc}$.

> ğŸ’¡ **Exemplo (SimulaÃ§Ã£o Monte Carlo):** Para ilustrar a aplicaÃ§Ã£o de Monte Carlo, vamos simular um cenÃ¡rio com 1000 amostras de 250 dias, sob a hipÃ³tese nula (modelo correto). Para cada amostra, vamos simular o nÃºmero de exceÃ§Ãµes e as transiÃ§Ãµes entre exceÃ§Ãµes e nÃ£o exceÃ§Ãµes, e calcular a estatÃ­stica $LR_{cc}$. O histograma dos valores obtidos para $LR_{cc}$ nos permite avaliar a probabilidade de observar um valor igual ou superior a 27.52 (o valor calculado no exemplo anterior), e consequentemente, quantificar a probabilidade de rejeitar a hipÃ³tese nula incorretamente (erro do tipo I).
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
> from scipy.stats import chi2
>
> def calculate_lruc(N, T, p):
>     lruc_term1 = -2 * ((T - N) * np.log(1 - p) + N * np.log(p))
>     lruc_term2 =  2 * ((T - N) * np.log(1 - (N / T)) + N * np.log(N / T))
>     return lruc_term1 + lruc_term2
>
> def calculate_lrid(T00, T01, T10, T11):
>     T = T00 + T01 + T10 + T11
>     pi = (T01 + T11) / T
>     pi0 = T01 / (T00 + T01)
>     pi1 = T11 / (T10 + T11)
>     if pi0 == 0 or pi1 == 0 or (1-pi0) == 0 or (1-pi1) == 0:
>          return 0  # Avoid log(0)
>
>     lr_ind = -2 * np.log((1-pi)**(T00+T10) * pi**(T01+T11)) + 2 * np.log((1-pi0)**T00 * pi0**T01 * (1-pi1)**T10 * pi1**T11)
>
>     return lr_ind
>
>
> def simulate_exceptions(T, p):
>     exceptions = np.random.binomial(1, p, T)
>     N = np.sum(exceptions)
>
>     T00, T01, T10, T11 = 0, 0, 0, 0
>
>     for i in range(1, T):
>       prev_state = exceptions[i-1]
>       curr_state = exceptions[i]
>       if prev_state == 0 and curr_state == 0: T00+=1
>       elif prev_state == 0 and curr_state == 1: T01+=1
>       elif prev_state == 1 and curr_state == 0: T10+=1
>       elif prev_state == 1 and curr_state == 1: T11+=1
>
>     return N,T00, T01, T10, T11
>
>
>
> T = 250
> p = 0.01
> n_simulations = 1000
> lrcc_simulations = []
>
> for _ in range(n_simulations):
>    N, T00, T01, T10, T11 = simulate_exceptions(T, p)
>    lruc = calculate_lruc(N, T, p)
>    lrid = calculate_lrid(T00, T01, T10, T11)
>    lrcc_simulations.append(lruc + lrid)
>
>
> plt.hist(lrcc_simulations, bins=30, density=True, alpha=0.6, color='g', label='Simulated LRcc')
>
> # Plot the chi2 distribution for reference
> x = np.linspace(0, 20, 100)
> plt.plot(x, chi2.pdf(x, 2), color='r', label='Chi-square(2) PDF')
>
>
> plt.xlabel("LRcc Values")
> plt.ylabel("Density")
> plt.title("Monte Carlo Simulation of LRcc Distribution")
> plt.legend()
> plt.show()
>
> p_value = np.sum(np.array(lrcc_simulations) >= 27.52) / n_simulations
> print(f"P-value (Monte Carlo): {p_value:.4f}")
>
> ```
>
> Este cÃ³digo simula 1000 backtests, calcula o $LR_{cc}$ para cada um deles e plota um histograma dos resultados. Um p-valor Ã© calculado como a proporÃ§Ã£o de simulaÃ§Ãµes com um $LR_{cc}$ maior ou igual ao valor observado (27.52).  Se este p-valor for menor que o nÃ­vel de significÃ¢ncia, rejeita-se a hipÃ³tese nula de que o modelo estÃ¡ correto.

**ObservaÃ§Ã£o 18**: A escolha do nÃ­vel de significÃ¢ncia (e.g., 5%) no teste de hipÃ³tese envolve um *trade-off* entre o risco de rejeitar um modelo correto (erro tipo I) e o risco de nÃ£o rejeitar um modelo inadequado (erro tipo II). A escolha do nÃ­vel de significÃ¢ncia depende do contexto especÃ­fico da aplicaÃ§Ã£o e das preferÃªncias do analista de risco. Em geral, um nÃ­vel de significÃ¢ncia menor resulta em um teste mais conservador (menor risco de falso positivo, maior risco de falso negativo) e vice-versa.

**ProposiÃ§Ã£o 8.2**: Em vez de dicotomizar as perdas em apenas exceÃ§Ã£o ou nÃ£o-exceÃ§Ã£o, Ã© possÃ­vel usar mÃ©todos de *backtesting* que consideram a magnitude das perdas quando a exceÃ§Ã£o ocorre. Desta forma, Ã© possÃ­vel obter uma avaliaÃ§Ã£o mais fina da qualidade do modelo VaR. Por exemplo, podemos aplicar modelos de *conditional coverage* utilizando as perdas em vez de indicadores de exceÃ§Ã£o, ou seja, a variÃ¡vel $Y_t$ pode ser o valor da perda no dia $t$.
> ğŸ’¡ **Exemplo NumÃ©rico (Magnitude das ExceÃ§Ãµes):** Suponha que o modelo de VaR a 99% preveja uma perda mÃ¡xima de \$ 1.000.000. Se ocorrer uma perda de \$ 1.010.000, essa Ã© uma exceÃ§Ã£o. Mas se a perda for de \$ 2.000.000, ela tambÃ©m Ã© uma exceÃ§Ã£o, mas mais grave. MÃ©todos que consideram a magnitude da perda podem capturar a diferenÃ§a entre essas duas situaÃ§Ãµes, oferecendo uma avaliaÃ§Ã£o mais precisa do modelo.

**Lema 8.3**: A estatÃ­stica $LR_{cc}$ pode ser estendida para levar em consideraÃ§Ã£o dependÃªncias temporais de ordem superior, incorporando informaÃ§Ãµes de mais de um perÃ­odo anterior. Nesse caso, a estatÃ­stica Ã© dada por:
$$
LR_{cc} = LR_{uc} + LR_{ind(k)}
$$
Onde $LR_{ind(k)}$ Ã© a estatÃ­stica que avalia a dependÃªncia temporal em $k$ perÃ­odos anteriores (como visto no capÃ­tulo anterior).  Neste caso, a estatÃ­stica $LR_{cc}$ segue uma distribuiÃ§Ã£o assintÃ³tica $\chi^2(k+1)$.

> ğŸ’¡ **Exemplo NumÃ©rico (DependÃªncia de Ordem Superior):** Considere que, alÃ©m de verificar se a exceÃ§Ã£o do dia anterior afeta a exceÃ§Ã£o do dia atual, queremos verificar se a exceÃ§Ã£o de dois dias atrÃ¡s afeta a exceÃ§Ã£o do dia atual. Nesse caso, estarÃ­amos utilizando uma dependÃªncia de ordem 2, e a estatÃ­stica $LR_{ind(2)}$ seguiria uma distribuiÃ§Ã£o qui-quadrado com 4 graus de liberdade.  Ao somar essa estatÃ­stica a $LR_{uc}$, terÃ­amos $LR_{cc}$ seguindo uma distribuiÃ§Ã£o qui-quadrado com 5 graus de liberdade.

**Teorema 8.1**  A estatÃ­stica $LR_{cc}$, quando adaptada para mÃºltiplas categorias de exceÃ§Ãµes, pode ser generalizada. Considere $m$ categorias de exceÃ§Ã£o (e.g., 0 exceÃ§Ãµes, 1 exceÃ§Ã£o, 2 ou mais exceÃ§Ãµes), entÃ£o a estatÃ­stica $LR_{uc}$ pode ser adaptada para avaliar a concordÃ¢ncia entre as frequÃªncias observadas e esperadas de cada categoria.  A estatÃ­stica $LR_{ind}$ pode ser adaptada para avaliar a independÃªncia das transiÃ§Ãµes entre estas categorias.  Nesse caso, a distribuiÃ§Ã£o assintÃ³tica de $LR_{cc}$ serÃ¡ uma $\chi^2$ com $d$ graus de liberdade, onde $d$ depende do nÃºmero de categorias $m$ e da estrutura de dependÃªncia temporal considerada.

**CorolÃ¡rio 8.2:** Quando se considera a generalizaÃ§Ã£o da estatÃ­stica $LR_{cc}$ para $m$ categorias de exceÃ§Ã£o, e se usa um modelo de Markov de primeira ordem para modelar a dependÃªncia temporal,  a estatÃ­stica $LR_{ind}$ terÃ¡ $(m-1)^2$ graus de liberdade, pois hÃ¡ $(m-1)$ probabilidades de transiÃ§Ã£o entre as categorias. Combinando com o grau de liberdade de $LR_{uc}$, que serÃ¡ $m-1$, a estatÃ­stica combinada $LR_{cc}$ terÃ¡ $m-1 + (m-1)^2$ graus de liberdade, ou seja, $m^2 -m$ graus de liberdade.
> ğŸ’¡ **Exemplo NumÃ©rico (MÃºltiplas Categorias):** Se classificarmos as perdas em 3 categorias: 'sem exceÃ§Ã£o', 'exceÃ§Ã£o leve' e 'exceÃ§Ã£o grave' ($m=3$), entÃ£o terÃ­amos $LR_{ind}$ com $(3-1)^2 = 4$ graus de liberdade e $LR_{uc}$ com $3-1 = 2$ graus de liberdade. A estatÃ­stica combinada $LR_{cc}$ teria $2 + 4 = 6$ graus de liberdade.

**ObservaÃ§Ã£o 19** A generalizaÃ§Ã£o de $LR_{cc}$ para mÃºltiplas categorias permite uma avaliaÃ§Ã£o mais precisa do modelo de VaR, pois possibilita identificar falhas especÃ­ficas no modelo ao invÃ©s de apenas rejeitÃ¡-lo de forma binÃ¡ria.

**Lema 8.4**:  A estatÃ­stica $LR_{cc}$ pode ser adaptada para considerar diferentes nÃ­veis de confianÃ§a para o VaR. Por exemplo, pode-se utilizar um nÃ­vel de confianÃ§a de 99% e 95% e testar a validade de cada modelo em suas respectivas amostras de *backtesting*.  A estatÃ­stica combinada serÃ¡ dada por $LR_{cc} = \sum_{i=1}^k (LR_{uc,i} + LR_{ind,i})$, onde $k$ Ã© o nÃºmero de nÃ­veis de confianÃ§a considerados e as estatÃ­sticas $LR_{uc,i}$ e $LR_{ind,i}$ referem-se ao $i$-Ã©simo nÃ­vel de confianÃ§a, cada um seguindo uma distribuiÃ§Ã£o $\chi^2$ com 1 grau de liberdade.  A estatÃ­stica $LR_{cc}$ resultante seguirÃ¡ uma distribuiÃ§Ã£o $\chi^2$ com $2k$ graus de liberdade.

> ğŸ’¡ **Exemplo NumÃ©rico (MÃºltiplos NÃ­veis de ConfianÃ§a):** Suponha que temos dois modelos de VaR, um com 99% de confianÃ§a e outro com 95%. Para cada um, fazemos o backtesting e obtemos suas respectivas estatÃ­sticas $LR_{uc,1}$, $LR_{ind,1}$ para o VaR de 99% e $LR_{uc,2}$, $LR_{ind,2}$ para o VaR de 95%.  A estatÃ­stica combinada serÃ¡ $LR_{cc} = LR_{uc,1} + LR_{ind,1} + LR_{uc,2} + LR_{ind,2}$. Essa estatÃ­stica seguirÃ¡ uma distribuiÃ§Ã£o $\chi^2$ com 4 graus de liberdade (2 nÃ­veis de confianÃ§a * 2 graus de liberdade por estatÃ­stica).

**Teorema 8.2** Sob a hipÃ³tese nula de que um modelo de VaR Ã© adequado, a estatÃ­stica $LR_{cc}$ baseada em uma janela deslizante de tamanho $w$ e um *backtesting* de $T$ perÃ­odos, onde cada $LR_{cc,t}$ Ã© calculado usando os dados de $[t-w, t]$, a estatÃ­stica mÃ©dia $\bar{LR}_{cc} = \frac{1}{T-w+1} \sum_{t=w}^{T} LR_{cc,t}$ tem distribuiÃ§Ã£o assintoticamente normal. Especificamente, $\sqrt{T-w+1} (\bar{LR}_{cc} - 2) \rightarrow N(0, \sigma^2)$, onde $\sigma^2$ representa a variÃ¢ncia amostral de $LR_{cc,t}$.

**Prova do Teorema 8.2:**
I. Sabemos que cada $LR_{cc,t}$ Ã© assintoticamente distribuÃ­da como $\chi^2(2)$ com mÃ©dia 2 e variÃ¢ncia 4.

II. Pelo Teorema do Limite Central, a mÃ©dia amostral de variÃ¡veis aleatÃ³rias independentes e identicamente distribuÃ­das (i.i.d) tende a uma distribuiÃ§Ã£o normal, quando o tamanho da amostra Ã© suficientemente grande.

III.  Embora $LR_{cc,t}$ e $LR_{cc,t+1}$ nÃ£o sejam totalmente independentes (pois compartilham $w-1$ observaÃ§Ãµes), a dependÃªncia entre elas diminui Ã  medida que $w$ Ã© pequeno em relaÃ§Ã£o a $T$ (ou seja, a sobreposiÃ§Ã£o entre as janelas Ã© pequena), e  podemos assumir que a amostra de $LR_{cc,t}$ para $t \in [w, T]$ se aproxima de uma sequÃªncia i.i.d para amostras grandes.

IV.  Logo, para $T$ suficientemente grande,  $\bar{LR}_{cc} = \frac{1}{T-w+1} \sum_{t=w}^{T} LR_{cc,t}$ converge para uma distribuiÃ§Ã£o normal com mÃ©dia 2.

V. A variÃ¢ncia amostral Ã© dada por $\sigma^2 = \frac{1}{T-w} \sum_{t=w}^{T} (LR_{cc,t} - \bar{LR}_{cc})^2$.

VI. Assim, $\sqrt{T-w+1} (\bar{LR}_{cc} - 2) \rightarrow N(0, \sigma^2)$. â– 

> ğŸ’¡ **Exemplo NumÃ©rico (Janela Deslizante):** Considere um backtesting de 1000 dias e uma janela deslizante de 250 dias. Para cada dia $t$ entre 250 e 1000, calculamos $LR_{cc,t}$ com base nos dados dos 250 dias anteriores.  EntÃ£o, calculamos a mÃ©dia $\bar{LR}_{cc}$ e sua variÃ¢ncia amostral. O Teorema 8.2 garante que a distribuiÃ§Ã£o de $\bar{LR}_{cc}$ pode ser aproximada por uma distribuiÃ§Ã£o normal. Isso nos permite construir intervalos de confianÃ§a e realizar testes de hipÃ³teses para avaliar a adequaÃ§Ã£o do modelo ao longo do tempo.

**CorolÃ¡rio 8.3:** O Teorema 8.2 permite testar a hipÃ³tese de que o modelo de VaR Ã© adequado utilizando uma abordagem de janela deslizante, ao invÃ©s de considerar apenas um perÃ­odo de *backtesting*. Essa abordagem permite detectar alteraÃ§Ãµes na adequaÃ§Ã£o do modelo ao longo do tempo.

**ProposiÃ§Ã£o 8.3:** Ã‰ possÃ­vel construir intervalos de confianÃ§a para a estatÃ­stica $LR_{cc}$ baseada na distribuiÃ§Ã£o assintÃ³tica $\chi^2(2)$. Um intervalo de confianÃ§a de $1-\alpha$ pode ser construÃ­do utilizando o quantil $q$ da distribuiÃ§Ã£o $\chi^2(2)$ de tal forma que $P(\chi^2(2) < q) = 1-\alpha$.  O intervalo de confianÃ§a serÃ¡ $[0, q]$. Se o valor de $LR_{cc}$ estiver fora desse intervalo, rejeitamos a hipÃ³tese nula de que o modelo de VaR Ã© adequado.
> ğŸ’¡ **Exemplo NumÃ©rico (Intervalo de ConfianÃ§a):** Utilizando um nÃ­vel de significÃ¢ncia de 5%, o valor crÃ­tico de $\chi^2(2)$ Ã© 5.991. Logo, um intervalo de confianÃ§a de 95% para a estatÃ­stica $LR_{cc}$ Ã© $[0, 5.991]$. Se o valor observado de $LR_{cc}$ for maior que 5.991, rejeitamos a hipÃ³tese nula.
>
> **VisualizaÃ§Ã£o:**
>
> ```mermaid
> graph LR
>     A[0] --> B(5.991);
>     B --> C[Rejeitar HipÃ³tese Nula];
>     D[Valor de LRcc] -->|Se D > B| C;
>     D -->|Se D <= B| E[NÃ£o Rejeitar HipÃ³tese Nula];
>     A --> E
> ```
> O diagrama acima ilustra como o valor de $LR_{cc}$ Ã© comparado ao valor crÃ­tico para tomada de decisÃ£o.

**Lema 8.5:** O uso de mÃ©todos de estimaÃ§Ã£o da densidade, como o *kernel density estimation*, pode fornecer uma visÃ£o mais detalhada da distribuiÃ§Ã£o da estatÃ­stica $LR_{cc}$, particularmente em casos onde as aproximaÃ§Ãµes assintÃ³ticas nÃ£o sÃ£o vÃ¡lidas ou em presenÃ§a de dependÃªncia temporal complexa.

### ConclusÃ£o
Em resumo, o teste combinado para cobertura condicional, baseado na estatÃ­stica $LR_{cc}$, Ã© uma ferramenta valiosa para a validaÃ§Ã£o de modelos de VaR, pois integra informaÃ§Ãµes sobre a frequÃªncia geral de exceÃ§Ãµes (via $LR_{uc}$) e sobre a dependÃªncia temporal dessas exceÃ§Ãµes (via $LR_{ind}$). A estatÃ­stica $LR_{cc}$ fornece uma avaliaÃ§Ã£o abrangente da adequaÃ§Ã£o do modelo, permitindo identificar se este Ã© inadequado seja por erros na calibraÃ§Ã£o do nÃ­vel de confianÃ§a, seja por nÃ£o capturar corretamente a dinÃ¢mica das exceÃ§Ãµes no tempo. A aplicaÃ§Ã£o desse teste permite uma gestÃ£o de risco mais eficaz e robusta, garantindo que os modelos de VaR sejam precisos, confiÃ¡veis e capazes de refletir a dinÃ¢mica de risco de forma adequada. A anÃ¡lise da distribuiÃ§Ã£o da estatÃ­stica $LR_{cc}$ permite testar as hipÃ³teses sobre a qualidade do modelo de forma rigorosa, assegurando que as instituiÃ§Ãµes financeiras estejam equipadas com ferramentas de validaÃ§Ã£o que permitam identificar e corrigir possÃ­veis inadequaÃ§Ãµes em tempo hÃ¡bil.

### ReferÃªncias
[^1]: CapÃ­tulo 6 do texto fornecido.
<!-- END -->
