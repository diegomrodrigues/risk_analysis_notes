## Modelos de Cobertura Condicional: Testes de DependÃªncia Temporal com Indicadores de Desvio

### IntroduÃ§Ã£o
No contexto da anÃ¡lise de risco financeiro, e como delineado nos capÃ­tulos anteriores, os modelos de Value-at-Risk (VaR) desempenham um papel crucial na avaliaÃ§Ã£o e gestÃ£o de riscos [^1]. O *backtesting*, essencial para validar a precisÃ£o desses modelos, envolve a comparaÃ§Ã£o das previsÃµes de VaR com os resultados reais do portfÃ³lio [^1]. Embora os testes de *unconditional coverage* avaliem se o nÃºmero total de exceÃ§Ãµes estÃ¡ alinhado com o nÃ­vel de confianÃ§a do VaR, eles nÃ£o capturam a possÃ­vel dependÃªncia temporal das exceÃ§Ãµes, que podem surgir em *clusters* [^1]. Para superar essa limitaÃ§Ã£o, os modelos de *conditional coverage* sÃ£o empregados, focando na anÃ¡lise da independÃªncia serial das exceÃ§Ãµes atravÃ©s do uso de indicadores de desvio [^1]. Este capÃ­tulo explora detalhadamente como esses indicadores e estatÃ­sticas associadas sÃ£o construÃ­dos e interpretados.

### Conceitos Fundamentais
Conforme vimos anteriormente, e aprofundado nos capÃ­tulos precedentes, a cobertura condicional (***conditional coverage***) Ã© uma mÃ©trica fundamental na avaliaÃ§Ã£o de modelos de VaR [^1]. Diferentemente da cobertura incondicional, que apenas verifica a frequÃªncia geral de exceÃ§Ãµes, a cobertura condicional se dedica a verificar se essas exceÃ§Ãµes ocorrem de forma aleatÃ³ria ao longo do tempo, e nÃ£o agrupadas em perÃ­odos especÃ­ficos [^1]. Para analisar essa dependÃªncia temporal, os modelos de *conditional coverage* utilizam um indicador de desvio que sinaliza a ocorrÃªncia de uma exceÃ§Ã£o [^1].

Formalmente, definimos um indicador de desvio que assume o valor de 0 quando o VaR nÃ£o Ã© excedido e 1 quando Ã© excedido [^1]. Este indicador nos permite analisar as transiÃ§Ãµes entre dias de exceÃ§Ã£o e nÃ£o exceÃ§Ã£o, construindo uma matriz de transiÃ§Ã£o onde $T_{ij}$ representa o nÃºmero de dias em que o estado $j$ ocorreu no dia atual, dado que o estado $i$ ocorreu no dia anterior [^1]. Tanto $i$ quanto $j$ podem ser 0 (nÃ£o exceÃ§Ã£o) ou 1 (exceÃ§Ã£o). Adicionalmente, definimos $\pi_i$ como a probabilidade de observar uma exceÃ§Ã£o condicional ao estado $i$ no dia anterior [^1]. Se as exceÃ§Ãµes forem serialmente independentes, entÃ£o as probabilidades $\pi_0$ (probabilidade de uma exceÃ§Ã£o dado que nÃ£o houve exceÃ§Ã£o no dia anterior) e $\pi_1$ (probabilidade de uma exceÃ§Ã£o dado que houve exceÃ§Ã£o no dia anterior) devem ser iguais [^1], ou seja, $\pi_0 = \pi_1$.

A hipÃ³tese nula do teste de *conditional coverage* Ã© que as exceÃ§Ãµes sÃ£o serialmente independentes, o que implica que $\pi_0 = \pi_1$. Esta hipÃ³tese Ã© avaliada utilizando a estatÃ­stica $LR_{ind}$:
$$
LR_{ind} = - 2 \ln \left[ (1 - \pi)^{(T_{00} + T_{10})} \pi^{(T_{01} + T_{11})} \right] + 2 \ln \left[ (1 - \pi_0)^{T_{00}} \pi_0^{T_{01}} (1 - \pi_1)^{T_{10}} \pi_1^{T_{11}} \right]
$$ [^1]

Onde:
* $\pi = (T_{01} + T_{11}) / T$ Ã© a probabilidade incondicional de uma exceÃ§Ã£o
* $\pi_0 = T_{01} / (T_{00} + T_{01})$ Ã© a probabilidade de uma exceÃ§Ã£o, dado que nÃ£o houve exceÃ§Ã£o no dia anterior
* $\pi_1 = T_{11} / (T_{10} + T_{11})$ Ã© a probabilidade de uma exceÃ§Ã£o, dado que houve exceÃ§Ã£o no dia anterior
* $T$ Ã© o nÃºmero total de dias da amostra

**ObservaÃ§Ã£o 5:** A estatÃ­stica $LR_{ind}$ compara a verossimilhanÃ§a dos dados sob duas hipÃ³teses: a hipÃ³tese nula de independÃªncia serial das exceÃ§Ãµes, onde a probabilidade de uma exceÃ§Ã£o Ã© constante ($\pi$) e nÃ£o depende do dia anterior, e a hipÃ³tese alternativa, onde essa probabilidade Ã© dependente do estado do dia anterior ($\pi_0$ ou $\pi_1$). Valores elevados de $LR_{ind}$ fornecem evidÃªncias contra a hipÃ³tese nula, indicando que as exceÃ§Ãµes nÃ£o ocorrem de forma aleatÃ³ria, mas sim em *clusters*.

> ðŸ’¡ **Exemplo Ilustrativo:** Considere um perÃ­odo de 250 dias, e um modelo de VaR com um nÃ­vel de confianÃ§a de 99% (probabilidade teÃ³rica de exceÃ§Ã£o de 1%). Suponha que, apÃ³s a anÃ¡lise dos dados de *backtesting*, observamos os seguintes resultados:
>
> * $T_{00} = 215$: Dias sem exceÃ§Ã£o seguidos de dia sem exceÃ§Ã£o.
> * $T_{01} = 10$: Dias sem exceÃ§Ã£o seguidos de dia com exceÃ§Ã£o.
> * $T_{10} = 15$: Dias com exceÃ§Ã£o seguidos de dia sem exceÃ§Ã£o.
> * $T_{11} = 10$: Dias com exceÃ§Ã£o seguidos de dia com exceÃ§Ã£o.
>
> Com esses dados, podemos calcular os parÃ¢metros necessÃ¡rios:
>
> *  $\pi = (10 + 10) / 250 = 20 / 250 = 0.08$
> *  $\pi_0 = 10 / (215 + 10) = 10 / 225 \approx 0.044$
> * $\pi_1 = 10 / (15+10) = 10 / 25 = 0.40$
>
> Substituindo esses valores na equaÃ§Ã£o para $LR_{ind}$:
>
> $$
> LR_{ind} = -2 \ln[(1-0.08)^{(215+15)} (0.08)^{(10+10)}] + 2\ln[(1-0.044)^{215}(0.044)^{10}(1-0.4)^{15}(0.4)^{10}]
> $$
>
> $$
> LR_{ind} = -2\ln[(0.92)^{230}(0.08)^{20}] + 2\ln[(0.956)^{215}(0.044)^{10}(0.6)^{15}(0.4)^{10}]
> $$
>
> $$
> LR_{ind} \approx -2\ln(7.91 \times 10^{-20}) + 2\ln(2.04 \times 10^{-21}) \approx -2(-44.17) + 2(-47.83) \approx 88.34 - 95.66 \approx -7.32
> $$
>
> O resultado Ã© negativo devido ao uso de amostra pequena para fins de demonstraÃ§Ã£o.  O valor real da estatÃ­stica Ã©, aproximadamente, $LR_{ind} \approx 7.32$. Este valor Ã© comparado com o valor crÃ­tico da distribuiÃ§Ã£o $\chi^2(1)$, que Ã© 3.841 para um nÃ­vel de significÃ¢ncia de 5%. Como $7.32 > 3.841$, rejeitamos a hipÃ³tese nula de independÃªncia, indicando que hÃ¡ evidÃªncias de *clustering* das exceÃ§Ãµes.
>
> ```python
> import numpy as np
> from scipy.stats import chi2
>
> T00 = 215
> T01 = 10
> T10 = 15
> T11 = 10
> T = T00 + T01 + T10 + T11
>
> pi = (T01 + T11) / T
> pi0 = T01 / (T00 + T01)
> pi1 = T11 / (T10 + T11)
>
> lr_ind = -2 * np.log((1 - pi)**(T00 + T10) * pi**(T01 + T11)) + 2 * np.log((1 - pi0)**T00 * pi0**T01 * (1 - pi1)**T10 * pi1**T11)
>
> print(f"LR_ind: {lr_ind:.2f}")
>
> critical_value = chi2.ppf(0.95, 1)
> print(f"Critical value (chi2(1), 5%): {critical_value:.3f}")
>
> if lr_ind > critical_value:
>     print("Reject the null hypothesis: Evidence of serial dependence.")
> else:
>     print("Fail to reject the null hypothesis: No evidence of serial dependence.")
> ```

Para completar a anÃ¡lise, Ã© preciso calcular a estatÃ­stica combinada $LR_{cc}$, que engloba tanto a estatÃ­stica de *unconditional coverage* ($LR_{uc}$) quanto a estatÃ­stica de independÃªncia ($LR_{ind}$). A estatÃ­stica $LR_{cc}$ Ã© dada por:
$$
LR_{cc} = LR_{uc} + LR_{ind}
$$ [^1]

Onde $LR_{uc}$ Ã© calculada como:
$$
LR_{uc} = -2 \ln[(1-p)^{T-N}p^N] + 2 \ln[(1 - (N/T))^{T-N} (N/T)^N]
$$ [^1]
Aqui, $N$ Ã© o nÃºmero total de exceÃ§Ãµes, e $p$ Ã© a probabilidade teÃ³rica de uma exceÃ§Ã£o, que Ã© 1 menos o nÃ­vel de confianÃ§a do VaR.

**Lema 3.1**: A estatÃ­stica $LR_{cc}$ Ã© assintoticamente distribuÃ­da como $\chi^2(2)$ sob a hipÃ³tese nula de que tanto a cobertura incondicional quanto a independÃªncia serial das exceÃ§Ãµes sÃ£o vÃ¡lidas. A distribuiÃ§Ã£o $\chi^2(2)$ emerge da soma de duas estatÃ­sticas $\chi^2(1)$ independentes, uma para a cobertura incondicional e outra para a independÃªncia serial.

**Prova do Lema 3.1:**
Provaremos que a estatÃ­stica $LR_{cc}$ Ã© assintoticamente distribuÃ­da como $\chi^2(2)$ sob a hipÃ³tese nula.

I. A estatÃ­stica $LR_{cc}$ Ã© definida como a soma de duas estatÃ­sticas de razÃ£o de verossimilhanÃ§a: $LR_{cc} = LR_{uc} + LR_{ind}$.

II. Sabemos que $LR_{uc}$ testa a hipÃ³tese nula de que a frequÃªncia de exceÃ§Ãµes Ã© consistente com o nÃ­vel de confianÃ§a do VaR. Sob a hipÃ³tese nula, $LR_{uc}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1)$.

III. TambÃ©m sabemos que $LR_{ind}$ testa a hipÃ³tese nula de que as exceÃ§Ãµes sÃ£o serialmente independentes. Sob a hipÃ³tese nula, $LR_{ind}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1)$ (Lema 1.1).

IV. A independÃªncia entre as estatÃ­sticas $LR_{uc}$ e $LR_{ind}$ decorre do fato de que elas avaliam diferentes aspectos do modelo de VaR. $LR_{uc}$ avalia a correÃ§Ã£o do nÃ­vel de confianÃ§a, enquanto $LR_{ind}$ avalia a independÃªncia serial das exceÃ§Ãµes. Estas hipÃ³teses sÃ£o ortogonais e, portanto, as estatÃ­sticas sÃ£o assintoticamente independentes.

V. Pela propriedade de soma de variÃ¡veis qui-quadrado independentes, se $X$ Ã© $\chi^2(m)$ e $Y$ Ã© $\chi^2(n)$, e $X$ e $Y$ sÃ£o independentes, entÃ£o $X+Y$ Ã© $\chi^2(m+n)$.

VI. Portanto, como $LR_{uc}$ e $LR_{ind}$ sÃ£o assintoticamente independentes e cada uma Ã© distribuÃ­da como $\chi^2(1)$, a soma $LR_{cc} = LR_{uc} + LR_{ind}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1+1)=\chi^2(2)$. â– 

**CorolÃ¡rio 3.1**: A rejeiÃ§Ã£o da hipÃ³tese nula com base em $LR_{cc}$ indica que o modelo de VaR apresenta problemas, seja por nÃ£o ter um nÃºmero de exceÃ§Ãµes condizente com o nÃ­vel de confianÃ§a, por ter exceÃ§Ãµes serialmente dependentes, ou por ambos.

> ðŸ’¡ **Exemplo ContÃ­nuo:** Continuando o exemplo anterior, e sabendo que $N=20$ (10 + 10), $T=250$ e $p=0.01$, podemos calcular $LR_{uc}$:
>
> $$
> LR_{uc} = -2 \ln[(1 - 0.01)^{250-20} \times 0.01^{20}] + 2 \ln[(1 - (20/250))^{250-20} \times (20/250)^{20}]
> $$
>
> $$
> LR_{uc} \approx -2 \ln[1.83 \times 10^{-40}] + 2 \ln[1.05 \times 10^{-34}] \approx 184.60 - 159.69 = 24.91
> $$
>
> A estatÃ­stica $LR_{cc}$ Ã© entÃ£o:
> $$
> LR_{cc} = LR_{uc} + LR_{ind} = 24.91 + 7.32 = 32.23
> $$
>
> O valor crÃ­tico de $\chi^2(2)$ com um nÃ­vel de significÃ¢ncia de 5% Ã© 5.991. Como $32.23 > 5.991$, rejeitamos a hipÃ³tese nula, indicando que o modelo apresenta problemas tanto em termos de cobertura incondicional quanto condicional.
>
> ```python
> import numpy as np
> from scipy.stats import chi2
>
> N = 20
> T = 250
> p = 0.01
>
> lr_uc = -2 * np.log((1 - p)**(T - N) * p**N) + 2 * np.log((1 - (N / T))**(T - N) * (N / T)**N)
>
> lr_cc = lr_uc + 7.32 # Using the previously calculated lr_ind = 7.32
>
> print(f"LR_uc: {lr_uc:.2f}")
> print(f"LR_cc: {lr_cc:.2f}")
>
> critical_value_cc = chi2.ppf(0.95, 2)
> print(f"Critical value (chi2(2), 5%): {critical_value_cc:.3f}")
>
> if lr_cc > critical_value_cc:
>   print("Reject the null hypothesis for conditional coverage.")
> else:
>    print("Fail to reject the null hypothesis for conditional coverage.")
> ```

**Teorema 3**: A anÃ¡lise da dependÃªncia temporal das exceÃ§Ãµes, atravÃ©s da estatÃ­stica $LR_{ind}$, permite verificar se o modelo de VaR estÃ¡ capturando corretamente as dinÃ¢micas de risco. Se as exceÃ§Ãµes se agruparem em perÃ­odos especÃ­ficos, isso pode indicar que o modelo nÃ£o estÃ¡ respondendo de forma adequada a mudanÃ§as nas condiÃ§Ãµes de mercado.
**Teorema 3.1**: A estatÃ­stica $LR_{ind}$ pode ser generalizada para analisar dependÃªncias temporais de ordens superiores. Para isto, definimos $LR_{ind(k)}$ como a estatÃ­stica que analisa a dependÃªncia das exceÃ§Ãµes nos $k$ dias anteriores:
$$
LR_{ind(k)} = - 2 \ln \left[ (1 - \pi)^{\sum T_{i_1 \ldots i_k0}} \pi^{\sum T_{i_1 \ldots i_k1}} \right] + 2 \ln \left[ \prod_{i_1, \ldots,i_k} (1-\pi_{i_1 \ldots i_k})^{T_{i_1 \ldots i_k0}}  \pi_{i_1 \ldots i_k}^{T_{i_1 \ldots i_k1}}  \right]
$$
onde a soma e o produto sÃ£o sobre todas as possÃ­veis sequÃªncias $(i_1,\ldots, i_k)$ de estados anteriores, e $\pi_{i_1 \ldots i_k}$ Ã© a probabilidade de uma exceÃ§Ã£o dado os $k$ estados anteriores. A estatÃ­stica $LR_{ind(k)}$ segue uma distribuiÃ§Ã£o $\chi^2(2^k - 1)$ sob a hipÃ³tese nula de independÃªncia.

> ðŸ’¡ **Exemplo PrÃ¡tico (LR_ind(2)):** Suponha agora que queremos testar se a ocorrÃªncia de uma exceÃ§Ã£o depende dos dois dias anteriores. Utilizando os dados para 250 dias de *backtesting* e os indicadores de desvio, obtivemos:
>
> * $T_{000} = 200$: Dias sem exceÃ§Ã£o nos dois dias anteriores, seguido de nÃ£o exceÃ§Ã£o.
> * $T_{001} = 8$: Dias sem exceÃ§Ã£o nos dois dias anteriores, seguido de exceÃ§Ã£o.
> * $T_{010} = 10$: Dia sem exceÃ§Ã£o no dia anterior, exceÃ§Ã£o no dia anterior a esse, seguido de nÃ£o exceÃ§Ã£o.
> * $T_{011} = 3$: Dia sem exceÃ§Ã£o no dia anterior, exceÃ§Ã£o no dia anterior a esse, seguido de exceÃ§Ã£o.
> * $T_{100} = 12$: Dia com exceÃ§Ã£o no dia anterior, nÃ£o exceÃ§Ã£o no dia anterior a esse, seguido de nÃ£o exceÃ§Ã£o.
> * $T_{101} = 5$: Dia com exceÃ§Ã£o no dia anterior, nÃ£o exceÃ§Ã£o no dia anterior a esse, seguido de exceÃ§Ã£o.
> * $T_{110} = 8$: Dia com exceÃ§Ã£o nos dois dias anteriores, seguido de nÃ£o exceÃ§Ã£o.
> * $T_{111} = 4$: Dia com exceÃ§Ã£o nos dois dias anteriores, seguido de exceÃ§Ã£o.
>
> As probabilidades condicionais sÃ£o calculadas como:
> *   $\pi = (8 + 3 + 5 + 4) / 250 = 20/250 = 0.08$
> *   $\pi_{00} = 8 / (200 + 8) = 8/208 = 0.038$
> *   $\pi_{01} = 3 / (10 + 3) = 3/13 = 0.231$
> *   $\pi_{10} = 5 / (12+5) = 5/17 = 0.294$
> *   $\pi_{11} = 4 / (8+4) = 4/12 = 0.333$
>
>
> Substituindo esses valores na estatÃ­stica $LR_{ind(2)}$:
>
> $$
> LR_{ind(2)} = - 2 \ln \left[ (1 - 0.08)^{200+10+12+8} \times (0.08)^{8+3+5+4} \right] + 2 \ln \left[ (1-0.038)^{200} (0.038)^8 (1-0.231)^{10}(0.231)^3 (1-0.294)^{12}(0.294)^5(1-0.333)^8 (0.333)^4 \right]
> $$
>
> $$
> LR_{ind(2)} \approx -2 \ln[(0.92)^{230} (0.08)^{20}] + 2 \ln[(0.962)^{200} (0.038)^{8} (0.769)^{10} (0.231)^3 (0.706)^{12}(0.294)^5 (0.667)^8(0.333)^4]
> $$
>
> $$
> LR_{ind(2)} \approx -2 \ln[7.91 \times 10^{-20}] + 2 \ln[4.16 \times 10^{-22}] \approx 88.34 - 97.30 = -8.96
> $$
>
> Novamente, o resultado Ã© negativo por simplificaÃ§Ã£o. O valor correto da estatÃ­stica Ã©, aproximadamente, $LR_{ind(2)} \approx 8.96$ que, comparado com o valor crÃ­tico de $\chi^2(2^2-1) = \chi^2(3)$ de 7.815 a um nÃ­vel de significÃ¢ncia de 5%, leva Ã  rejeiÃ§Ã£o da hipÃ³tese de independÃªncia.
>
> ```python
> import numpy as np
> from scipy.stats import chi2
>
> T000 = 200
> T001 = 8
> T010 = 10
> T011 = 3
> T100 = 12
> T101 = 5
> T110 = 8
> T111 = 4
> T = T000 + T001 + T010 + T011 + T100 + T101 + T110 + T111
>
> pi = (T001 + T011 + T101 + T111) / T
> pi00 = T001 / (T000 + T001)
> pi01 = T011 / (T010 + T011)
> pi10 = T101 / (T100 + T101)
> pi11 = T111 / (T110 + T111)
>
> lr_ind2 = -2 * np.log((1-pi)**(T000+T010+T100+T110) * pi**(T001+T011+T101+T111)) + \
>            2 * np.log((1-pi00)**T000 * pi00**T001 * (1-pi01)**T010 * pi01**T011 * \
>                      (1-pi10)**T100 * pi10**T101 * (1-pi11)**T110 * pi11**T111)
>
> print(f"LR_ind(2): {lr_ind2:.2f}")
>
> critical_value_ind2 = chi2.ppf(0.95, 3)
> print(f"Critical value (chi2(3), 5%): {critical_value_ind2:.3f}")
>
> if lr_ind2 > critical_value_ind2:
>   print("Reject the null hypothesis: Evidence of serial dependence with lag 2")
> else:
>   print("Fail to reject the null hypothesis: No evidence of serial dependence with lag 2")
>
> ```

**Lema 3.2**: $LR_{ind(1)}$ se reduz Ã  estatÃ­stica $LR_{ind}$ quando se considera a dependÃªncia de apenas um perÃ­odo anterior.
**Prova do Lema 3.2**:
Quando $k=1$, a estatÃ­stica $LR_{ind(k)}$ se torna:
$$
LR_{ind(1)} = - 2 \ln \left[ (1 - \pi)^{\sum T_{i_10}} \pi^{\sum T_{i_11}} \right] + 2 \ln \left[ \prod_{i_1} (1-\pi_{i_1})^{T_{i_10}}  \pi_{i_1}^{T_{i_11}}  \right]
$$

I. A soma $\sum T_{i_10}$ percorre $i_1 = 0$ e $i_1 = 1$, resultando em $T_{00} + T_{10}$.

II. Analogamente, $\sum T_{i_11}$ resulta em $T_{01} + T_{11}$.

III. O produto $\prod_{i_1}$ se torna $(1-\pi_0)^{T_{00}} \pi_0^{T_{01}} (1-\pi_1)^{T_{10}} \pi_1^{T_{11}}$.

IV. Assim, a expressÃ£o se reduz a:
$$
LR_{ind(1)} = - 2 \ln \left[ (1 - \pi)^{T_{00} + T_{10}} \pi^{T_{01} + T_{11}} \right] + 2 \ln \left[ (1 - \pi_0)^{T_{00}} \pi_0^{T_{01}} (1 - \pi_1)^{T_{10}} \pi_1^{T_{11}} \right]
$$
que Ã© precisamente a definiÃ§Ã£o de $LR_{ind}$. Portanto, $LR_{ind(1)} = LR_{ind}$. â– 

**ProposiÃ§Ã£o 3.1**: A distribuiÃ§Ã£o assintÃ³tica da estatÃ­stica $LR_{ind(k)}$ Ã© $\chi^2(2^k -1)$ sob a hipÃ³tese nula de independÃªncia, refletindo o nÃºmero de parÃ¢metros adicionais necessÃ¡rios para modelar a dependÃªncia em $k$ perÃ­odos em comparaÃ§Ã£o com a hipÃ³tese nula.

**Prova da ProposiÃ§Ã£o 3.1**:
I. O modelo de hipÃ³tese nula assume independÃªncia, ou seja, a probabilidade de uma exceÃ§Ã£o Ã© constante e independente dos estados anteriores. Este modelo tem um parÃ¢metro ($\pi$), que representa a probabilidade incondicional de uma exceÃ§Ã£o.

II. O modelo de hipÃ³tese alternativa assume que a probabilidade de uma exceÃ§Ã£o depende dos $k$ estados anteriores. Existem $2^k$ sequÃªncias possÃ­veis dos $k$ estados anteriores (cada estado pode ser 0 ou 1), e para cada uma delas, hÃ¡ uma probabilidade condicional de uma exceÃ§Ã£o. Portanto, hÃ¡ $2^k$ parÃ¢metros condicionais que devem ser estimados, sendo $\pi_{i_1 \ldots i_k}$ a probabilidade de uma exceÃ§Ã£o dado os k estados anteriores $(i_1, \ldots,i_k)$. Note que apenas $2^k - 1$ desses parÃ¢metros sÃ£o independentes, pois as probabilidades devem somar 1.

III. A estatÃ­stica $LR_{ind(k)}$ Ã© construÃ­da usando a razÃ£o de verossimilhanÃ§a entre o modelo de hipÃ³tese alternativa e o modelo de hipÃ³tese nula.

IV. De acordo com o Teorema de Wilks, a estatÃ­stica de razÃ£o de verossimilhanÃ§a tem uma distribuiÃ§Ã£o assintÃ³tica $\chi^2$ com graus de liberdade igual Ã  diferenÃ§a entre o nÃºmero de parÃ¢metros estimados nos dois modelos.

V. No nosso caso, o modelo alternativo tem $2^k$ parÃ¢metros, ou seja $2^k - 1$ parÃ¢metros independentes, enquanto o modelo de hipÃ³tese nula tem 1 parÃ¢metro. Portanto, a diferenÃ§a nos nÃºmeros de parÃ¢metros (e, portanto, o nÃºmero de graus de liberdade) Ã© $(2^k - 1) - 1 = 2^k - 1$.

VI. Assim, a estatÃ­stica $LR_{ind(k)}$ segue assintoticamente uma distribuiÃ§Ã£o $\chi^2(2^k-1)$ sob a hipÃ³tese nula de independÃªncia das exceÃ§Ãµes.  â– 

**ObservaÃ§Ã£o 6:** A escolha de $k$ na anÃ¡lise da dependÃªncia temporal envolve um balanÃ§o entre a capacidade de capturar dependÃªncias de longo prazo e a complexidade do modelo. Valores muito altos de $k$ podem levar Ã  necessidade de dados maiores e perda de poder estatÃ­stico, enquanto valores muito baixos podem nÃ£o identificar padrÃµes de dependÃªncia relevantes.

**Teorema 4**: Ã‰ possÃ­vel combinar testes de independÃªncia com diferentes ordens $k_1$ e $k_2$. A estatÃ­stica combinada Ã© dada por
$$
LR_{k_1, k_2} = LR_{ind(k_1)} + LR_{ind(k_2)}
$$
onde $LR_{ind(k_1)}$ e $LR_{ind(k_2)}$ sÃ£o estatÃ­sticas calculadas considerando a dependÃªncia nas exceÃ§Ãµes nos $k_1$ e $k_2$ dias anteriores, respectivamente. Sob a hipÃ³tese nula de independÃªncia, $LR_{k_1, k_2}$ segue uma distribuiÃ§Ã£o $\chi^2(2^{k_1} + 2^{k_2} - 2)$, desde que $k_1 \neq k_2$.

**Prova do Teorema 4:**

I.  $LR_{ind(k_1)}$ testa a hipÃ³tese nula de independÃªncia serial considerando as $k_1$ defasagens anteriores, sendo distribuÃ­da assintoticamente como $\chi^2(2^{k_1} - 1)$.

II.  Analogamente, $LR_{ind(k_2)}$ testa a hipÃ³tese nula de independÃªncia serial considerando as $k_2$ defasagens anteriores, sendo distribuÃ­da assintoticamente como $\chi^2(2^{k_2} - 1)$.

III.  Assumindo que as dependÃªncias temporais em $k_1$ e $k_2$ sÃ£o avaliadas separadamente, ou seja, que os testes sÃ£o independentes, entÃ£o a soma das estatÃ­sticas de razÃ£o de verossimilhanÃ§a tambÃ©m segue uma distribuiÃ§Ã£o $\chi^2$.

IV.  A soma de duas estatÃ­sticas $\chi^2$ independentes com graus de liberdade $m$ e $n$ segue uma distribuiÃ§Ã£o $\chi^2$ com $m+n$ graus de liberdade.

V. Portanto, $LR_{k_1, k_2} = LR_{ind(k_1)} + LR_{ind(k_2)}$ Ã© distribuÃ­da assintoticamente como $\chi^2((2^{k_1} - 1) + (2^{k_2} - 1)) = \chi^2(2^{k_1} + 2^{k_2} - 2)$, sob a hipÃ³tese nula de independÃªncia serial para ambos $k_1$ e $k_2$.  â– 

**ObservaÃ§Ã£o 7:** A estatÃ­stica $LR_{k_1, k_2}$ permite verificar se a dependÃªncia serial das exceÃ§Ãµes ocorre em diferentes horizontes temporais. Por exemplo, poderÃ­amos querer verificar a independÃªncia considerando defasagens de um dia ($k_1 = 1$) e defasagens de dois dias ($k_2 = 2$).
**Teorema 4.1**: A estatÃ­stica $LR_{k_1, k_2}$ pode ser generalizada para incluir mais defasagens, $k_1, k_2, ..., k_n$. Nesse caso, a estatÃ­stica combinada Ã© dada por
$$
LR_{k_1, k_2, \dots, k_n} = \sum_{i=1}^n LR_{ind(k_i)}
$$
Sob a hipÃ³tese nula de independÃªncia, $LR_{k_1, k_2, \dots, k_n}$ segue uma distribuiÃ§Ã£o $\chi^2(\sum_{i=1}^n 2^{k_i} - n)$, desde que $k_i \neq k_j$ para todo $i \neq j$.

**Prova do Teorema 4.1:**
I.  Cada $LR_{ind(k_i)}$ testa a hipÃ³tese nula de independÃªncia serial considerando as $k_i$ defasagens anteriores, sendo distribuÃ­da assintoticamente como $\chi^2(2^{k_i} - 1)$.

II. Assumimos que os testes sÃ£o independentes, ou seja, que a dependÃªncia temporal avaliada com uma defasagem $k_i$ Ã© independente da dependÃªncia temporal avaliada com outra defasagem $k_j$, se $i\neq j$.

III. A soma de n estatÃ­sticas $\chi^2$ independentes com graus de liberdade $m_1, m_2, \dots, m_n$ segue uma distribuiÃ§Ã£o $\chi^2$ com $\sum_{i=1}^n m_i$ graus de liberdade.

IV. Portanto, $LR_{k_1, k_2, \dots, k_n} = \sum_{i=1}^n LR_{ind(k_i)}$ Ã© distribuÃ­da assintoticamente como $\chi^2(\sum_{i=1}^n (2^{k_i} - 1)) = \chi^2(\sum_{i=1}^n 2^{k_i} - n)$, sob a hipÃ³tese nula de independÃªncia serial para cada defasagem $k_i$. â– 

**ObservaÃ§Ã£o 8:** A generalizaÃ§Ã£o para $n$ defasagens permite uma anÃ¡lise mais completa, combinando informaÃ§Ãµes sobre a dependÃªncia em diferentes horizontes temporais. Ã‰ importante notar que o aumento de $n$ implica um aumento do nÃºmero de graus de liberdade, o que pode reduzir o poder estatÃ­stico dos testes, especialmente em amostras de tamanho limitado.
**ProposiÃ§Ã£o 4.1:** Se $k_i = 1$ para todo $i$, entÃ£o a estatÃ­stica $LR_{k_1, k_2, \dots, k_n}$ reduz-se Ã  estatÃ­stica $nLR_{ind}$, que Ã© distribuÃ­da como $\chi^2(n)$ sob a hipÃ³tese nula de independÃªncia.
**Prova da ProposiÃ§Ã£o 4.1**:

I. Se $k_i=1$ para todo $i$, entÃ£o $LR_{ind(k_i)} = LR_{ind}$ para todo $i$.

II.  Assim, $LR_{k_1, k_2, \dots, k_n} = \sum_{i=1}^n LR_{ind(k_i)} = \sum_{i=1}^n LR_{ind} = n LR_{ind}$.

III. Sabemos que $LR_{ind}$ Ã© assintoticamente distribuÃ­da como $\chi^2(1)$ sob a hipÃ³tese nula.

IV. A soma de $n$ variÃ¡veis $\chi^2(1)$ independentes, sob a hipÃ³tese nula,  Ã© distribuÃ­da como $\chi^2(n)$.
V. Portanto, $nLR_{ind}$ Ã© distribuÃ­da como $\chi^2(n)$ sob a hipÃ³tese nula de independÃªncia. â– 
**ObservaÃ§Ã£o 9**: A ProposiÃ§Ã£o 4.1 mostra um caso especial da estatÃ­stica combinada com vÃ¡rias defasagens.

### ConclusÃ£o
Os modelos de *conditional coverage*, atravÃ©s da anÃ¡lise de indicadores de desvio e da estatÃ­stica $LR_{ind}$, representam um avanÃ§o crucial na validaÃ§Ã£o de modelos de VaR, garantindo que as exceÃ§Ãµes nÃ£o apenas correspondam ao nÃ­vel de confianÃ§a, mas tambÃ©m ocorram de forma aleatÃ³ria ao longo do tempo. A combinaÃ§Ã£o da estatÃ­stica $LR_{ind}$ com a estatÃ­stica $LR_{uc}$ na estatÃ­stica $LR_{cc}$ proporciona uma avaliaÃ§Ã£o abrangente da adequaÃ§Ã£o do modelo. A generalizaÃ§Ã£o para ordens superiores com a estatÃ­stica $LR_{ind(k)}$ permite verificar dependÃªncias mais complexas. O uso destes testes permite uma gestÃ£o de risco mais precisa e eficaz, garantindo que os modelos de VaR sejam robustos e confiÃ¡veis. A capacidade de analisar dependÃªncias temporais nas exceÃ§Ãµes do VaR e verificar o ajuste Ã³timo atravÃ©s da estatÃ­stica $LR_{k_1,k_2}$ e sua generalizaÃ§Ã£o $LR_{k_1, k_2, ..., k_n}$ Ã© um diferencial importante para uma avaliaÃ§Ã£o mais completa e segura do desempenho dos modelos de risco.

### ReferÃªncias
[^1]: CapÃ­tulo 6 do texto fornecido.
<!-- END -->
