## Computing Nonparametric Value at Risk (VAR)

### Introdu√ß√£o
Como explorado anteriormente, o Value at Risk (VAR) √© uma medida estat√≠stica de risco de perda, fundamental para a gest√£o de risco em finan√ßas [^1]. Este cap√≠tulo aprofunda a metodologia de c√°lculo do VAR, abordando inicialmente a abordagem n√£o param√©trica. Em contraste com m√©todos que imp√µem uma forma espec√≠fica √† distribui√ß√£o de retornos, como a distribui√ß√£o normal, o VAR n√£o param√©trico oferece uma abordagem mais flex√≠vel, baseada diretamente nos dados emp√≠ricos. Este m√©todo √© crucial em cen√°rios onde a distribui√ß√£o dos retornos n√£o pode ser assumida como pertencente a uma fam√≠lia param√©trica conhecida [^1]. Esta se√ß√£o abordar√° a defini√ß√£o formal e o processo de c√°lculo do VAR n√£o param√©trico, preparando o terreno para as an√°lises que seguem.

### Conceitos Fundamentais

O VAR n√£o param√©trico, como o pr√≥prio nome indica, n√£o se baseia em nenhuma suposi√ß√£o sobre a forma da distribui√ß√£o dos retornos [^1]. Este m√©todo √© particularmente √∫til quando se suspeita que a distribui√ß√£o dos retornos pode n√£o seguir uma forma param√©trica conhecida, como a distribui√ß√£o normal. Para iniciar a an√°lise, define-se $W_0$ como o investimento inicial e $R$ como a taxa de retorno aleat√≥ria. Assumindo que a posi√ß√£o √© mantida fixa e n√£o h√° negocia√ß√£o, o valor do portf√≥lio ao final do horizonte de tempo $T$ √© dado por:

$$ W = W_0(1 + R) $$

onde $W$ √© o valor final do portf√≥lio [^4].

A taxa de retorno $R$ √© uma vari√°vel aleat√≥ria, e suas caracter√≠sticas s√£o essenciais para o c√°lculo do VAR. O valor esperado do retorno √© denotado por $\mu$, e a volatilidade do retorno √© representada por $\sigma$ [^4]. Com essas defini√ß√µes, o c√°lculo do VAR n√£o param√©trico envolve determinar o menor valor de perda que n√£o ser√° excedido com uma determinada probabilidade.

Para formalizar o conceito, define-se $c$ como o n√≠vel de confian√ßa e $L$ como a perda, medida como um n√∫mero positivo. O VAR √© ent√£o definido como a menor perda, em valor absoluto, tal que:

$$ P(L > VAR) \leq 1 - c $$

Esta f√≥rmula indica que a probabilidade de ter uma perda $L$ maior do que o VAR √© menor ou igual a $1-c$ [^2]. Por exemplo, em um n√≠vel de confian√ßa de 99% ($c = 0.99$), o VAR √© o valor da perda tal que a probabilidade de ocorrer uma perda maior √© inferior a 1% [^2].

Um ponto chave √© definir o VAR em rela√ß√£o a um valor de refer√™ncia. O VAR *relativo* √© definido como a perda em d√≥lares em rela√ß√£o ao valor m√©dio no horizonte:

$$ VAR(mean) = E(W) - W^* = -W_0(R^* - \mu) $$

Aqui, $W^*$ √© o valor do portf√≥lio no n√≠vel de confian√ßa $c$ e $R^*$ √© o retorno correspondente. Por outro lado, o VAR *absoluto* √© definido como a perda em rela√ß√£o a zero:

$$ VAR(zero) = W_0 - W^* = -W_0R^* $$

Em horizontes curtos, a diferen√ßa entre VAR relativo e absoluto pode ser pequena. No entanto, em horizontes mais longos, o VAR relativo √© mais apropriado, pois considera o desvio em rela√ß√£o ao "budget", incorporando o valor do dinheiro no tempo [^4].

> üí° **Exemplo Num√©rico:** Suponha um investimento inicial de $W_0 = \$1.000.000$. Ap√≥s um per√≠odo, temos um retorno m√©dio esperado de $\mu = 5\%$ e um retorno no n√≠vel de confian√ßa de 95% ($c=0.95$) de $R^* = -2\%$. O VAR relativo seria:
> $$VAR(mean) = - \$1.000.000 * (-0.02 - 0.05) = \$70.000$$
> J√° o VAR absoluto seria:
> $$VAR(zero) = - \$1.000.000 * (-0.02) = \$20.000$$
> Nesse caso, o VAR relativo √© maior pois compara com o retorno m√©dio, enquanto o absoluto considera a perda em rela√ß√£o ao valor inicial do investimento.

**Observa√ß√£o 1:** *A escolha entre VAR relativo e absoluto tamb√©m depende do prop√≥sito da an√°lise. Se o objetivo √© avaliar o risco em rela√ß√£o ao resultado esperado, o VAR relativo √© mais apropriado. Se o objetivo √© avaliar o risco de perda total do investimento, o VAR absoluto √© mais adequado.*

O c√°lculo do VAR n√£o param√©trico envolve a determina√ß√£o do quantil da distribui√ß√£o, que √© o valor de corte que tem uma probabilidade fixa de ser excedido [^5]. A express√£o matem√°tica para definir o quantil $W^*$ com uma probabilidade de n√£o ser excedido $p=1-c$ √©:

$$ 1-c = \int_{-\infty}^{W^*} f(w) \, dw = P(w \leq W^*) = p $$

onde $f(w)$ √© a distribui√ß√£o de probabilidade do valor futuro do portf√≥lio. Isso significa que a √°rea sob a curva da distribui√ß√£o de -‚àû at√© $W^*$ √© igual a $1-c$ [^5].

#### Etapas para Computar o VAR N√£o Param√©trico

O c√°lculo do VAR n√£o param√©trico pode ser resumido em algumas etapas fundamentais [^3]:

1.  **Marcar a posi√ß√£o a mercado:** Determine o valor atual do portf√≥lio, por exemplo, $100 milh√µes [^3].
2.  **Medir a variabilidade dos fatores de risco:** Determine a volatilidade do fator de risco relevante, por exemplo, 15% ao ano [^3].
3.  **Definir o horizonte de tempo:** Ajuste o horizonte de tempo relevante, por exemplo, 10 dias √∫teis [^3].
4.  **Definir o n√≠vel de confian√ßa:** Escolha um n√≠vel de confian√ßa, por exemplo, 99%, o que corresponde a um fator de 2.33 sob a premissa de distribui√ß√£o normal [^3]. Note-se que o m√©todo n√£o param√©trico n√£o assume uma distribui√ß√£o normal.
5.  **Reportar a perda potencial:** Processe as informa√ß√µes obtidas para construir a distribui√ß√£o de probabilidade e reportar o VAR, por exemplo, $7 milh√µes, com um n√≠vel de confian√ßa de 99% [^3].

> üí° **Exemplo Num√©rico:** Vamos aplicar essas etapas a um portf√≥lio real.
> 1.  **Posi√ß√£o a mercado:**  Um portf√≥lio de a√ß√µes no valor de $W_0 = \$500.000$.
> 2.  **Variabilidade:** Historicamente, a volatilidade di√°ria dos retornos desse portf√≥lio tem uma distribui√ß√£o n√£o normal com uma certa dispers√£o. Em vez de usar um desvio padr√£o, usamos dados hist√≥ricos diretos.
> 3.  **Horizonte de tempo:** Um dia.
> 4.  **N√≠vel de confian√ßa:** 99%. Isso significa que queremos o valor da perda que n√£o ser√° excedida em 99% dos casos.
> 5.  **Reportar a perda potencial:**
>     -  Coletamos os retornos di√°rios dos √∫ltimos 250 dias.
>     -  Ordenamos os retornos do pior para o melhor.
>     -  O quantil de 1% (correspondente a 99% de confian√ßa) corresponde ao 2.5¬∫ pior dia (250 * 0.01 = 2.5, que arredondamos para o 3¬∫ pior para ser conservador).
>     -  Suponha que o 3¬∫ pior retorno tenha sido de -3%.
>     -  O VAR absoluto √©: $VAR(zero) = -\$500.000 * -0.03 = \$15.000$
>     -  Isso significa que h√° 99% de chance de a perda m√°xima em um dia n√£o exceder \$15.000.

√â importante ressaltar que o m√©todo n√£o param√©trico n√£o faz suposi√ß√µes sobre a distribui√ß√£o dos dados. Ao inv√©s de usar o desvio padr√£o, o VAR n√£o param√©trico √© obtido diretamente do quantil da distribui√ß√£o emp√≠rica dos retornos. Esse valor de corte $W^*$ √© determinado de forma que a probabilidade de ocorr√™ncia de um valor abaixo deste seja igual ao n√≠vel de confian√ßa desejado $1-c$ [^5].

O VAR n√£o param√©trico, ao contr√°rio do param√©trico, n√£o usa o desvio padr√£o para o c√°lculo, mas sim o quantil da distribui√ß√£o. A escolha entre o VAR relativo e absoluto depender√° do contexto espec√≠fico e do horizonte de tempo considerado [^4].

**Lema 1:** *O VAR n√£o param√©trico √© equivalente ao quantil emp√≠rico da distribui√ß√£o de retornos, ajustado pelo valor inicial do portf√≥lio.*

*Proof:*
I. **Initial Setup**:
    - Let $W_0$ be the initial portfolio value.
    - Let $R$ be the random rate of return.
    - Let $W = W_0(1+R)$ be the final portfolio value.
    - Let $R^*$ be the empirical quantile of returns corresponding to confidence level $c$.
    - Let $W^* = W_0(1+R^*)$ be the corresponding quantile of the portfolio value.
II. **Main Logical Steps**:
    - The absolute VAR is defined as $VAR(zero) = W_0 - W^*$.
    - Substituting $W^*$, we get $VAR(zero) = W_0 - W_0(1+R^*)$.
    - Factoring out $W_0$, we have $VAR(zero) = W_0(1 - (1+R^*))$.
    - Simplifying, we get $VAR(zero) = -W_0R^*$.
III. **Key Transformations**:
    - The expression $-W_0R^*$ shows the absolute VAR depends directly on the empirical quantile $R^*$.
IV. **Conclusion**:
    - Thus, the nonparametric VAR is equivalent to the empirical quantile of the return distribution, adjusted by the initial portfolio value, $W_0$. $\blacksquare$

**Teorema 1:** *O VAR n√£o param√©trico converge para o verdadeiro VAR √† medida que o n√∫mero de amostras da distribui√ß√£o emp√≠rica tende ao infinito.*

*Proof Strategy:* Este teorema √© uma consequ√™ncia direta do Teorema de Glivenko-Cantelli, que afirma que a distribui√ß√£o emp√≠rica converge uniformemente para a distribui√ß√£o verdadeira conforme o tamanho da amostra aumenta. Portanto, o quantil da distribui√ß√£o emp√≠rica tamb√©m converge para o quantil da distribui√ß√£o verdadeira. Assim, o VAR n√£o param√©trico, que √© derivado do quantil emp√≠rico, converge para o verdadeiro VAR.

**Corol√°rio 1.1:** *Em situa√ß√µes pr√°ticas, a precis√£o do VAR n√£o param√©trico depende do tamanho da amostra. Amostras menores podem levar a estimativas imprecisas do VAR, especialmente nas caudas da distribui√ß√£o.*

**Lema 1.1:** *O VAR n√£o param√©trico pode ser calculado utilizando diferentes m√©todos de interpola√ß√£o para estimar o quantil emp√≠rico, especialmente em casos de amostras finitas.*

*Proof:*
I. **Initial Setup**:
    - In finite samples, the empirical quantile may not coincide with an observed value.
    - Let $R_1, R_2, \ldots, R_n$ be a finite sample of returns.
    - Let $R^*_c$ be the desired quantile for confidence level $c$.
II. **Main Logical Steps**:
    - If $R^*_c$ falls between two observed values, $R_i$ and $R_{i+1}$, interpolation can be used.
    - Interpolation methods estimate the value of $R^*_c$ based on its position between $R_i$ and $R_{i+1}$.
III. **Key Transformations**:
    - Linear interpolation: $R^*_c = R_i + (R_{i+1}-R_i) \times \frac{c - P(R \leq R_i)}{P(R \leq R_{i+1})-P(R \leq R_i)}$
    - Nearest neighbor interpolation selects the closest data point to the desired quantile.
IV. **Conclusion**:
    - These interpolation methods provide a more accurate estimate of the nonparametric VAR when the quantile does not fall exactly on a sample value.
    - Thus, the lemma is proven. $\blacksquare$
> üí° **Exemplo Num√©rico:** Suponha que temos uma amostra de 10 retornos di√°rios: -0.04, -0.03, -0.02, -0.01, 0.00, 0.01, 0.02, 0.03, 0.04, 0.05. Queremos calcular o VAR com um n√≠vel de confian√ßa de 95%. Isso significa que precisamos do quantil 5%. O quantil de 5% est√° entre -0.04 e -0.03. Usando interpola√ß√£o linear:
>
> $R^* = -0.04 + (-0.03 - (-0.04)) * \frac{0.05 - 0.10}{0.20 - 0.10} = -0.04 + 0.01 * (-0.5) = -0.045$.
>
> Assim, o VAR usando interpola√ß√£o linear ser√° -0.045,  considerando que o quantil  5% n√£o coincidia com os valores observados.  Se usarmos o vizinho mais pr√≥ximo, usar√≠amos -0.04.

**Observa√ß√£o 2:** *A escolha do m√©todo de interpola√ß√£o pode influenciar a precis√£o da estimativa do VAR n√£o param√©trico, particularmente em distribui√ß√µes com caudas pesadas ou em amostras pequenas. A interpola√ß√£o linear √© frequentemente utilizada devido √† sua simplicidade, mas m√©todos mais sofisticados podem ser necess√°rios para obter maior precis√£o em certas situa√ß√µes.*

**Teorema 1.1:** *Sob a condi√ß√£o de que a distribui√ß√£o de retornos seja cont√≠nua, o VAR n√£o param√©trico converge assintoticamente para o valor verdadeiro do VAR a uma taxa de converg√™ncia que depende da densidade da distribui√ß√£o no ponto do quantil.*

*Proof Strategy:* Este resultado segue da teoria da estat√≠stica de ordem e da converg√™ncia das estimativas de quantis. A taxa de converg√™ncia depende da suavidade da fun√ß√£o de distribui√ß√£o no quantil de interesse. Se a densidade for alta neste ponto, a converg√™ncia √© mais r√°pida.

**Corol√°rio 1.2:** *Para distribui√ß√µes com caudas pesadas, o VAR n√£o param√©trico pode exigir amostras maiores para convergir para o valor verdadeiro do VAR com a mesma precis√£o que distribui√ß√µes de cauda leve.*

Este corol√°rio √© consequ√™ncia direta do Teorema 1.1, visto que distribui√ß√µes de caudas pesadas geralmente t√™m densidade menor nas caudas, o que diminui a velocidade da converg√™ncia.

**Lema 2:** *O VAR n√£o param√©trico √© invariante por transforma√ß√µes mon√≥tonas crescentes dos retornos. Ou seja, se g(x) √© uma fun√ß√£o mon√≥tona crescente, ent√£o o VAR calculado sobre g(R) √© obtido da mesma forma que o VAR calculado sobre R, bastando transformar o resultado pela fun√ß√£o g.*

*Proof:*
I.  **Initial Setup:**
    - Let $R$ be the random variable representing returns.
    - Let $g(x)$ be a monotonically increasing function.
    - Let $R^*$ be the quantile of the returns at confidence level $c$.
    - Let VAR be the Value at Risk.
II. **Main Logical Steps:**
    - The absolute VAR calculated on returns $R$ is $VAR(R) = -W_0 R^*$.
    - When applying $g$ to $R$, the new returns are $g(R)$.
    - Due to the monotonic increasing property of $g$, the order of $g(R)$ will be the same as that of $R$.
    - Therefore, the quantile of the transformed returns will be $g(R^*)$, denoted as $(g(R))^* = g(R^*)$.
III. **Key Transformations:**
    - The VAR on the transformed returns is $VAR(g(R)) = -W_0 (g(R))^*$.
    - Substituting $(g(R))^* = g(R^*)$ we get $VAR(g(R)) = -W_0 g(R^*)$.
    - This implies that we can obtain the new VAR by applying $g$ to the original quantile $R^*$.
IV. **Conclusion:**
    - This demonstrates that the nonparametric VAR is invariant under monotonically increasing transformations.
    - Thus, the lemma is proven. $\blacksquare$

> üí° **Exemplo Num√©rico:** Vamos supor que temos os retornos di√°rios $R$: -0.02, -0.01, 0.00, 0.01, 0.02, e queremos calcular o VAR com 95% de confian√ßa. O quantil de 5% seria -0.02 (o pior caso). Se aplicarmos uma transforma√ß√£o mon√≥tona crescente, como $g(x) = 2x + 0.05$, os novos retornos seriam: 0.01, 0.03, 0.05, 0.07, 0.09. O quantil de 5% da nova s√©rie √© $g(-0.02) = 2*(-0.02) + 0.05 = 0.01$. O VAR dos retornos transformados √© obtido usando a fun√ß√£o $g$ sobre o quantil original: $VAR(g(R)) = -W_0 * g(R^*) = -W_0 * 0.01$

**Teorema 2:** *O VAR n√£o param√©trico satisfaz a propriedade de homogeneidade positiva, isto √©, VAR(aW) = aVAR(W), para a > 0, em que W √© o valor do portf√≥lio e a √© uma constante positiva.*

*Proof:*
I.  **Initial Setup:**
    - Let $W$ be the portfolio value, and $W = W_0(1+R)$.
    - Let $a > 0$ be a positive constant.
    - Let $R^*$ be the quantile of the returns at confidence level $c$.
    - Let $VAR(W)$ be the Value at Risk of the portfolio $W$.
II. **Main Logical Steps:**
    - The absolute VAR of the portfolio $W$ is $VAR(W) = -W_0R^*$.
    - Now consider a new portfolio value $aW$. The new portfolio is given by $aW = aW_0(1+R)$.
    - The VAR for the portfolio $aW$ is given by $VAR(aW) = -aW_0 R^*$.
III. **Key Transformations:**
    -  We can rewrite the expression $-aW_0R^*$ as $a(-W_0R^*)$.
    - Since $VAR(W) = -W_0R^*$, we have $VAR(aW) = a VAR(W)$.
IV. **Conclusion:**
    - This demonstrates the positive homogeneity property of the nonparametric VAR, proving the theorem. $\blacksquare$

> üí° **Exemplo Num√©rico:** Se o VAR de um portf√≥lio de \$1.000.000 √© de \$50.000, o VAR de um portf√≥lio 2 vezes maior (\$2.000.000) ser√° de $2 * \$50.000 = \$100.000$.

**Corol√°rio 2.1:** *A propriedade de homogeneidade positiva do VAR n√£o param√©trico implica que o risco de um portf√≥lio escalarmente aumentado √© proporcional ao aumento.*

**Observa√ß√£o 3:** *O VAR n√£o param√©trico, embora flex√≠vel e robusto, pode apresentar dificuldades de estima√ß√£o em caudas muito finas ou muito pesadas da distribui√ß√£o. M√©todos de suaviza√ß√£o da distribui√ß√£o emp√≠rica podem ser utilizados para mitigar esse problema.*

### Conclus√£o

O VAR n√£o param√©trico oferece uma abordagem robusta para a avalia√ß√£o de risco, particularmente √∫til quando as suposi√ß√µes sobre a distribui√ß√£o dos retornos s√£o dif√≠ceis de justificar. O m√©todo baseia-se diretamente na distribui√ß√£o emp√≠rica, determinando quantis que correspondem aos n√≠veis de confian√ßa desejados [^5]. Diferentemente do VAR param√©trico, ele n√£o exige a pressuposi√ß√£o de uma distribui√ß√£o normal, o que o torna aplic√°vel em diversos contextos. Contudo, a precis√£o dos quantis, especialmente em situa√ß√µes de cauda pesada, pode ser um desafio, como ser√° explorado em se√ß√µes subsequentes [^4].

### Refer√™ncias
[^1]:  *Value at risk (VAR) is a statistical measure of downside risk based on current positions.*
[^2]: *Define c as the confidence level and L as the loss, measured as a positive number. VAR is also reported as a positive number. A general definition of VAR is that it is the smallest loss, in absolute value, such that P(L > VAR) ‚â§ 1-c.*
[^3]: *Assume, for instance, that we need to measure the VAR of a $100 million equity portfolio over 10 days at the 99 percent confidence level.*
[^4]: *Define W0 as the initial investment and R as its rate of return, which is random. Assuming that the position is fixed, or that there is no trading, the portfolio value at the end of the target horizon is W = W0 (1 + R). The expected return and volatility of R are defined as Œº and œÉ. Define now the lowest portfolio value at the given confidence level c as W* = W0 (1 + R*). VAR measures the worst loss at some confidence level, so it is expressed as a positive number.*
[^5]:  *In its most general form, VAR can be derived from the probability distribution of the future portfolio value f(w). At a given confidence level c, we wish to find the worst possible realization W* such that the probability of exceeding this value is c, that is, c= ‚à´W* ‚àû f(w)dw or such that the probability of a value lower than W*, p = P(w ‚â§ W*), is 1 ‚àí c, that is, 1‚àíc=‚à´W*‚àí‚àû f(w)dw=P(w‚â§W*)=p.*
