## Computing Nonparametric Value at Risk (VAR)

### IntroduÃ§Ã£o
Como explorado anteriormente, o Value at Risk (VAR) Ã© uma medida estatÃ­stica de risco de perda, fundamental para a gestÃ£o de risco em finanÃ§as [^1]. Este capÃ­tulo aprofunda a metodologia de cÃ¡lculo do VAR, abordando inicialmente a abordagem nÃ£o paramÃ©trica. Em contraste com mÃ©todos que impÃµem uma forma especÃ­fica Ã  distribuiÃ§Ã£o de retornos, como a distribuiÃ§Ã£o normal, o VAR nÃ£o paramÃ©trico oferece uma abordagem mais flexÃ­vel, baseada diretamente nos dados empÃ­ricos. Este mÃ©todo Ã© crucial em cenÃ¡rios onde a distribuiÃ§Ã£o dos retornos nÃ£o pode ser assumida como pertencente a uma famÃ­lia paramÃ©trica conhecida [^1]. Esta seÃ§Ã£o abordarÃ¡ a definiÃ§Ã£o formal e o processo de cÃ¡lculo do VAR nÃ£o paramÃ©trico, preparando o terreno para as anÃ¡lises que seguem.

### Conceitos Fundamentais

O VAR nÃ£o paramÃ©trico, como o prÃ³prio nome indica, nÃ£o se baseia em nenhuma suposiÃ§Ã£o sobre a forma da distribuiÃ§Ã£o dos retornos [^1]. Este mÃ©todo Ã© particularmente Ãºtil quando se suspeita que a distribuiÃ§Ã£o dos retornos pode nÃ£o seguir uma forma paramÃ©trica conhecida, como a distribuiÃ§Ã£o normal. Para iniciar a anÃ¡lise, define-se $W_0$ como o investimento inicial e $R$ como a taxa de retorno aleatÃ³ria. Assumindo que a posiÃ§Ã£o Ã© mantida fixa e nÃ£o hÃ¡ negociaÃ§Ã£o, o valor do portfÃ³lio ao final do horizonte de tempo $T$ Ã© dado por:

$$ W = W_0(1 + R) $$

onde $W$ Ã© o valor final do portfÃ³lio [^4].

A taxa de retorno $R$ Ã© uma variÃ¡vel aleatÃ³ria, e suas caracterÃ­sticas sÃ£o essenciais para o cÃ¡lculo do VAR. O valor esperado do retorno Ã© denotado por $\mu$, e a volatilidade do retorno Ã© representada por $\sigma$ [^4]. Com essas definiÃ§Ãµes, o cÃ¡lculo do VAR nÃ£o paramÃ©trico envolve determinar o menor valor de perda que nÃ£o serÃ¡ excedido com uma determinada probabilidade.

Para formalizar o conceito, define-se $c$ como o nÃ­vel de confianÃ§a e $L$ como a perda, medida como um nÃºmero positivo. O VAR Ã© entÃ£o definido como a menor perda, em valor absoluto, tal que:

$$ P(L > VAR) \leq 1 - c $$

Esta fÃ³rmula indica que a probabilidade de ter uma perda $L$ maior do que o VAR Ã© menor ou igual a $1-c$ [^2]. Por exemplo, em um nÃ­vel de confianÃ§a de 99% ($c = 0.99$), o VAR Ã© o valor da perda tal que a probabilidade de ocorrer uma perda maior Ã© inferior a 1% [^2].

Um ponto chave Ã© definir o VAR em relaÃ§Ã£o a um valor de referÃªncia. O VAR *relativo* Ã© definido como a perda em dÃ³lares em relaÃ§Ã£o ao valor mÃ©dio no horizonte:

$$ VAR(mean) = E(W) - W^* = -W_0(R^* - \mu) $$

Aqui, $W^*$ Ã© o valor do portfÃ³lio no nÃ­vel de confianÃ§a $c$ e $R^*$ Ã© o retorno correspondente. Por outro lado, o VAR *absoluto* Ã© definido como a perda em relaÃ§Ã£o a zero:

$$ VAR(zero) = W_0 - W^* = -W_0R^* $$

Em horizontes curtos, a diferenÃ§a entre VAR relativo e absoluto pode ser pequena. No entanto, em horizontes mais longos, o VAR relativo Ã© mais apropriado, pois considera o desvio em relaÃ§Ã£o ao "budget", incorporando o valor do dinheiro no tempo [^4].

> ðŸ’¡ **Exemplo NumÃ©rico:** Suponha um investimento inicial de $W_0 = \$1.000.000$. ApÃ³s um perÃ­odo, temos um retorno mÃ©dio esperado de $\mu = 5\%$ e um retorno no nÃ­vel de confianÃ§a de 95% ($c=0.95$) de $R^* = -2\%$. O VAR relativo seria:
> $$VAR(mean) = - \$1.000.000 * (-0.02 - 0.05) = \$70.000$$
> JÃ¡ o VAR absoluto seria:
> $$VAR(zero) = - \$1.000.000 * (-0.02) = \$20.000$$
> Nesse caso, o VAR relativo Ã© maior pois compara com o retorno mÃ©dio, enquanto o absoluto considera a perda em relaÃ§Ã£o ao valor inicial do investimento.

**ObservaÃ§Ã£o 1:** *A escolha entre VAR relativo e absoluto tambÃ©m depende do propÃ³sito da anÃ¡lise. Se o objetivo Ã© avaliar o risco em relaÃ§Ã£o ao resultado esperado, o VAR relativo Ã© mais apropriado. Se o objetivo Ã© avaliar o risco de perda total do investimento, o VAR absoluto Ã© mais adequado.*

O cÃ¡lculo do VAR nÃ£o paramÃ©trico envolve a determinaÃ§Ã£o do quantil da distribuiÃ§Ã£o, que Ã© o valor de corte que tem uma probabilidade fixa de ser excedido [^5]. A expressÃ£o matemÃ¡tica para definir o quantil $W^*$ com uma probabilidade de nÃ£o ser excedido $p=1-c$ Ã©:

$$ 1-c = \int_{-\infty}^{W^*} f(w) \, dw = P(w \leq W^*) = p $$

onde $f(w)$ Ã© a distribuiÃ§Ã£o de probabilidade do valor futuro do portfÃ³lio. Isso significa que a Ã¡rea sob a curva da distribuiÃ§Ã£o de -âˆž atÃ© $W^*$ Ã© igual a $1-c$ [^5].

#### Etapas para Computar o VAR NÃ£o ParamÃ©trico

O cÃ¡lculo do VAR nÃ£o paramÃ©trico pode ser resumido em algumas etapas fundamentais [^3]:

1.  **Marcar a posiÃ§Ã£o a mercado:** Determine o valor atual do portfÃ³lio, por exemplo, $100 milhÃµes [^3].
2.  **Medir a variabilidade dos fatores de risco:** Determine a volatilidade do fator de risco relevante, por exemplo, 15% ao ano [^3].
3.  **Definir o horizonte de tempo:** Ajuste o horizonte de tempo relevante, por exemplo, 10 dias Ãºteis [^3].
4.  **Definir o nÃ­vel de confianÃ§a:** Escolha um nÃ­vel de confianÃ§a, por exemplo, 99%, o que corresponde a um fator de 2.33 sob a premissa de distribuiÃ§Ã£o normal [^3]. Note-se que o mÃ©todo nÃ£o paramÃ©trico nÃ£o assume uma distribuiÃ§Ã£o normal.
5.  **Reportar a perda potencial:** Processe as informaÃ§Ãµes obtidas para construir a distribuiÃ§Ã£o de probabilidade e reportar o VAR, por exemplo, $7 milhÃµes, com um nÃ­vel de confianÃ§a de 99% [^3].

> ðŸ’¡ **Exemplo NumÃ©rico:** Vamos aplicar essas etapas a um portfÃ³lio real.
> 1.  **PosiÃ§Ã£o a mercado:**  Um portfÃ³lio de aÃ§Ãµes no valor de $W_0 = \$500.000$.
> 2.  **Variabilidade:** Historicamente, a volatilidade diÃ¡ria dos retornos desse portfÃ³lio tem uma distribuiÃ§Ã£o nÃ£o normal com uma certa dispersÃ£o. Em vez de usar um desvio padrÃ£o, usamos dados histÃ³ricos diretos.
> 3.  **Horizonte de tempo:** Um dia.
> 4.  **NÃ­vel de confianÃ§a:** 99%. Isso significa que queremos o valor da perda que nÃ£o serÃ¡ excedida em 99% dos casos.
> 5.  **Reportar a perda potencial:**
>     -  Coletamos os retornos diÃ¡rios dos Ãºltimos 250 dias.
>     -  Ordenamos os retornos do pior para o melhor.
>     -  O quantil de 1% (correspondente a 99% de confianÃ§a) corresponde ao 2.5Âº pior dia (250 * 0.01 = 2.5, que arredondamos para o 3Âº pior para ser conservador).
>     -  Suponha que o 3Âº pior retorno tenha sido de -3%.
>     -  O VAR absoluto Ã©: $VAR(zero) = -\$500.000 * -0.03 = \$15.000$
>     -  Isso significa que hÃ¡ 99% de chance de a perda mÃ¡xima em um dia nÃ£o exceder \$15.000.

Ã‰ importante ressaltar que o mÃ©todo nÃ£o paramÃ©trico nÃ£o faz suposiÃ§Ãµes sobre a distribuiÃ§Ã£o dos dados. Ao invÃ©s de usar o desvio padrÃ£o, o VAR nÃ£o paramÃ©trico Ã© obtido diretamente do quantil da distribuiÃ§Ã£o empÃ­rica dos retornos. Esse valor de corte $W^*$ Ã© determinado de forma que a probabilidade de ocorrÃªncia de um valor abaixo deste seja igual ao nÃ­vel de confianÃ§a desejado $1-c$ [^5].

O VAR nÃ£o paramÃ©trico, ao contrÃ¡rio do paramÃ©trico, nÃ£o usa o desvio padrÃ£o para o cÃ¡lculo, mas sim o quantil da distribuiÃ§Ã£o. A escolha entre o VAR relativo e absoluto dependerÃ¡ do contexto especÃ­fico e do horizonte de tempo considerado [^4].

**Lema 1:** *O VAR nÃ£o paramÃ©trico Ã© equivalente ao quantil empÃ­rico da distribuiÃ§Ã£o de retornos, ajustado pelo valor inicial do portfÃ³lio.*

*Proof:*
I. **Initial Setup**:
    - Let $W_0$ be the initial portfolio value.
    - Let $R$ be the random rate of return.
    - Let $W = W_0(1+R)$ be the final portfolio value.
    - Let $R^*$ be the empirical quantile of returns corresponding to confidence level $c$.
    - Let $W^* = W_0(1+R^*)$ be the corresponding quantile of the portfolio value.
II. **Main Logical Steps**:
    - The absolute VAR is defined as $VAR(zero) = W_0 - W^*$.
    - Substituting $W^*$, we get $VAR(zero) = W_0 - W_0(1+R^*)$.
    - Factoring out $W_0$, we have $VAR(zero) = W_0(1 - (1+R^*))$.
    - Simplifying, we get $VAR(zero) = -W_0R^*$.
III. **Key Transformations**:
    - The expression $-W_0R^*$ shows the absolute VAR depends directly on the empirical quantile $R^*$.
IV. **Conclusion**:
    - Thus, the nonparametric VAR is equivalent to the empirical quantile of the return distribution, adjusted by the initial portfolio value, $W_0$. $\blacksquare$

**Teorema 1:** *O VAR nÃ£o paramÃ©trico converge para o verdadeiro VAR Ã  medida que o nÃºmero de amostras da distribuiÃ§Ã£o empÃ­rica tende ao infinito.*

*Proof Strategy:* Este teorema Ã© uma consequÃªncia direta do Teorema de Glivenko-Cantelli, que afirma que a distribuiÃ§Ã£o empÃ­rica converge uniformemente para a distribuiÃ§Ã£o verdadeira conforme o tamanho da amostra aumenta. Portanto, o quantil da distribuiÃ§Ã£o empÃ­rica tambÃ©m converge para o quantil da distribuiÃ§Ã£o verdadeira. Assim, o VAR nÃ£o paramÃ©trico, que Ã© derivado do quantil empÃ­rico, converge para o verdadeiro VAR.

**CorolÃ¡rio 1.1:** *Em situaÃ§Ãµes prÃ¡ticas, a precisÃ£o do VAR nÃ£o paramÃ©trico depende do tamanho da amostra. Amostras menores podem levar a estimativas imprecisas do VAR, especialmente nas caudas da distribuiÃ§Ã£o.*

**Lema 1.1:** *O VAR nÃ£o paramÃ©trico pode ser calculado utilizando diferentes mÃ©todos de interpolaÃ§Ã£o para estimar o quantil empÃ­rico, especialmente em casos de amostras finitas.*

*Proof:*
I. **Initial Setup**:
    - In finite samples, the empirical quantile may not coincide with an observed value.
    - Let $R_1, R_2, \ldots, R_n$ be a finite sample of returns.
    - Let $R^*_c$ be the desired quantile for confidence level $c$.
II. **Main Logical Steps**:
    - If $R^*_c$ falls between two observed values, $R_i$ and $R_{i+1}$, interpolation can be used.
    - Interpolation methods estimate the value of $R^*_c$ based on its position between $R_i$ and $R_{i+1}$.
III. **Key Transformations**:
    - Linear interpolation: $R^*_c = R_i + (R_{i+1}-R_i) \times \frac{c - P(R \leq R_i)}{P(R \leq R_{i+1})-P(R \leq R_i)}$
    - Nearest neighbor interpolation selects the closest data point to the desired quantile.
IV. **Conclusion**:
    - These interpolation methods provide a more accurate estimate of the nonparametric VAR when the quantile does not fall exactly on a sample value.
    - Thus, the lemma is proven. $\blacksquare$
> ðŸ’¡ **Exemplo NumÃ©rico:** Suponha que temos uma amostra de 10 retornos diÃ¡rios: -0.04, -0.03, -0.02, -0.01, 0.00, 0.01, 0.02, 0.03, 0.04, 0.05. Queremos calcular o VAR com um nÃ­vel de confianÃ§a de 95%. Isso significa que precisamos do quantil 5%. O quantil de 5% estÃ¡ entre -0.04 e -0.03. Usando interpolaÃ§Ã£o linear:
>
> $R^* = -0.04 + (-0.03 - (-0.04)) * \frac{0.05 - 0.10}{0.20 - 0.10} = -0.04 + 0.01 * (-0.5) = -0.045$.
>
> Assim, o VAR usando interpolaÃ§Ã£o linear serÃ¡ -0.045,  considerando que o quantil  5% nÃ£o coincidia com os valores observados.  Se usarmos o vizinho mais prÃ³ximo, usarÃ­amos -0.04.

**ObservaÃ§Ã£o 2:** *A escolha do mÃ©todo de interpolaÃ§Ã£o pode influenciar a precisÃ£o da estimativa do VAR nÃ£o paramÃ©trico, particularmente em distribuiÃ§Ãµes com caudas pesadas ou em amostras pequenas. A interpolaÃ§Ã£o linear Ã© frequentemente utilizada devido Ã  sua simplicidade, mas mÃ©todos mais sofisticados podem ser necessÃ¡rios para obter maior precisÃ£o em certas situaÃ§Ãµes.*

**Teorema 1.1:** *Sob a condiÃ§Ã£o de que a distribuiÃ§Ã£o de retornos seja contÃ­nua, o VAR nÃ£o paramÃ©trico converge assintoticamente para o valor verdadeiro do VAR a uma taxa de convergÃªncia que depende da densidade da distribuiÃ§Ã£o no ponto do quantil.*

*Proof Strategy:* Este resultado segue da teoria da estatÃ­stica de ordem e da convergÃªncia das estimativas de quantis. A taxa de convergÃªncia depende da suavidade da funÃ§Ã£o de distribuiÃ§Ã£o no quantil de interesse. Se a densidade for alta neste ponto, a convergÃªncia Ã© mais rÃ¡pida.

**CorolÃ¡rio 1.2:** *Para distribuiÃ§Ãµes com caudas pesadas, o VAR nÃ£o paramÃ©trico pode exigir amostras maiores para convergir para o valor verdadeiro do VAR com a mesma precisÃ£o que distribuiÃ§Ãµes de cauda leve.*

Este corolÃ¡rio Ã© consequÃªncia direta do Teorema 1.1, visto que distribuiÃ§Ãµes de caudas pesadas geralmente tÃªm densidade menor nas caudas, o que diminui a velocidade da convergÃªncia.

**Lema 2:** *O VAR nÃ£o paramÃ©trico Ã© invariante por transformaÃ§Ãµes monÃ³tonas crescentes dos retornos. Ou seja, se g(x) Ã© uma funÃ§Ã£o monÃ³tona crescente, entÃ£o o VAR calculado sobre g(R) Ã© obtido da mesma forma que o VAR calculado sobre R, bastando transformar o resultado pela funÃ§Ã£o g.*

*Proof:*
I.  **Initial Setup:**
    - Let $R$ be the random variable representing returns.
    - Let $g(x)$ be a monotonically increasing function.
    - Let $R^*$ be the quantile of the returns at confidence level $c$.
    - Let VAR be the Value at Risk.
II. **Main Logical Steps:**
    - The absolute VAR calculated on returns $R$ is $VAR(R) = -W_0 R^*$.
    - When applying $g$ to $R$, the new returns are $g(R)$.
    - Due to the monotonic increasing property of $g$, the order of $g(R)$ will be the same as that of $R$.
    - Therefore, the quantile of the transformed returns will be $g(R^*)$, denoted as $(g(R))^* = g(R^*)$.
III. **Key Transformations:**
    - The VAR on the transformed returns is $VAR(g(R)) = -W_0 (g(R))^*$.
    - Substituting $(g(R))^* = g(R^*)$ we get $VAR(g(R)) = -W_0 g(R^*)$.
    - This implies that we can obtain the new VAR by applying $g$ to the original quantile $R^*$.
IV. **Conclusion:**
    - This demonstrates that the nonparametric VAR is invariant under monotonically increasing transformations.
    - Thus, the lemma is proven. $\blacksquare$

> ðŸ’¡ **Exemplo NumÃ©rico:** Vamos supor que temos os retornos diÃ¡rios $R$: -0.02, -0.01, 0.00, 0.01, 0.02, e queremos calcular o VAR com 95% de confianÃ§a. O quantil de 5% seria -0.02 (o pior caso). Se aplicarmos uma transformaÃ§Ã£o monÃ³tona crescente, como $g(x) = 2x + 0.05$, os novos retornos seriam: 0.01, 0.03, 0.05, 0.07, 0.09. O quantil de 5% da nova sÃ©rie Ã© $g(-0.02) = 2*(-0.02) + 0.05 = 0.01$. O VAR dos retornos transformados Ã© obtido usando a funÃ§Ã£o $g$ sobre o quantil original: $VAR(g(R)) = -W_0 * g(R^*) = -W_0 * 0.01$

**Teorema 2:** *O VAR nÃ£o paramÃ©trico satisfaz a propriedade de homogeneidade positiva, isto Ã©, VAR(aW) = aVAR(W), para a > 0, em que W Ã© o valor do portfÃ³lio e a Ã© uma constante positiva.*

*Proof:*
I.  **Initial Setup:**
    - Let $W$ be the portfolio value, and $W = W_0(1+R)$.
    - Let $a > 0$ be a positive constant.
    - Let $R^*$ be the quantile of the returns at confidence level $c$.
    - Let $VAR(W)$ be the Value at Risk of the portfolio $W$.
II. **Main Logical Steps:**
    - The absolute VAR of the portfolio $W$ is $VAR(W) = -W_0R^*$.
    - Now consider a new portfolio value $aW$. The new portfolio is given by $aW = aW_0(1+R)$.
    - The VAR for the portfolio $aW$ is given by $VAR(aW) = -aW_0 R^*$.
III. **Key Transformations:**
    -  We can rewrite the expression $-aW_0R^*$ as $a(-W_0R^*)$.
    - Since $VAR(W) = -W_0R^*$, we have $VAR(aW) = a VAR(W)$.
IV. **Conclusion:**
    - This demonstrates the positive homogeneity property of the nonparametric VAR, proving the theorem. $\blacksquare$

> ðŸ’¡ **Exemplo NumÃ©rico:** Se o VAR de um portfÃ³lio de \$1.000.000 Ã© de \$50.000, o VAR de um portfÃ³lio 2 vezes maior (\$2.000.000) serÃ¡ de $2 * \$50.000 = \$100.000$.

**CorolÃ¡rio 2.1:** *A propriedade de homogeneidade positiva do VAR nÃ£o paramÃ©trico implica que o risco de um portfÃ³lio escalarmente aumentado Ã© proporcional ao aumento.*

**ObservaÃ§Ã£o 3:** *O VAR nÃ£o paramÃ©trico, embora flexÃ­vel e robusto, pode apresentar dificuldades de estimaÃ§Ã£o em caudas muito finas ou muito pesadas da distribuiÃ§Ã£o. MÃ©todos de suavizaÃ§Ã£o da distribuiÃ§Ã£o empÃ­rica podem ser utilizados para mitigar esse problema.*

### ConclusÃ£o

O VAR nÃ£o paramÃ©trico oferece uma abordagem robusta para a avaliaÃ§Ã£o de risco, particularmente Ãºtil quando as suposiÃ§Ãµes sobre a distribuiÃ§Ã£o dos retornos sÃ£o difÃ­ceis de justificar. O mÃ©todo baseia-se diretamente na distribuiÃ§Ã£o empÃ­rica, determinando quantis que correspondem aos nÃ­veis de confianÃ§a desejados [^5]. Diferentemente do VAR paramÃ©trico, ele nÃ£o exige a pressuposiÃ§Ã£o de uma distribuiÃ§Ã£o normal, o que o torna aplicÃ¡vel em diversos contextos. Contudo, a precisÃ£o dos quantis, especialmente em situaÃ§Ãµes de cauda pesada, pode ser um desafio, como serÃ¡ explorado em seÃ§Ãµes subsequentes [^4].

### ReferÃªncias
[^1]:  *Value at risk (VAR) is a statistical measure of downside risk based on current positions.*
[^2]: *Define c as the confidence level and L as the loss, measured as a positive number. VAR is also reported as a positive number. A general definition of VAR is that it is the smallest loss, in absolute value, such that P(L > VAR) â‰¤ 1-c.*
[^3]: *Assume, for instance, that we need to measure the VAR of a $100 million equity portfolio over 10 days at the 99 percent confidence level.*
[^4]: *Define W0 as the initial investment and R as its rate of return, which is random. Assuming that the position is fixed, or that there is no trading, the portfolio value at the end of the target horizon is W = W0 (1 + R). The expected return and volatility of R are defined as Î¼ and Ïƒ. Define now the lowest portfolio value at the given confidence level c as W* = W0 (1 + R*). VAR measures the worst loss at some confidence level, so it is expressed as a positive number.*
[^5]:  *In its most general form, VAR can be derived from the probability distribution of the future portfolio value f(w). At a given confidence level c, we wish to find the worst possible realization W* such that the probability of exceeding this value is c, that is, c= âˆ«W* âˆž f(w)dw or such that the probability of a value lower than W*, p = P(w â‰¤ W*), is 1 âˆ’ c, that is, 1âˆ’c=âˆ«W*âˆ’âˆž f(w)dw=P(wâ‰¤W*)=p.*
