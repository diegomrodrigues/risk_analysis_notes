## Backtesting e N√≠vel de Confian√ßa: O Impacto na Valida√ß√£o de Modelos VAR

### Introdu√ß√£o
Dando continuidade ao estudo do *backtesting* de modelos VAR, este cap√≠tulo se aprofunda na influ√™ncia do n√≠vel de confian√ßa na efic√°cia dos testes. Como j√° estabelecido, o *backtesting* √© fundamental para avaliar a precis√£o e confiabilidade de um modelo VAR, e a escolha dos par√¢metros para este processo tem um impacto direto na sua capacidade de identificar poss√≠veis vieses [^1]. A an√°lise a seguir se concentrar√° em como o n√≠vel de confian√ßa, juntamente com o horizonte de tempo, afeta o poder dos testes, oferecendo *insights* sobre as melhores pr√°ticas para garantir a robustez da valida√ß√£o de modelos de risco.

### Conceitos Fundamentais
Como introduzido anteriormente, o *backtesting* √© o processo de compara√ß√£o entre as previs√µes de perdas geradas pelo modelo VAR e as perdas efetivamente observadas [^1]. O objetivo √© assegurar que o modelo esteja corretamente calibrado e capaz de prever a frequ√™ncia com que as perdas reais excedem o VAR estimado, dado o n√≠vel de confian√ßa predefinido. A escolha do n√≠vel de confian√ßa √© crucial, pois ela define a frequ√™ncia esperada de viola√ß√µes do VAR e, portanto, a quantidade de dados dispon√≠vel para a realiza√ß√£o do teste.

#### A Rela√ß√£o entre N√≠vel de Confian√ßa e Poder do Teste
O poder de um teste de hip√≥tese √© definido como a probabilidade de rejeitar corretamente uma hip√≥tese nula quando ela √© falsa [^2]. No contexto do *backtesting* de VAR, a hip√≥tese nula √© que o modelo VAR est√° bem calibrado, e o objetivo do teste √© identificar se o modelo est√°, de fato, gerando previs√µes adequadas [^3]. Um n√≠vel de confian√ßa muito alto, como 99%, significa que esperamos poucas viola√ß√µes do VAR em um determinado per√≠odo. Embora isso pare√ßa conservador, tal escolha limita drasticamente a quantidade de dados dispon√≠vel para an√°lise na cauda da distribui√ß√£o, reduzindo o poder do teste [^1].

**Proposi√ß√£o 6**
   *Um n√≠vel de confian√ßa muito alto diminui a frequ√™ncia esperada de viola√ß√µes do VAR, reduzindo o n√∫mero de observa√ß√µes dispon√≠veis na cauda da distribui√ß√£o, e, portanto, diminui o poder do teste.*

    *Proof:*
    I. **Initial Setup**:
        - Let $\alpha$ be the confidence level.
        - Let $N$ be the number of independent observations.
        - Let $X_i$ be indicator variables such that $X_i = 1$ if there is a violation at time $i$ and 0 otherwise.
        - The number of violations is given by $V=\sum_{i=1}^N X_i$.
        - From Teorema 1.1, we know that $V \sim Bin(N, 1 - \alpha)$.
        
    II. **Main Logical Steps**:
        - As shown in Corolario 1.2, the mean number of violations is given by $E[V] = N(1-\alpha)$.
        - A higher confidence level $\alpha$ implies a lower value of $1-\alpha$.
        - This causes $E[V]$ to decrease.
        - A smaller number of violations reduces the power of the backtesting tests, as it makes it harder to reject a false null hypothesis.
    
   III. **Key Transformations**:
       -  $\alpha \uparrow \implies (1-\alpha) \downarrow $
       - $(1-\alpha) \downarrow \implies  E[V] \downarrow $
       -  $E[V] \downarrow $  $\implies$  Test Power $\downarrow $
       
    IV. **Conclusion**:
        -  Therefore, higher values of the confidence level reduce the power of the test.  ‚ñ†
        
**Observa√ß√£o 6.1**
*A escolha do n√≠vel de confian√ßa tamb√©m pode ser interpretada como um *trade-off* entre a precis√£o do modelo e a robustez do backtesting. N√≠veis de confian√ßa mais altos priorizam a precis√£o do modelo em condi√ß√µes normais, enquanto n√≠veis de confian√ßa mais baixos favorecem a robustez da valida√ß√£o atrav√©s do *backtesting*. Esta observa√ß√£o ressalta que a escolha do n√≠vel de confian√ßa deve ser baseada nas particularidades do uso do modelo, pois n√≠veis de confian√ßa muito altos podem ocultar defici√™ncias do modelo.*

> üí° **Exemplo Num√©rico:**
> Suponha que estamos realizando backtesting de um modelo VAR usando dados di√°rios de negocia√ß√£o ao longo de um ano, com $N = 252$ dias √∫teis. Se definirmos o n√≠vel de confian√ßa para $\alpha = 0.99$ (99%), o n√∫mero esperado de viola√ß√µes √© $E[V] = 252 \times (1 - 0.99) = 2.52$ viola√ß√µes por ano. Isso significa que, em m√©dia, esperar√≠amos apenas cerca de 2 a 3 viola√ß√µes durante todo o ano. No entanto, se diminuirmos o n√≠vel de confian√ßa para $\alpha = 0.95$ (95%), o n√∫mero esperado de viola√ß√µes aumenta para $E[V] = 252 \times (1 - 0.95) = 12.6$. Essa diferen√ßa √© significativa. Com um n√≠vel de confian√ßa de 99%, a escassez de viola√ß√µes torna muito dif√≠cil determinar se o modelo est√° adequadamente calibrado, ou seja, o teste tem baixo poder. Por outro lado, um n√≠vel de confian√ßa de 95% fornece uma amostra maior de viola√ß√µes, permitindo uma avalia√ß√£o mais robusta. Um n√∫mero muito pequeno de viola√ß√µes (como no caso de 99%) pode levar a um erro do tipo II, onde n√£o rejeitamos um modelo VAR inadequado por falta de evid√™ncias, devido √† escassez de dados na cauda da distribui√ß√£o.
> ```mermaid
> graph LR
>     A[N√≠vel de Confian√ßa = 99%] -->|E[V] = 2.52| B(Poucas Viola√ß√µes);
>     C[N√≠vel de Confian√ßa = 95%] -->|E[V] = 12.6| D(Mais Viola√ß√µes);
>     B --> E[Baixo Poder do Teste];
>     D --> F[Alto Poder do Teste];
> ```

Em contraste, um n√≠vel de confian√ßa mais baixo, como 95%, aumenta a frequ√™ncia esperada de viola√ß√µes do VAR, o que, por sua vez, fornece mais dados para realizar o *backtesting* e aumentar o poder do teste. Isso torna o teste mais sens√≠vel a poss√≠veis vieses no modelo e aumenta a sua capacidade de detectar se as previs√µes do VAR est√£o consistentemente subestimando o risco. Em particular, podemos afirmar que:

**Proposi√ß√£o 7**
    *Um n√≠vel de confian√ßa mais baixo aumenta a probabilidade de rejeitar corretamente a hip√≥tese nula quando esta √© falsa, isto √©, aumenta o poder do teste.*

    *Proof:*
         I. **Initial Setup**:
           -  We assume that a well calibrated model should have, with probability $\alpha$, its outcome below VAR.
           - We have a backtesting framework that compares observed returns and the VAR.
        II. **Main Logical Steps**:
           - Lower confidence level implies a smaller $\alpha$, which implies a smaller VAR.
           - If the actual loss exceeds the VAR, it is considered a violation.
           - Lower confidence means a larger probability of such an event (a violation) under the null hypothesis.
           - Therefore, a lower $\alpha$ means that a higher number of violations are expected under the null hypothesis (as shown in Corolario 1.2).
           - When the null hypothesis is false (the model is not well calibrated), it will generate a violation rate that differs from the expected rate (it will generate more violations than if it was well calibrated).
           - If we expect more violations, a test has more power in detecting that the observed violation rate is significantly different from the expected.

        III. **Key Transformations**:
           - $\alpha \downarrow \implies$ Smaller VAR
           - Smaller VAR $\implies$ Larger number of violations
           - Larger number of violations under both the null and alternative hypothesis  $\implies$  Test Power $\uparrow $

       IV. **Conclusion**:
           - Therefore, a smaller confidence level implies greater power for a backtesting test. ‚ñ†

> üí° **Exemplo Num√©rico:**
>  Se continuarmos com o exemplo anterior de $N=252$ observa√ß√µes, ao diminuir o n√≠vel de confian√ßa de 99% para 95%, aumentamos a frequ√™ncia esperada de viola√ß√µes de 2.52 para 12.6. Essa mudan√ßa significa que o teste ter√° mais dados para avaliar se o modelo est√° gerando um n√∫mero de viola√ß√µes consistente com o n√≠vel de confian√ßa proposto. Se o modelo estiver sistematicamente subestimando o risco (gerando um n√∫mero de viola√ß√µes significativamente maior do que o esperado, como por exemplo, 20 viola√ß√µes em um ano), essa discrep√¢ncia ser√° mais facilmente detectada com 12.6 viola√ß√µes esperadas do que com apenas 2.52. Um teste de hip√≥tese com mais dados tem mais poder para detectar desvios em rela√ß√£o ao comportamento esperado, aumentando a probabilidade de corretamente rejeitar a hip√≥tese nula (de que o modelo est√° bem calibrado).
>
> Suponha que, ao aplicar um modelo VAR com n√≠vel de confian√ßa de 95%, observamos 20 viola√ß√µes em um ano. Usando um teste estat√≠stico, como o teste de propor√ß√£o de Kupiec, podemos avaliar se essa taxa de viola√ß√µes √© significativamente diferente da esperada (12.6). Se o teste demonstrar que 20 viola√ß√µes √© um resultado muito improv√°vel sob a hip√≥tese nula, rejeitamos essa hip√≥tese, concluindo que o modelo est√° subestimando o risco. Em contraste, se tiv√©ssemos usado um n√≠vel de confian√ßa de 99%, com apenas 2.52 viola√ß√µes esperadas, uma diferen√ßa de 20 viola√ß√µes se torna ainda mais discrepante, mas o menor n√∫mero de dados dificulta a distin√ß√£o entre um modelo ruim e variabilidade aleat√≥ria, reduzindo o poder do teste.

**Lema 7.1**
   *Para modelos VAR que s√£o usados para calcular requisitos de capital regulamentares, √© essencial avaliar n√£o apenas a capacidade de backtesting para identificar viola√ß√µes, mas tamb√©m a consequ√™ncia financeira dessas viola√ß√µes. Um modelo que sistematicamente subestima as perdas pode levar a capital insuficiente para cobrir as perdas, o que pode gerar problemas regulat√≥rios e instabilidade financeira.*
    
    *Proof Outline:*
    I.   **Initial Setup:**
         - Models used for regulatory capital must comply with regulatory requirements.
    II.  **Main Logical Steps:**
       - A model used for capital requirements must be accurate, especially at the tails.
       - A model with lower confidence level has, in theory, a higher rate of violations.
       - When a model has a violation, and the model is used for regulatory purposes, it implies a financial impact.
       - A model should correctly estimate the severity of the violation and the expected number of violations.
    III. **Conclusion:**
        - Therefore, a model must correctly estimates the number of violations and their impact for capital adequacy purposes.  ‚ñ†

**Observa√ß√£o 7.2**
   *√â importante notar que, embora um n√≠vel de confian√ßa menor aumente o poder do teste, a escolha n√£o deve ser puramente baseada em considera√ß√µes estat√≠sticas. N√≠veis de confian√ßa muito baixos podem levar a uma aceita√ß√£o indevida de modelos inadequados, uma vez que o teste ir√° tolerar um n√∫mero elevado de viola√ß√µes.*

No entanto, √© importante ressaltar que a escolha do n√≠vel de confian√ßa n√£o √© uma decis√£o arbitr√°ria. Ela deve ser guiada pelo objetivo do *backtesting* e pelas particularidades do modelo VAR que est√° sendo avaliado. Embora n√≠veis de confian√ßa mais baixos proporcionem maior poder aos testes, eles podem n√£o ser apropriados para aplica√ß√µes em que a precis√£o das estimativas na cauda da distribui√ß√£o √© cr√≠tica [^1].

#### A Import√¢ncia do Horizonte de Tempo na Pot√™ncia dos Testes
Como discutido anteriormente, o horizonte de tempo tamb√©m influencia o n√∫mero de observa√ß√µes independentes e, portanto, o poder dos testes de *backtesting* [^1]. De acordo com a Proposi√ß√£o 1, o n√∫mero de observa√ß√µes independentes √© inversamente proporcional ao tamanho do horizonte de tempo. Consequentemente, horizontes de tempo mais curtos, como um dia, proporcionam um maior n√∫mero de observa√ß√µes independentes, o que aumenta o poder estat√≠stico dos testes [^2].

**Proposi√ß√£o 8**
   *A escolha de um horizonte de tempo mais curto aumenta o n√∫mero de observa√ß√µes independentes e, consequentemente, aumenta o poder do teste, dado um n√≠vel de confian√ßa fixo.*
   
   *Proof:*
    I. **Initial Setup**:
        - Let $T$ be the total number of days in the period.
        - Let $h$ be the length of the time horizon in days.
        - The number of independent observations is given by $N \approx \frac{T}{h}$.
        
    II. **Main Logical Steps**:
        - From Proposi√ß√£o 1, we know that a shorter horizon increases the number of independent observations.
        - From Proposi√ß√£o 2, an increase in the number of independent observations directly leads to an increase in the sensitivity of backtesting.

    III. **Key Transformations**:
       -  $h \downarrow \implies N \uparrow $
        -   $N \uparrow \implies$ Test power $\uparrow$

    IV. **Conclusion**:
        - Therefore, reducing the horizon increases the power of the test.  ‚ñ†

> üí° **Exemplo Num√©rico:**
> Suponha que temos um per√≠odo de avalia√ß√£o de $T = 252$ dias (um ano). Se utilizarmos um horizonte de tempo de $h=1$ dia, teremos aproximadamente $N \approx \frac{252}{1} = 252$ observa√ß√µes independentes. Isso nos d√° uma grande quantidade de dados para realizar o backtesting. No entanto, se aumentarmos o horizonte de tempo para, por exemplo, $h=10$ dias, o n√∫mero de observa√ß√µes independentes diminui para $N \approx \frac{252}{10} = 25.2$. Com um n√∫mero menor de observa√ß√µes, o poder do teste de backtesting √© reduzido, o que significa que ser√° mais dif√≠cil detectar desvios do comportamento esperado do modelo.
> ```mermaid
> graph LR
>     A[Horizonte = 1 dia] -->|N = 252| B(Muitas Observa√ß√µes);
>     C[Horizonte = 10 dias] -->|N = 25.2| D(Poucas Observa√ß√µes);
>     B --> E[Alto Poder do Teste];
>     D --> F[Baixo Poder do Teste];
> ```

**Corol√°rio 2.1**
   *A combina√ß√£o de um n√≠vel de confian√ßa mais baixo e um horizonte de tempo mais curto maximiza o poder do teste de *backtesting*, permitindo identificar vieses no modelo com maior efic√°cia.*
  *Proof:*
    I. **Initial Setup**:
        - From Proposi√ß√£o 7, a lower confidence level increases the power of a test.
        - From Proposi√ß√£o 8, a shorter horizon increases the power of a test.
        
    II. **Main Logical Steps**:
        - Both a lower confidence and a shorter time horizon lead to more violations, and a greater number of observations to assess the model.
        - Therefore, a lower $\alpha$ and a shorter $h$ together maximize the power of a test.

    III. **Key Transformations**:
       -  $\alpha \downarrow \implies$ Test power $\uparrow$
        - $h \downarrow \implies$ Test power $\uparrow$

    IV. **Conclusion**:
        - Therefore, combining these parameters maximizes the power of the test.  ‚ñ†
        
**Teorema 2.2**
    *Existem cen√°rios onde o poder de um teste de backtesting pode ser melhorado atrav√©s de t√©cnicas de *bootstrapping*. Estas t√©cnicas, ao simular m√∫ltiplas amostras a partir dos dados originais, conseguem gerar um conjunto maior de realiza√ß√µes para comparar com o VAR, particularmente em situa√ß√µes com poucas viola√ß√µes ou horizontes de tempo mais longos. Specifically, by creating multiple simulated data sets and recalculating the number of violations in each of these sets, we can build an empirical distribution of the number of violations under the null hypothesis and calculate a p-value by checking how unusual the observed number of violations is compared to this empirical distribution. This approach is particularly useful when the number of observed violations is small, because it can provide a better estimate of the expected distribution of violations than relying on the theoretical binomial distribution.*
    
    *Proof Outline:*
    I.   **Initial Setup:**
         - Let $D$ be the original data set.
         - The number of violations is given by $V$
    II.  **Main Logical Steps:**
       - *Bootstrapping* is a sampling technique with replacement used to estimate distributions.
       - By repeatedly sampling with replacement from the original data, multiple simulated data sets $D_i$ can be generated.
       - For each simulated data set $D_i$, a number of violations $V_i$ can be calculated.
       - These multiple realizations of violations $V_i$ provides us with a more robust distribution for comparison with the observed violation count from the original data.
       - This provides a better assessment of the expected number of violations when compared with the binomial distribution.
    III. **Conclusion:**
        - Therefore, *bootstrapping* can be used to generate more realizations and improve test power.  ‚ñ†

√â crucial, entretanto, garantir que o modelo VAR seja adequado para o horizonte de tempo escolhido para o *backtesting*. Como o VAR assume que o portf√≥lio √© "congelado" ao longo do horizonte, o modelo pode n√£o ser preciso se o horizonte for muito longo ou se o portf√≥lio sofrer mudan√ßas significativas durante esse per√≠odo [^1].

#### Implica√ß√µes Pr√°ticas para o Backtesting
Considerando a teoria exposta, fica claro que a escolha dos par√¢metros para o *backtesting* n√£o √© trivial. Recomenda-se que:

1.  **N√≠vel de Confian√ßa:** Opte por um n√≠vel de confian√ßa mais baixo, como 95%, para aumentar a frequ√™ncia de viola√ß√µes e o poder dos testes. Em situa√ß√µes onde se busca alta precis√£o na cauda da distribui√ß√£o, um n√≠vel de confian√ßa mais alto pode ser considerado. *It is important to note that extremely low confidence levels should be avoided, as they may lead to the model being too permissive and therefore not useful.*
2.  **Horizonte de Tempo:** Utilize um horizonte de tempo mais curto, como um dia, para aumentar o n√∫mero de observa√ß√µes independentes e a capacidade do teste de detectar vieses. Ajuste o horizonte com base na natureza dos ativos do portf√≥lio e do tempo necess√°rio para liquidar as posi√ß√µes.
3.  **Testes Complementares:** Adicione outros testes, como o teste de Lopez, testes de correla√ß√£o serial e testes baseados em fun√ß√µes de perda, para complementar a an√°lise do desempenho do modelo. Isso fornecer√° uma vis√£o mais abrangente da qualidade do modelo VAR, como afirmado na Proposi√ß√£o 5.
4.  **Avalia√ß√£o da Autocorrela√ß√£o:** Analise cuidadosamente a presen√ßa de autocorrela√ß√£o nas viola√ß√µes do VAR para evitar conclus√µes equivocadas sobre a validade do modelo. Testes como o de Christoffersen, conforme Lema 3, s√£o adequados para esta an√°lise.
5.  **Revis√£o Constante:** Os testes devem ser revisados e adaptados periodicamente para refletir as mudan√ßas no ambiente de mercado e nas caracter√≠sticas do portf√≥lio.

### Conclus√£o
A escolha do n√≠vel de confian√ßa e do horizonte de tempo no *backtesting* de modelos VAR s√£o decis√µes que impactam diretamente o poder dos testes e a capacidade de identificar vieses nos resultados. √â recomend√°vel utilizar n√≠veis de confian√ßa mais baixos e horizontes de tempo mais curtos, dentro de uma avalia√ß√£o razo√°vel, para maximizar o n√∫mero de observa√ß√µes e a capacidade do *backtesting* de detectar inconsist√™ncias no modelo. Como o VAR √© uma medida de risco sob condi√ß√µes normais de mercado, o uso de *backtesting* com horizonte de um dia √© adequado para validar o modelo sob essas condi√ß√µes, e serve de base para a tomada de decis√µes com o VAR [^1]. No entanto, √© crucial considerar que o *backtesting* n√£o √© a √∫nica ferramenta para validar modelos de risco. Ele deve ser complementado por testes de stress que avaliam o desempenho do modelo em condi√ß√µes extremas de mercado. O pr√≥ximo passo l√≥gico nessa an√°lise √©, portanto, estudar os testes de stress que complementam o *backtesting*.

### Refer√™ncias
[^1]: Este cap√≠tulo do livro (e textos anteriores quando dispon√≠veis)
[^2]: Defini√ß√£o de poder de um teste estat√≠stico.
[^3]: Refer√™ncia a outros textos para detalhes sobre a hip√≥tese nula no *backtesting* de VAR.
