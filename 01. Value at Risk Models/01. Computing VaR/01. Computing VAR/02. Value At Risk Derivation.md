### Computing VAR from Probability Density Functions

### Introdu√ß√£o

Como vimos anteriormente, o Value at Risk (VAR) √© uma medida estat√≠stica de risco de perda, crucial para a gest√£o de riscos financeiros e comunica√ß√£o com stakeholders [^1]. O VAR quantifica a perda m√°xima esperada em um determinado horizonte de tempo, com um certo n√≠vel de confian√ßa [^2]. Este cap√≠tulo aprofunda a metodologia de c√°lculo do VAR, explorando duas abordagens principais: a n√£o param√©trica, que se baseia na distribui√ß√£o emp√≠rica dos dados, e a param√©trica, que utiliza aproxima√ß√µes como a distribui√ß√£o normal [^1]. Este cap√≠tulo tamb√©m aborda como o VAR pode ser derivado da fun√ß√£o densidade de probabilidade (PDF) dos lucros e perdas, destacando a import√¢ncia das escolhas entre m√©todos emp√≠ricos e aproxima√ß√µes param√©tricas.

### Conceitos Fundamentais

Conforme discutido, o VAR pode ser calculado a partir da an√°lise da fun√ß√£o densidade de probabilidade (PDF) dos lucros e perdas [^1]. A PDF, representada por $f(w)$, descreve a probabilidade de ocorr√™ncia de cada valor poss√≠vel de lucro ou perda. O objetivo do VAR √© encontrar o valor $W^*$ (o pior cen√°rio poss√≠vel) tal que a probabilidade de exceder essa perda seja igual a $1-c$, onde $c$ √© o n√≠vel de confian√ßa desejado [^5]. Isso √© matematicamente expresso como:

$$c = \int_{W^*}^{\infty} f(w) \, dw$$ [^5]

ou, equivalentemente, como:

$$1-c = \int_{-\infty}^{W^*} f(w) \, dw = P(w \leq W^*)$$ [^5]

Esta equa√ß√£o indica que a √°rea sob a PDF da esquerda para $W^*$ soma-se a $1-c$, representando a probabilidade de perdas iguais ou inferiores ao VAR. O valor $W^*$ √© o quantil da distribui√ß√£o correspondente √† probabilidade $1-c$.

Como mencionado anteriormente, existem duas abordagens principais para calcular o VAR a partir da PDF:

1.  **Abordagem Emp√≠rica (N√£o Param√©trica):** Nesta abordagem, a PDF √© derivada diretamente dos dados hist√≥ricos, sem assumir uma distribui√ß√£o espec√≠fica [^1]. O VAR √© ent√£o obtido a partir do quantil amostral da distribui√ß√£o emp√≠rica, sem a necessidade de estima√ß√£o de par√¢metros [^1].
2.  **Abordagem Param√©trica:** Aqui, a PDF √© aproximada por uma distribui√ß√£o param√©trica, como a distribui√ß√£o normal, com seus par√¢metros (m√©dia e desvio padr√£o) estimados a partir dos dados. O VAR √© ent√£o derivado da distribui√ß√£o param√©trica, utilizando o desvio padr√£o e o fator correspondente ao n√≠vel de confian√ßa [^1].

**Lema 2:** A escolha entre uma abordagem emp√≠rica e uma param√©trica depende da disponibilidade de dados, da complexidade da distribui√ß√£o dos lucros e perdas e dos objetivos da an√°lise. A abordagem emp√≠rica √© robusta a distribui√ß√µes n√£o normais, mas requer um hist√≥rico de dados suficientemente extenso, enquanto a abordagem param√©trica √© mais precisa quando a distribui√ß√£o dos dados pode ser aproximada por uma fam√≠lia param√©trica, como a normal.

**Lema 2.1:** Em situa√ß√µes onde h√° poucos dados hist√≥ricos ou quando h√° mudan√ßas estruturais nos mercados financeiros, a combina√ß√£o das abordagens emp√≠ricas e param√©tricas, atrav√©s de t√©cnicas de *blending*, pode melhorar a precis√£o e robustez do VAR. A t√©cnica de *blending* consiste em utilizar a distribui√ß√£o emp√≠rica para modelar a parte central da distribui√ß√£o e a distribui√ß√£o param√©trica para modelar as caudas, combinando as duas abordagens de maneira apropriada.

**Lema 2.2:** Uma alternativa para o *blending* √© utilizar a teoria de valores extremos (EVT), que se concentra em modelar o comportamento das caudas da distribui√ß√£o. A EVT pode ser usada para modelar a parte relevante da distribui√ß√£o, focando nos piores casos, e fornecer uma estimativa mais precisa do VAR em situa√ß√µes onde as caudas s√£o pesadas ou apresentam um comportamento diferente do resto da distribui√ß√£o.

**Lema 2.3:** O uso de modelos de s√©ries temporais para capturar a depend√™ncia temporal dos retornos √© crucial, pois o VAR baseado em dados hist√≥ricos sem levar em conta a autocorrela√ß√£o pode levar a estimativas imprecisas, especialmente para ativos vol√°teis. Modelos como ARMA ou GARCH podem ser utilizados para modelar a evolu√ß√£o da volatilidade e melhorar a precis√£o da estimativa do VAR.

#### VAR Emp√≠rico (N√£o Param√©trico)

A abordagem emp√≠rica, ou n√£o param√©trica, n√£o faz suposi√ß√µes sobre a forma da distribui√ß√£o dos retornos. O VAR √© obtido diretamente dos dados atrav√©s do quantil amostral. Esta abordagem √© mais geral e robusta, pois n√£o imp√µe uma distribui√ß√£o particular aos dados, sendo apropriada quando n√£o h√° confian√ßa de que os dados se encaixam em uma distribui√ß√£o padr√£o [^4].

Para calcular o VAR emp√≠rico, os dados hist√≥ricos de lucros e perdas s√£o ordenados do menor para o maior. O VAR correspondente a um n√≠vel de confian√ßa $c$ √© o valor que deixa uma propor√ß√£o $1-c$ de observa√ß√µes √† sua esquerda [^5]. Formalmente, se temos $N$ observa√ß√µes, e desejamos um VAR com n√≠vel de confian√ßa $c$, o valor $W^*$ √© o $k$-√©simo menor valor, onde $k = N(1-c)$, ou seja, o quantil correspondente.

> üí° **Exemplo Num√©rico:**
>
> Suponha que temos um conjunto de 10 retornos di√°rios de um ativo: \[-0.025, 0.01, -0.015, 0.02, -0.005, 0.03, -0.04, 0.012, -0.02, 0.028].
>
> Para calcular o VAR emp√≠rico com um n√≠vel de confian√ßa de 95% (c=0.95), primeiro ordenamos os retornos do menor para o maior: \[-0.04, -0.025, -0.02, -0.015, -0.005, 0.01, 0.012, 0.02, 0.028, 0.03].
>
> O n√∫mero de observa√ß√µes √© N = 10. O valor de k √© calculado como  $k = N(1-c) = 10 * (1-0.95) = 10 * 0.05 = 0.5$. Como k n√£o √© inteiro, precisamos interpolar. Usando interpola√ß√£o linear entre as observa√ß√µes nas posi√ß√µes 0 (arredondando para baixo) e 1 (arredondando para cima), pegamos  o valor entre o primeiro e o segundo elementos ordenados.
>
>  O √≠ndice do quantil a ser encontrado √© dado por $k = N \cdot (1-c) = 10 \cdot (1-0.95) = 0.5$.
>
>  Como k=0.5 n√£o √© um inteiro, o VAR est√° entre o primeiro e o segundo menor valor.
>
> O primeiro menor valor √© -0.04 e o segundo menor valor √© -0.025.
>
>  Interpola√ß√£o linear: $-0.04 + 0.5*(-0.025 - (-0.04)) = -0.04 + 0.5 * 0.015= -0.0325$.
>
>  Portanto, o VAR emp√≠rico a 95% √© aproximadamente -3.25%. Isso significa que h√° 5% de chance de perder mais do que 3.25% do valor do ativo em um dia.

**Proposi√ß√£o 2:** O VAR emp√≠rico √© mais apropriado quando a distribui√ß√£o dos lucros e perdas √© complexa e n√£o pode ser razoavelmente aproximada por uma distribui√ß√£o param√©trica. No entanto, sua precis√£o depende fortemente do tamanho da amostra e da representatividade dos dados hist√≥ricos para o comportamento futuro.

**Proof of Proposition 2:**

I.  **Initial Setup and Definitions:**
   - Let $X = \{x_1, x_2, \ldots, x_N\}$ be a historical dataset of $N$ profit and loss observations.
   - Let $X_{sorted} = \{x_{(1)}, x_{(2)}, \ldots, x_{(N)}\}$ be the sorted dataset where $x_{(1)}$ is the smallest value and $x_{(N)}$ is the largest.
   - Let $c$ be the desired confidence level, and $\alpha = 1 - c$.
   - The empirical VAR at level $c$, denoted as $VAR_c^{emp}$, is defined as the $\alpha$-quantile of the dataset $X$.

II.  **Method of Quantile Estimation:**
    - The position of the sample quantile can be determined by computing $k = N \times \alpha$.
    - If $k$ is an integer, the empirical quantile is $x_{(k)}$.
    - If $k$ is not an integer, some interpolation is performed between $x_{(\lfloor k \rfloor)}$ and $x_{(\lceil k \rceil)}$, where $\lfloor k \rfloor$ is the integer floor of $k$ and $\lceil k \rceil$ is the integer ceiling of $k$.
    - For example, if $k=2.5$, a linear interpolation could give  $x_{(2.5)} = (x_{(2)} + x_{(3)})/2$.

III.  **Robustness to Non-Normality:**
    - The empirical method does not assume any particular form of the distribution. It only assumes that the sample is drawn from the true population of returns.
    - Therefore, the empirical VAR is robust to non-normality, skewness and fat-tails, which the normal distribution-based parametric VAR does not capture.

IV. **Dependence on Sample Size:**
  - The accuracy of the empirical VAR depends on the sample size $N$. A larger $N$ provides more accurate estimates.
  - With a small $N$, the estimate is prone to significant sampling variability.

V.  **Conclusion:**
   - The empirical VAR is robust to distribution assumptions but requires a sufficiently large and representative sample to be accurate. The empirical VAR makes no assumptions about the distribution of the returns and estimates the quantile using sample data directly. This method is more flexible compared to the parametric VAR, but it may not be as efficient.
   $\blacksquare$

**Corol√°rio 2:** A abordagem emp√≠rica pode ser aprimorada por t√©cnicas de suaviza√ß√£o, que reduzem a variabilidade do VAR estimada. M√©todos de estima√ß√£o de densidade kernel, como o estimador de Parzen-Rosenblatt, podem ser utilizados para suavizar o histograma dos dados e fornecer uma estimativa mais precisa da fun√ß√£o densidade.

**Corol√°rio 2.1:** T√©cnicas de *resampling*, como o *bootstrap*, podem ser usadas para construir intervalos de confian√ßa para o VAR emp√≠rico, fornecendo uma medida da imprecis√£o da estimativa. O bootstrap permite gerar m√∫ltiplas amostras a partir da amostra original e calcular o VAR para cada uma delas, permitindo estimar a variabilidade da estimativa.

**Corol√°rio 2.2:** A abordagem emp√≠rica tamb√©m pode ser adaptada para acomodar diferentes pondera√ß√µes para observa√ß√µes hist√≥ricas, dando maior import√¢ncia para os dados mais recentes. T√©cnicas de *exponentially weighted moving average (EWMA)* podem ser utilizadas para criar uma vers√£o ponderada do VAR emp√≠rico, adaptando-se a mudan√ßas na volatilidade ao longo do tempo.

**Corol√°rio 2.3:** Para lidar com a escassez de dados hist√≥ricos, a abordagem emp√≠rica pode ser combinada com dados simulados gerados por modelos de s√©ries temporais, criando um conjunto de dados aumentado que pode melhorar a precis√£o do VAR. Essa abordagem h√≠brida √© √∫til em situa√ß√µes onde o hist√≥rico √© curto ou n√£o representativo.

**Corol√°rio 2.4:** Uma alternativa √† interpola√ß√£o linear para estimar quantis n√£o inteiros √© utilizar a interpola√ß√£o por vizinhos mais pr√≥ximos ou outras t√©cnicas de interpola√ß√£o mais sofisticadas. A escolha da t√©cnica de interpola√ß√£o pode ter um impacto na precis√£o da estimativa, especialmente em distribui√ß√µes com grandes mudan√ßas na densidade.

#### VAR Param√©trico

O VAR param√©trico simplifica o c√°lculo ao assumir que os lucros e perdas seguem uma distribui√ß√£o param√©trica, geralmente a distribui√ß√£o normal [^6]. Esta suposi√ß√£o permite derivar o VAR utilizando o desvio padr√£o e o n√≠vel de confian√ßa desejado.

A distribui√ß√£o normal padr√£o, $\Phi(\epsilon)$, com m√©dia zero e desvio padr√£o unit√°rio, √© utilizada para determinar o fator de ajuste $\alpha$ correspondente ao n√≠vel de confian√ßa $c$. O VAR √© ent√£o calculado como:

$$VAR(mean) = -W_0(R^* - \mu) = W_0 \alpha \sigma \sqrt{\Delta t}$$ [^7]

ou, em termos absolutos:

$$VAR(zero) = -W_0 R^* = W_0 (\alpha \sigma \sqrt{\Delta t} - \mu \Delta t)$$ [^7]

onde $\alpha$ √© o quantil da distribui√ß√£o normal padr√£o associado √† probabilidade $1-c$, e $\sigma$ √© o desvio padr√£o dos retornos.

> üí° **Exemplo Num√©rico:**
>
> Considere um portf√≥lio com valor inicial $W_0 = 1.000.000$. Suponha que os retornos di√°rios seguem uma distribui√ß√£o normal com m√©dia $\mu = 0.0005$ (0.05%) e desvio padr√£o $\sigma = 0.01$ (1%).  Queremos calcular o VAR a um n√≠vel de confian√ßa de 99% (c=0.99).
>
>   1. **Determinar o valor de $\alpha$:** O n√≠vel de signific√¢ncia $\alpha$ √© $1 - c = 1 - 0.99 = 0.01$.
>   2. **Encontrar o quantil:**  Para um n√≠vel de confian√ßa de 99%, o quantil correspondente da distribui√ß√£o normal padr√£o √©  $z_{0.01} \approx -2.33$.  Isso significa que h√° 1% de probabilidade de ocorrer uma perda inferior a esse valor.
>   3. **Calcular o VAR:**
>
>       $\text{VAR(mean)} = W_0 \times (-z_{0.01} \times \sigma ) = 1,000,000 * (-(-2.33) * 0.01) = 1,000,000 * 0.0233 = 23,300 $
>
>
>   O VAR(mean) √© aproximadamente $23,300$. Isso significa que h√° uma chance de 1% de que a perda di√°ria exceda  $23,300$.
>
>
>   Se quisermos o VAR absoluto, consideramos o retorno m√©dio:
>
>  $\text{VAR(zero)} = W_0  *  ( (-z_{0.01} \times \sigma) - \mu) = 1,000,000  *  ((2.33 * 0.01) - 0.0005) = 1,000,000 * 0.0228 \approx 22,800$
>
>  Isso quer dizer que com 99% de confian√ßa, n√£o esperamos perder mais de 22,800 em um dia.
>
>  Nota: O valor do VAR depende de usar o zero como ponto de refer√™ncia ou a m√©dia como ponto de refer√™ncia.
>

**Proposi√ß√£o 3:** O VAR param√©trico √© mais simples e computacionalmente eficiente do que o VAR emp√≠rico, mas depende fortemente da validade da suposi√ß√£o da distribui√ß√£o normal. Se a distribui√ß√£o dos lucros e perdas desviar significativamente da normal, o VAR param√©trico pode ser impreciso e subestimar o risco.

**Proof of Proposition 3**

I.  **Initial Setup and Definitions:**
   - Assume that the distribution of returns $R$ follows a normal distribution, $R \sim N(\mu, \sigma^2)$.
   - Let $W_0$ be the initial portfolio value.
   - Let $c$ be the desired confidence level, and $\alpha = 1-c$.
   - The parametric VAR at level $c$, denoted as $VAR_c^{par}$, is based on the quantiles of the normal distribution.
    - $\Phi(z)$ is the cumulative distribution function of the standard normal distribution.
    -  $z_\alpha$ is the $\alpha$-quantile of the standard normal distribution.

II.  **Method of Parametric Estimation:**
    - Calculate the standard deviation $\sigma$ of the returns.
    - Find the normal quantile $z_{\alpha}$ associated to the probability $1-c$, such that $\Phi(z_\alpha) = \alpha$ where $\Phi$ is the standard normal cumulative distribution function.
    - The return cut-off is $R^* = \mu -z_\alpha \sigma$
    - Calculate the VAR as $VAR_c^{par} = -W_0 (R^* - \mu) = W_0 z_\alpha \sigma$.

III.  **Computational Efficiency:**
    - The parametric VAR is computationally simple. It only requires an estimate of the mean and standard deviation. The quantile can be read directly from the normal distribution table.

IV. **Dependence on Normality:**
   - The parametric VAR assumes that returns follow a normal distribution. This assumption is not always valid. Financial data may have fat tails, or show skewness that is not captured by the normal distribution.
   - If the normal assumption does not hold, the estimated $VAR_c^{par}$ will not be precise and can underestimate the risk.

V.  **Conclusion:**
   - The parametric VAR method is computationally efficient but depends critically on the normality assumption. If this assumption is violated, the estimated VAR will be biased.
   $\blacksquare$

**Corol√°rio 3:** Alternativas √† distribui√ß√£o normal, como a distribui√ß√£o t-Student, podem ser utilizadas no c√°lculo do VAR param√©trico para modelar distribui√ß√µes com caudas pesadas. A distribui√ß√£o t-Student possui um par√¢metro de graus de liberdade que permite ajustar a espessura das caudas.

**Corol√°rio 3.1:** Em cen√°rios onde os dados apresentam assimetria, abordagens param√©tricas que utilizam distribui√ß√µes assim√©tricas como a distribui√ß√£o de Gumbel podem ser utilizadas para obter estimativas mais precisas do VAR. A escolha da distribui√ß√£o param√©trica deve ser validada por testes de ader√™ncia aos dados.

**Corol√°rio 3.2:** A metodologia param√©trica pode ser estendida para modelos multivariados, nos quais as rela√ß√µes entre m√∫ltiplos ativos podem ser modeladas atrav√©s de matrizes de covari√¢ncia. A modelagem multivariada √© fundamental para calcular o VAR de portf√≥lios diversificados, permitindo capturar as interdepend√™ncias entre os ativos.

**Corol√°rio 3.3:** A fam√≠lia de distribui√ß√µes el√≠pticas, que inclui a distribui√ß√£o normal e a t-Student, pode ser utilizada no VAR param√©trico para modelar dados que exibem simetria em torno da m√©dia, mas com diferentes graus de achatamento e caudas pesadas.

**Corol√°rio 3.4:** Para lidar com a instabilidade dos par√¢metros da distribui√ß√£o param√©trica ao longo do tempo, podem ser utilizados modelos param√©tricos com par√¢metros variantes no tempo, como modelos GARCH ou modelos de volatilidade estoc√°stica. Esses modelos permitem que os par√¢metros da distribui√ß√£o param√©trica se ajustem √†s mudan√ßas nas condi√ß√µes de mercado.

### Conclus√£o

Este cap√≠tulo explorou as duas principais metodologias para derivar o VAR a partir da fun√ß√£o densidade de probabilidade (PDF) dos lucros e perdas: a abordagem emp√≠rica (n√£o param√©trica) e a param√©trica, com foco na distribui√ß√£o normal. A abordagem emp√≠rica √© mais robusta e n√£o imp√µe nenhuma forma espec√≠fica √† distribui√ß√£o dos dados, mas depende da qualidade e quantidade dos dados dispon√≠veis. J√° a param√©trica, √© mais eficiente em termos de computa√ß√£o, por√©m, √© sens√≠vel √† validade da suposi√ß√£o da distribui√ß√£o utilizada. A escolha da metodologia depende do contexto, da disponibilidade de dados e das caracter√≠sticas espec√≠ficas da distribui√ß√£o dos lucros e perdas [^1]. √â crucial entender as limita√ß√µes de cada m√©todo para aplicar o VAR de forma eficaz na gest√£o de risco financeiro. Al√©m disso, t√©cnicas de *blending*, teoria de valores extremos, suaviza√ß√£o, *resampling*, modelagem de volatilidade com EWMA, modelos multivariados, e testes de ader√™ncia s√£o complementos que podem melhorar a precis√£o e robustez da estimativa do VAR. O uso de modelos de s√©ries temporais, modelos com par√¢metros vari√°veis no tempo, e t√©cnicas de interpola√ß√£o sofisticadas s√£o tamb√©m importantes para aprimorar a acur√°cia e confiabilidade das estimativas do VAR.

### Refer√™ncias
[^1]: *This chapter turns to a formal definition of value at risk (VAR)...*
[^2]: *With all the requisite tools in place, we now can formally define the value at risk (VAR) of a portfolio...*
[^4]:  *The most general method makes no assumption about the shape of the distribution of returns...*
[^5]: *In its most general form, VAR can be derived from the probability dis- tribution of the future portfolio value f(w)...*
[^6]:  *The VAR computation can be simplified considerably if the distribution can be assumed to belong to a parametric family...*
[^7]: *Thus the problem of finding VAR is equivalent to finding the devi- ate a such that the area to the left of it is equal to 1 c...*
