### Computing Value at Risk (VAR)

### Introdu√ß√£o
Este cap√≠tulo dedica-se √† explora√ß√£o do Value at Risk (VAR), uma m√©trica estat√≠stica essencial para a gest√£o de risco financeiro. O VAR, como apresentado, quantifica o risco de perdas potenciais em um √∫nico valor, facilitando a comunica√ß√£o de riscos de trading a diversos stakeholders, desde a alta administra√ß√£o at√© os acionistas [^1]. A premissa fundamental do VAR, alinhada com medidas de risco tradicionais, √© que o portf√≥lio atual permanece "congelado" ao longo do horizonte de tempo considerado [^1]. A seguir, exploraremos em detalhes a defini√ß√£o formal de VAR, seus m√©todos de c√°lculo e os fatores que influenciam sua precis√£o.

### Conceitos Fundamentais

O Value at Risk (VAR) √© definido como a maior perda potencial sobre um dado horizonte, com uma baixa probabilidade pr√©-especificada de que a perda real seja maior [^2].  Esta defini√ß√£o envolve dois fatores quantitativos cruciais: o horizonte de tempo e o n√≠vel de confian√ßa. Formalmente, seja $c$ o n√≠vel de confian√ßa e $L$ a perda, medida como um n√∫mero positivo. O VAR √© o menor valor de perda em valor absoluto, que satisfaz a seguinte condi√ß√£o:

$$P(L > VAR) \leq 1 - c$$ [^2]

Por exemplo, com um n√≠vel de confian√ßa de 99% ($c = 0.99$), o VAR representa a perda de corte tal que a probabilidade de uma perda maior √© inferior a 1% [^2].

O c√°lculo do VAR pode ser realizado de duas maneiras principais [^1]:

1.  **Abordagem N√£o Param√©trica:** Utiliza a distribui√ß√£o emp√≠rica real dos dados, ou seja, sem assumir uma forma espec√≠fica para a distribui√ß√£o, derivando o VAR do quantil amostral [^1].
2.  **Abordagem Param√©trica:** Utiliza uma aproxima√ß√£o param√©trica, como a distribui√ß√£o normal, derivando o VAR a partir do desvio padr√£o [^1].

√â fundamental destacar que o VAR √© uma estimativa, e como tal, est√° sujeita a imprecis√µes [^2].  Diferentes amostras de dados podem levar a diferentes estimativas de VAR. Portanto, a apresenta√ß√£o de bandas de confian√ßa para o VAR √© essencial para fornecer aos usu√°rios uma no√ß√£o da imprecis√£o inerente [^2].

**Observa√ß√£o 1:** A imprecis√£o do VAR tamb√©m pode ser analisada atrav√©s de t√©cnicas de *bootstrapping*, que permitem gerar m√∫ltiplas amostras a partir dos dados originais, e calcular o VAR para cada uma destas amostras. A distribui√ß√£o dos valores de VAR obtidos a partir do *bootstrap* pode fornecer um intervalo de confian√ßa mais robusto para o VAR.

**Observa√ß√£o 2:** Al√©m do *bootstrapping*, m√©todos de Monte Carlo tamb√©m podem ser utilizados para estimar o VAR. Nesses m√©todos, simula√ß√µes de trajet√≥rias futuras dos fatores de risco s√£o geradas com base em modelos estoc√°sticos, permitindo a constru√ß√£o de uma distribui√ß√£o de perdas e, consequentemente, a estimativa do VAR e de seus intervalos de confian√ßa.

**Observa√ß√£o 3:** √â importante notar que, independentemente do m√©todo de c√°lculo, o VAR √© uma medida de risco pontual e n√£o informa sobre a magnitude das perdas que podem exceder o valor do VAR. Para abordar essa limita√ß√£o, medidas como o Expected Shortfall (ES) ou Conditional Value at Risk (CVaR) s√£o frequentemente utilizadas.

#### Etapas no C√°lculo do VAR

O c√°lculo do VAR envolve as seguintes etapas [^3]:

1.  **Marca√ß√£o a Mercado do Portf√≥lio:** Determina√ß√£o do valor atual do portf√≥lio (por exemplo, \$ 100 milh√µes) [^3].
2.  **Medi√ß√£o da Variabilidade do Fator de Risco:** Avalia√ß√£o da volatilidade do fator de risco (por exemplo, 15% ao ano) [^3].
3.  **Defini√ß√£o do Horizonte de Tempo:** Especifica√ß√£o do per√≠odo de deten√ß√£o do portf√≥lio (por exemplo, 10 dias √∫teis) [^3].
4.  **Defini√ß√£o do N√≠vel de Confian√ßa:** Escolha do n√≠vel de confian√ßa (por exemplo, 99%, resultando em um fator de 2.33 para uma distribui√ß√£o normal) [^3].
5.  **Relat√≥rio da Perda Potencial:** Combina√ß√£o das informa√ß√µes anteriores para gerar uma distribui√ß√£o de probabilidade das receitas, resumida pelo VAR [^3].

**Lema 1:**  A variabilidade do fator de risco, mencionada no passo 2, pode ser estimada utilizando diferentes m√©todos, como a volatilidade hist√≥rica, a volatilidade impl√≠cita (extra√≠da de op√ß√µes), ou modelos GARCH, dependendo da complexidade e dos dados dispon√≠veis. O m√©todo escolhido impacta diretamente na precis√£o do VAR.

**Lema 1.1:** A escolha do modelo para estimar a variabilidade do fator de risco deve levar em considera√ß√£o o comportamento dos dados. Modelos de volatilidade condicional, como GARCH, s√£o mais adequados para ativos com volatilidade variante no tempo, enquanto a volatilidade hist√≥rica pode ser suficiente para ativos com volatilidade relativamente constante.

**Lema 1.2:** A variabilidade do fator de risco pode tamb√©m ser estimada utilizando t√©cnicas de *machine learning*, como redes neurais artificiais, especialmente quando o comportamento dos fatores de risco √© complexo e n√£o linear. Estas t√©cnicas podem aprender padr√µes nos dados que n√£o seriam capturados por modelos tradicionais.

#### VAR N√£o Param√©trico
Este m√©todo n√£o faz suposi√ß√µes sobre a forma da distribui√ß√£o dos retornos [^4]. Define-se $W_0$ como o investimento inicial e $R$ como a taxa de retorno, que √© aleat√≥ria [^4]. O valor do portf√≥lio no final do horizonte √© dado por $W = W_0(1+R)$. O retorno esperado e a volatilidade de $R$ s√£o representados por $\mu$ e $\sigma$, respectivamente [^4]. O VAR relativo √© definido como a perda em rela√ß√£o √† m√©dia no horizonte:

$$VAR(mean) = E(W) - W^* = -W_0(R^*-\mu)$$ [^4]

Onde $W^*$ √© o menor valor do portf√≥lio com um determinado n√≠vel de confian√ßa $c$.  J√° o VAR absoluto √© definido como a perda em rela√ß√£o a zero:

$$VAR(zero) = W_0 - W^* = -W_0R^*$$ [^4]

O VAR n√£o param√©trico √© derivado do quantil da distribui√ß√£o, que √© o valor de corte com uma probabilidade fixa de ser excedido. Essa especifica√ß√£o √© v√°lida para qualquer distribui√ß√£o, seja ela discreta, cont√≠nua, de cauda grossa ou fina [^5].  Por exemplo, dado um histograma de receitas di√°rias, o VAR no n√≠vel de confian√ßa de 95% corresponde ao valor que deixa 5% dos dados na cauda esquerda da distribui√ß√£o [^5].

> üí° **Exemplo Num√©rico:**
> Suponha que voc√™ tenha um portf√≥lio de a√ß√µes com um investimento inicial de $W_0 = \$1,000,000$. Voc√™ coletou dados hist√≥ricos dos retornos di√°rios nos √∫ltimos 250 dias. Ap√≥s ordenar os retornos do menor para o maior, voc√™ observa que o 13¬∫ menor retorno (correspondendo ao 5% inferior, pois 13/250 ‚âà 0.05) √© de -3.5%. Este √© o quantil correspondente a um n√≠vel de confian√ßa de 95%.
>
> Assim, utilizando o VAR n√£o param√©trico:
>
> *   **VAR Absoluto:**  $VAR(zero) = -W_0 R^* = - \$1,000,000 * (-0.035) = \$35,000$. Isso significa que h√° uma chance de 5% de perder pelo menos \$35,000 em um dia.
>
> *   **VAR Relativo (√† m√©dia):** Suponha que o retorno m√©dio di√°rio  $\mu$ tenha sido de 0.05%, ent√£o, $VAR(mean) = -W_0(R^* - \mu) =  -\$1,000,000 * (-0.035 - 0.0005) = \$35,500$.  Neste caso, a perda potencial em rela√ß√£o √† m√©dia do dia anterior √© de \$35,500, com 5% de chance de ser excedida.

**Proposi√ß√£o 1:** O VAR n√£o param√©trico √© robusto a distribui√ß√µes n√£o normais, mas depende da disponibilidade de uma quantidade suficiente de dados para estimar os quantis com precis√£o. Se o hist√≥rico de dados for curto, a estimativa do VAR pode ser inst√°vel e variar substancialmente.

**Proposi√ß√£o 1.1:** Uma alternativa para lidar com a instabilidade do VAR n√£o param√©trico em amostras pequenas √© utilizar t√©cnicas de *resampling* como o *moving block bootstrap*, que preserva a depend√™ncia temporal nos dados, ao contr√°rio do *bootstrap* padr√£o.

**Proposi√ß√£o 1.2:** M√©todos de estima√ß√£o de densidade n√£o param√©tricos, como os estimadores de Parzen-Rosenblatt, podem ser usados para obter uma estimativa da distribui√ß√£o dos retornos, da qual o VAR pode ser calculado. Esses m√©todos suavizam os histogramas e permitem estimar a distribui√ß√£o em casos onde os dados s√£o esparsos.

#### VAR Param√©trico

O c√°lculo do VAR pode ser simplificado ao assumir que a distribui√ß√£o dos retornos pertence a uma fam√≠lia param√©trica, como a distribui√ß√£o normal [^6]. O VAR √© ent√£o derivado do desvio padr√£o do portf√≥lio, usando um fator multiplicativo que depende do n√≠vel de confian√ßa. A abordagem param√©trica envolve a estima√ß√£o de par√¢metros (desvio padr√£o) em vez de apenas ler o quantil da distribui√ß√£o emp√≠rica [^6]. A distribui√ß√£o normal padr√£o √© denotada por $\Phi(\epsilon)$, onde $\epsilon$ tem m√©dia zero e desvio padr√£o unit√°rio. O retorno de corte $R^*$ √© associado ao desvio normal $\alpha > 0$:

$$-\alpha = \frac{-|R^*|-\mu}{\sigma}$$ [^6]

A probabilidade de uma perda superior ao VAR √© dada por:

$$1-c = \int_{-\infty}^{W^*}f(w)dw = \int_{-\infty}^{R^*}f(r)dr = \int_{-\infty}^{-\alpha}\phi(\epsilon)d\epsilon$$ [^6]

O valor de $\alpha$ √© derivado das tabelas da distribui√ß√£o normal padr√£o cumulativa [^7]:

$$p = N(x) = \int_{-\infty}^{x}\phi(\epsilon)d\epsilon$$ [^7]

O retorno de corte e o VAR relativo √† m√©dia s√£o calculados por:

$$R^* = -\alpha \sigma + \mu$$ [^7]
$$VAR(mean) = -W_0(R^* - \mu) = W_0 \alpha \sigma \sqrt{\Delta t}$$ [^7]

E o VAR absoluto √©:

$$VAR(zero) = -W_0 R^* = W_0 (\alpha \sigma \sqrt{\Delta t} - \mu \Delta t)$$ [^7]

O VAR param√©trico √© simples, conveniente e, muitas vezes, mais preciso, desde que a suposi√ß√£o da distribui√ß√£o seja realista.

> üí° **Exemplo Num√©rico:**
> Vamos considerar um portf√≥lio de $W_0 = \$1,000,000$. Suponha que a volatilidade anual (desvio padr√£o) dos retornos seja $\sigma = 15\% = 0.15$, o retorno m√©dio anual $\mu = 10\% = 0.10$, e o horizonte de tempo seja $\Delta t = 10/252$ anos (aproximadamente 10 dias √∫teis em um ano de 252 dias). Queremos calcular o VAR com um n√≠vel de confian√ßa de 99%, o que corresponde a $\alpha = 2.33$ (valor da distribui√ß√£o normal padr√£o para 99%).
>
> * **C√°lculo do VAR Relativo:**
>    $VAR(mean) = W_0 \alpha \sigma \sqrt{\Delta t} = \$1,000,000 \times 2.33 \times 0.15 \times \sqrt{10/252} \approx \$22,029$. Isto significa que a perda esperada em rela√ß√£o √† m√©dia, no per√≠odo de 10 dias √∫teis, n√£o ultrapassar√° \$22,029 com 99% de confian√ßa.
>
> * **C√°lculo do VAR Absoluto:**
>    $VAR(zero) = W_0 (\alpha \sigma \sqrt{\Delta t} - \mu \Delta t) = \$1,000,000 \times (2.33 \times 0.15 \times \sqrt{10/252} - 0.10 \times 10/252)  \approx \$21,633$.
>    Isto indica que a perda potencial, n√£o ultrapassar√° \$21,633 com 99% de confian√ßa em rela√ß√£o a um portf√≥lio inicial de \$1,000,000.

**Teorema 1:**  A rela√ß√£o $VAR(mean) = W_0 \alpha \sigma \sqrt{\Delta t}$  assume que os retornos seguem uma distribui√ß√£o normal com m√©dia $\mu$ e desvio padr√£o $\sigma$ e que o horizonte de tempo $\Delta t$ √© expresso em anos. A corre√ß√£o $\sqrt{\Delta t}$ √© derivada da propriedade de que o desvio padr√£o de uma soma de vari√°veis aleat√≥rias independentes √© a raiz quadrada do n√∫mero de parcelas quando estas vari√°veis tem a mesma vari√¢ncia.

**Proof of Theorem 1:**

I. **Initial Setup and Definitions:**
   - Assume that the returns $R$ are normally distributed with mean $\mu$ and standard deviation $\sigma$.
   - The horizon is $\Delta t$, where $\Delta t$ is expressed in years.
   - We have defined $VAR(mean) = -W_0(R^* - \mu)$, where $R^* = -\alpha \sigma + \mu$ as per the parametric VAR definition.
   - We consider $n$ independent periods of returns. If a year has a large number of periods, $\Delta t = \frac{n}{\text{number of periods in a year}}$.
   - Let $R_i$ be the return in each of those sub-periods.

II. **Key Transformations and Derivations:**
    - If we assume returns are i.i.d., the return over the period $\Delta t$ is given by the sum of returns: $R_{\Delta t} = \sum_{i=1}^{n} R_i$.
    - We assume that each $R_i$ has the same mean $\mu_i$ and the same variance $\sigma_i^2 = \sigma^2/n$, so $\mu_{\Delta t} = \sum_{i=1}^{n} \mu_i = n\mu$.
    - The variance of the sum of i.i.d. variables is the sum of variances: $\sigma^2_{\Delta t} = \sum_{i=1}^{n} \sigma_i^2 = \sum_{i=1}^n \frac{\sigma^2}{n} = n\frac{\sigma^2}{n} = \sigma^2$
    - Thus, the standard deviation of the sum is $\sigma_{\Delta t} = \sigma \sqrt{n}$.
    - Since $\Delta t = \frac{n}{\text{number of periods in a year}}$, if we consider each period to be a day, and there are approximately 252 trading days in a year, $n = 252\Delta t$
    - Therefore $\sigma_{\Delta t} = \sigma\sqrt{252\Delta t}$.
    - Substituting $\sigma$ by $\sigma_{\Delta t}$ and $\mu$ by $\mu_{\Delta t}$, we get $VAR(mean) = W_0 \alpha \sigma_{\Delta t}= W_0 \alpha \sigma\sqrt{n} = W_0 \alpha \sigma \sqrt{252\Delta t}$.
    - If $\sigma$ is expressed as annualized, i.e., $\sigma = \sigma_{\text{annualized}}$ (which is standard in finance) then $\sigma_{daily} = \sigma / \sqrt{252}$. Hence $\sigma\sqrt{n} = \sigma_{annualized} \sqrt{\Delta t}$, thus  $VAR(mean) = W_0 \alpha \sigma\sqrt{\Delta t}$.

III. **Conclusion:**
    - The derived formula, $VAR(mean) = W_0 \alpha \sigma \sqrt{\Delta t}$, confirms that the VAR for a given horizon $\Delta t$ scales with the square root of the time, given that returns are independent, and that $\sigma$ is annualized volatility.
    $\blacksquare$

**Corol√°rio 1:**  Caso os retornos n√£o sigam uma distribui√ß√£o normal, o VAR param√©trico calculado usando a distribui√ß√£o normal pode subestimar ou superestimar o risco real. Alternativas como a distribui√ß√£o t-Student podem ser consideradas em situa√ß√µes de caudas pesadas.

**Corol√°rio 1.1:** A escolha da distribui√ß√£o param√©trica deve ser validada por testes de ader√™ncia, como o teste de Kolmogorov-Smirnov ou o teste de Anderson-Darling. Caso a distribui√ß√£o normal seja rejeitada, distribui√ß√µes alternativas, como a distribui√ß√£o de Laplace ou uma mistura de distribui√ß√µes normais, podem ser mais apropriadas dependendo do contexto.

**Corol√°rio 1.2:** O VAR param√©trico, quando a distribui√ß√£o normal √© usada, pode ser ajustado para levar em considera√ß√£o a assimetria e a curtose dos retornos atrav√©s de expans√µes de Edgeworth ou Cornish-Fisher. Estas expans√µes fornecem uma corre√ß√£o ao quantil normal que leva em conta os momentos superiores da distribui√ß√£o.

**Proof of Corollary 1.2**

I. **Initial Setup and Definitions:**
   - Assume that the returns do not follow a normal distribution.
   - Let $\kappa_3$ and $\kappa_4$ be the skewness and kurtosis of the distribution of the returns.
   - We denote by $\Phi^{-1}(p)$ the inverse of the standard normal cumulative distribution, which returns the normal quantile $z_p$ for a given probability $p$.

II. **Cornish-Fisher Expansion:**
    - The Cornish-Fisher expansion is given by:
    $$z_p^{CF} = z_p + \frac{1}{6} (z_p^2 - 1) \kappa_3 + \frac{1}{24} (z_p^3 - 3z_p) \kappa_4 - \frac{1}{36} (2z_p^3 - 5z_p)\kappa_3^2 $$
    - Where:
       - $z_p$ is the normal quantile at probability $p$.
       - $\kappa_3$ is the skewness of the returns.
       - $\kappa_4$ is the excess kurtosis of the returns (kurtosis - 3)
    - This expansion provides a correction to the normal quantile $z_p$ that takes into account the skewness ($\kappa_3$) and kurtosis ($\kappa_4$) of the distribution of returns.

III. **Adjusted VAR:**
    - The adjusted return cut-off is given by $R_{adj}^* = \mu + z_p^{CF} \sigma$.
   - The adjusted VAR is given by:
   $$VAR(mean)_{adj} = -W_0(R_{adj}^* - \mu) = -W_0(z_p^{CF} \sigma)$$
  - Therefore the adjusted VAR takes into account the higher moments.

IV. **Conclusion:**
    - By replacing the standard normal quantile $z_p$ with the corrected quantile $z_p^{CF}$ obtained from the Cornish-Fisher expansion, we can adjust the parametric VAR calculation to account for the skewness and kurtosis of the return distribution. This leads to a more accurate estimation of VAR in cases where the normality assumption does not hold.
    $\blacksquare$

### Conclus√£o

O Value at Risk (VAR) √© uma ferramenta indispens√°vel na gest√£o de riscos financeiros, fornecendo um resumo conciso do risco de perdas potenciais [^1].  Este cap√≠tulo detalhou as nuances do c√°lculo do VAR, tanto pela abordagem n√£o param√©trica quanto pela param√©trica, com foco na distribui√ß√£o normal [^4, 6].  Enfatizou-se que o VAR √© uma estimativa que possui imprecis√µes [^2] e que, portanto, a sua apresenta√ß√£o deve ser acompanhada de an√°lises de sensibilidade, como as bandas de confian√ßa [^2].  O uso do VAR param√©trico simplifica os c√°lculos, mas exige aten√ß√£o √† escolha da distribui√ß√£o correta [^6]. A an√°lise da escolha de fatores quantitativos (n√≠vel de confian√ßa e horizonte de tempo) ser√° abordada em se√ß√µes futuras, estabelecendo as bases para uma compreens√£o mais profunda de como o VAR √© aplicado em diferentes contextos [^2].

### Refer√™ncias
[^1]:  *Value at risk (VAR) is a statistical measure of downside risk based on current positions...*
[^2]:  *This chapter turns to a formal definition of value at risk (VAR)...*
[^3]:  *Assume, for instance, that we need to measure the VAR of a \$ 100 mil- lion equity portfolio over 10 days at the 99 percent confidence level...*
[^4]:  *The most general method makes no assumption about the shape of the distribution of returns...*
[^5]: *Assume that this can be used to define a forward-looking distribution...*
[^6]:  *The VAR computation can be simplified considerably if the distribution can be assumed to belong to a parametric family...*
[^7]: *Thus the problem of finding VAR is equivalent to finding the devi- ate a such that the area to the left of it is equal to 1 c...*
