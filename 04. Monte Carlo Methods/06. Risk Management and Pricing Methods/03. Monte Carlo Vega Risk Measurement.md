## Avalia√ß√£o da Risco Vega com M√©todos de Monte Carlo

### Introdu√ß√£o

Em continuidade √† discuss√£o sobre a avalia√ß√£o de op√ß√µes complexas com m√©todos de Monte Carlo, este cap√≠tulo aborda o c√°lculo do **risco Vega**, ou seja, a sensibilidade do valor de um portf√≥lio a mudan√ßas na volatilidade [^316]. O risco Vega √© uma m√©trica fundamental para o gerenciamento de risco em carteiras de derivativos, pois quantifica o impacto de movimentos na volatilidade nos pre√ßos das op√ß√µes [^316]. Como veremos, os m√©todos de Monte Carlo fornecem uma estrutura flex√≠vel para avaliar o risco Vega, simplesmente repetindo a simula√ß√£o com diferentes valores de volatilidade [^316].

### Conceitos Fundamentais

O **risco Vega** ($V$) de um portf√≥lio de op√ß√µes √© definido como a varia√ß√£o no valor do portf√≥lio ($\Delta P$) resultante de uma varia√ß√£o na volatilidade do ativo subjacente ($\Delta \sigma$) [^316]:

$$ V = \frac{\Delta P}{\Delta \sigma} $$

Em outras palavras, o risco Vega mede quanto o valor do portf√≥lio de op√ß√µes muda para cada varia√ß√£o de 1% na volatilidade.

Para estimar o risco Vega usando simula√ß√µes de Monte Carlo, o procedimento √© o seguinte [^316]:

1.  **Simula√ß√£o Base:** Realize uma simula√ß√£o de Monte Carlo com a volatilidade original $\sigma$ para obter o valor do portf√≥lio $P(\sigma)$ [^316].
2.  **Simula√ß√£o Perturbada:** Repita a simula√ß√£o com uma volatilidade ligeiramente perturbada $\sigma + \Delta \sigma$, mantendo todos os outros par√¢metros constantes. Isso produz um novo valor para o portf√≥lio $P(\sigma + \Delta \sigma)$ [^316].
3.  **C√°lculo do Risco Vega:** Estime o risco Vega como a diferen√ßa entre os valores dos portf√≥lios dividida pela varia√ß√£o na volatilidade [^316]:

$$ V \approx \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma} $$

√â crucial usar as mesmas sequ√™ncias de n√∫meros aleat√≥rios ($\epsilon$ ou $dz$) nas simula√ß√µes base e perturbada para isolar o efeito da mudan√ßa na volatilidade [^316]. Isso reduz a vari√¢ncia da estimativa do risco Vega, j√° que a √∫nica fonte de varia√ß√£o entre as duas simula√ß√µes √© a mudan√ßa na volatilidade [^316].

> üí° **Exemplo Num√©rico:**
>
> Suponha que temos um portf√≥lio contendo 100 op√ß√µes de compra europeias sobre uma a√ß√£o. O pre√ßo atual da a√ß√£o √© \$ 100, o pre√ßo de exerc√≠cio das op√ß√µes √© \$ 105, a taxa livre de risco √© 5%, o tempo at√© o vencimento √© de 0.5 anos (6 meses), e a volatilidade √© de 20%. Realizamos 10,000 simula√ß√µes de Monte Carlo para calcular o valor do portf√≥lio.
>
> **Passo 1: Simula√ß√£o Base**
>
> Usando uma volatilidade $\sigma = 0.20$, a simula√ß√£o de Monte Carlo resulta em um valor do portf√≥lio $P(\sigma) = \$ 48,000$.
>
> **Passo 2: Simula√ß√£o Perturbada**
>
> Aumentamos a volatilidade em $\Delta \sigma = 0.01$ (1%), resultando em $\sigma + \Delta \sigma = 0.21$.  Usando *exatamente os mesmos* n√∫meros aleat√≥rios da simula√ß√£o base, a simula√ß√£o resulta em um valor do portf√≥lio $P(\sigma + \Delta \sigma) = \$ 49,500$.
>
> **Passo 3: C√°lculo do Risco Vega**
>
> O risco Vega √© estimado como:
>
> $V \approx \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma} = \frac{\$ 49,500 - \$ 48,000}{0.01} = \$ 150,000$
>
> Isso significa que, para cada aumento de 1% na volatilidade, o valor do portf√≥lio deve aumentar em aproximadamente \$ 150,000. A intui√ß√£o aqui √© que op√ß√µes se tornam mais valiosas quando a volatilidade do ativo subjacente aumenta.
>
> ```python
> import numpy as np
>
> # Par√¢metros
> S0 = 100.0  # Pre√ßo inicial da a√ß√£o
> K = 105.0  # Pre√ßo de exerc√≠cio
> r = 0.05  # Taxa livre de risco
> T = 0.5  # Tempo at√© o vencimento (anos)
> sigma = 0.20  # Volatilidade
> delta_sigma = 0.01 # Varia√ß√£o na volatilidade
> n_simulations = 10000  # N√∫mero de simula√ß√µes
> n_options = 100 #N√∫mero de op√ß√µes no portf√≥lio
>
> # Fun√ß√£o para calcular o pre√ßo de uma op√ß√£o de compra europeia usando Monte Carlo
> def european_call_price(S0, K, r, T, sigma, n_simulations, random_numbers):
>     ST = S0 * np.exp((r - 0.5 * sigma**2) * T + sigma * np.sqrt(T) * random_numbers)
>     payoffs = np.maximum(ST - K, 0)
>     price = np.exp(-r * T) * np.mean(payoffs)
>     return price
>
> # Gerar n√∫meros aleat√≥rios para ambas as simula√ß√µes
> np.random.seed(42) # Garante que os mesmos n√∫meros aleat√≥rios sejam usados
> random_numbers = np.random.normal(0, 1, n_simulations)
>
> # Calcular o pre√ßo da op√ß√£o com volatilidade base
> option_price_base = european_call_price(S0, K, r, T, sigma, n_simulations, random_numbers)
> portfolio_value_base = n_options * option_price_base
> print(f"Valor do portf√≥lio (volatilidade base): ${portfolio_value_base:.2f}")
>
> # Calcular o pre√ßo da op√ß√£o com volatilidade perturbada
> option_price_perturbed = european_call_price(S0, K, r, T, sigma + delta_sigma, n_simulations, random_numbers)
> portfolio_value_perturbed = n_options * option_price_perturbed
> print(f"Valor do portf√≥lio (volatilidade perturbada): ${portfolio_value_perturbed:.2f}")
>
> # Calcular Vega
> vega = (portfolio_value_perturbed - portfolio_value_base) / delta_sigma
> print(f"Vega: ${vega:.2f}")
> ```

**Teorema 1:** Redu√ß√£o de Vari√¢ncia no C√°lculo de Vega com N√∫meros Aleat√≥rios Comuns

*Se as simula√ß√µes com volatilidade base ($\sigma$) e volatilidade perturbada ($\sigma + \Delta \sigma$) utilizarem a mesma sequ√™ncia de n√∫meros aleat√≥rios, a vari√¢ncia da estimativa do Vega ser√° reduzida em compara√ß√£o com o uso de sequ√™ncias independentes.*

*Demonstra√ß√£o*: Seja $P(\sigma, \epsilon)$ o pre√ßo do portf√≥lio calculado usando a volatilidade $\sigma$ e a sequ√™ncia de n√∫meros aleat√≥rios $\epsilon$. O Vega estimado com n√∫meros aleat√≥rios comuns √©:

$$
\hat{V}_{CRN} = \frac{P(\sigma + \Delta \sigma, \epsilon) - P(\sigma, \epsilon)}{\Delta \sigma}
$$

A vari√¢ncia dessa estimativa √©:

$$
Var(\hat{V}_{CRN}) = \frac{1}{\Delta \sigma^2} Var(P(\sigma + \Delta \sigma, \epsilon) - P(\sigma, \epsilon))
$$

Se as sequ√™ncias de n√∫meros aleat√≥rios fossem independentes, a vari√¢ncia seria:

$$
Var(\hat{V}_{Ind}) = \frac{1}{\Delta \sigma^2} [Var(P(\sigma + \Delta \sigma)) + Var(P(\sigma))]
$$

A redu√ß√£o da vari√¢ncia obtida com n√∫meros aleat√≥rios comuns √© proporcional √† covari√¢ncia entre $P(\sigma + \Delta \sigma, \epsilon)$ e $P(\sigma, \epsilon)$. Como os pre√ßos dos portf√≥lios s√£o positivamente correlacionados quando simulados com n√∫meros aleat√≥rios comuns, a covari√¢ncia √© positiva, resultando em uma redu√ß√£o da vari√¢ncia [^316].

![Vega Risk Reduction](./../images/figure1.png)

**Prova do Teorema 1:**

I. Sejam $P(\sigma)$ e $P(\sigma + \Delta \sigma)$ os pre√ßos do portf√≥lio calculados com volatilidade $\sigma$ e $\sigma + \Delta \sigma$, respectivamente, usando a mesma sequ√™ncia de n√∫meros aleat√≥rios.

II. O estimador de Vega com n√∫meros aleat√≥rios comuns (CRN) √©:
    $$\hat{V}_{CRN} = \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma}$$

III. A vari√¢ncia de $\hat{V}_{CRN}$ √©:
     $$Var(\hat{V}_{CRN}) = Var\left( \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma} \right) = \frac{1}{(\Delta \sigma)^2} Var(P(\sigma + \Delta \sigma) - P(\sigma))$$

IV. Expandindo a vari√¢ncia:
    $$Var(\hat{V}_{CRN}) = \frac{1}{(\Delta \sigma)^2} \left[ Var(P(\sigma + \Delta \sigma)) + Var(P(\sigma)) - 2Cov(P(\sigma + \Delta \sigma), P(\sigma)) \right]$$

V. Se as simula√ß√µes fossem independentes, a covari√¢ncia seria zero e a vari√¢ncia seria:
    $$Var(\hat{V}_{Ind}) = \frac{1}{(\Delta \sigma)^2} \left[ Var(P(\sigma + \Delta \sigma)) + Var(P(\sigma)) \right]$$

VI. Comparando as vari√¢ncias, a redu√ß√£o de vari√¢ncia ao usar n√∫meros aleat√≥rios comuns √©:
   $$Var(\hat{V}_{Ind}) - Var(\hat{V}_{CRN}) = \frac{2}{(\Delta \sigma)^2} Cov(P(\sigma + \Delta \sigma), P(\sigma))$$

VII. Como os pre√ßos dos portf√≥lios com volatilidades $\sigma$ e $\sigma + \Delta \sigma$ s√£o positivamente correlacionados quando simulados com os mesmos n√∫meros aleat√≥rios (j√° que o aumento da volatilidade geralmente leva a um aumento nos pre√ßos das op√ß√µes), $Cov(P(\sigma + \Delta \sigma), P(\sigma)) > 0$.

VIII. Portanto, $Var(\hat{V}_{Ind}) > Var(\hat{V}_{CRN})$, o que significa que a vari√¢ncia do estimador de Vega √© menor quando usamos n√∫meros aleat√≥rios comuns. ‚ñ†

> üí° **Exemplo Num√©rico:**
>
> Considere a simula√ß√£o de um portf√≥lio de op√ß√µes com as seguintes caracter√≠sticas:
>
> *   Pre√ßo atual do ativo subjacente ($S_0$): \$ 100
> *   Pre√ßo de exerc√≠cio ($K$): \$ 110
> *   Taxa livre de risco ($r$): 5%
> *   Tempo at√© o vencimento ($T$): 1 ano
> *   Volatilidade inicial ($\sigma$): 20%
> *   N√∫mero de simula√ß√µes ($n$): 1000
>
> Realizamos duas simula√ß√µes: uma com a volatilidade original (20%) e outra com uma volatilidade ligeiramente aumentada (21%).
>
> **Simula√ß√£o 1: Volatilidade Original (20%)**
>
> Ap√≥s 1000 simula√ß√µes usando n√∫meros aleat√≥rios $\epsilon$, o valor estimado do portf√≥lio √© $P(\sigma, \epsilon) = \$ 8,500$.  A vari√¢ncia desta simula√ß√£o √© estimada em $Var(P(\sigma)) = \$ 500$.
>
> **Simula√ß√£o 2: Volatilidade Aumentada (21%)**
>
> Usando *exatamente os mesmos* n√∫meros aleat√≥rios $\epsilon$, o valor estimado do portf√≥lio √© $P(\sigma + \Delta \sigma, \epsilon) = \$ 9,200$. A vari√¢ncia desta simula√ß√£o √© estimada em $Var(P(\sigma + \Delta \sigma)) = \$ 550$.
>
> A covari√¢ncia entre $P(\sigma)$ e $P(\sigma + \Delta \sigma)$ usando os mesmos n√∫meros aleat√≥rios √© estimada em $Cov(P(\sigma + \Delta \sigma), P(\sigma)) = \$ 400$.
>
> **C√°lculo do Vega e sua Vari√¢ncia**
>
> $\Delta \sigma = 0.01$
>
> Usando n√∫meros aleat√≥rios comuns (CRN):
>
> $\hat{V}_{CRN} = \frac{P(\sigma + \Delta \sigma, \epsilon) - P(\sigma, \epsilon)}{\Delta \sigma} = \frac{\$ 9,200 - \$ 8,500}{0.01} = \$ 70,000$
>
> $Var(\hat{V}_{CRN}) = \frac{1}{(\Delta \sigma)^2} [Var(P(\sigma + \Delta \sigma)) + Var(P(\sigma)) - 2Cov(P(\sigma + \Delta \sigma), P(\sigma))] = \frac{1}{(0.01)^2} [\$ 550 + \$ 500 - 2 \times \$ 400] = \frac{\$ 250}{0.0001} = 2,500,000$
>
> Usando n√∫meros aleat√≥rios independentes:
>
> $\hat{V}_{Ind} = \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma} = \$ 70,000$ (o mesmo valor esperado)
>
> $Var(\hat{V}_{Ind}) = \frac{1}{(\Delta \sigma)^2} [Var(P(\sigma + \Delta \sigma)) + Var(P(\sigma))] = \frac{1}{(0.01)^2} [\$ 550 + \$ 500] = \frac{\$ 1050}{0.0001} = 10,500,000$
>
> A redu√ß√£o na vari√¢ncia ao usar n√∫meros aleat√≥rios comuns √©:
>
> $Var(\hat{V}_{Ind}) - Var(\hat{V}_{CRN}) = 10,500,000 - 2,500,000 = 8,000,000$
>
> Este exemplo num√©rico demonstra claramente como o uso de n√∫meros aleat√≥rios comuns (CRN) reduz drasticamente a vari√¢ncia na estimativa do risco Vega, tornando a estimativa mais precisa e confi√°vel. A intui√ß√£o √© que, ao usar os mesmos n√∫meros aleat√≥rios, estamos isolando o efeito da mudan√ßa na volatilidade, reduzindo o ru√≠do nas simula√ß√µes.

**Teorema 1.1:** Converg√™ncia da Estimativa de Vega

*A estimativa de Vega, calculada por meio de simula√ß√µes de Monte Carlo com n√∫meros aleat√≥rios comuns, converge para o valor verdadeiro do Vega √† medida que o n√∫mero de simula√ß√µes tende ao infinito e $\Delta \sigma$ tende a zero.*

*Demonstra√ß√£o*: Seja $V$ o valor verdadeiro do Vega, definido como a derivada parcial do pre√ßo do portf√≥lio em rela√ß√£o √† volatilidade:

$$
V = \frac{\partial P}{\partial \sigma}
$$

A estimativa de Monte Carlo com n√∫meros aleat√≥rios comuns √©:

$$
\hat{V}_{CRN} = \frac{P(\sigma + \Delta \sigma, \epsilon) - P(\sigma, \epsilon)}{\Delta \sigma}
$$

√Ä medida que o n√∫mero de simula√ß√µes tende ao infinito, o valor estimado do portf√≥lio converge para o valor esperado:

$$
\lim_{n \to \infty} P(\sigma, \epsilon) = \mathbb{E}[P(\sigma, \epsilon)]
$$

E, √† medida que $\Delta \sigma$ tende a zero, a estimativa de Vega se aproxima da derivada parcial:

$$
\lim_{\Delta \sigma \to 0} \frac{P(\sigma + \Delta \sigma, \epsilon) - P(\sigma, \epsilon)}{\Delta \sigma} = \frac{\partial P}{\partial \sigma} = V
$$

Portanto, a estimativa de Vega converge para o valor verdadeiro sob as condi√ß√µes especificadas.

**Prova do Teorema 1.1:**

I. Seja $P(\sigma)$ o pre√ßo do portf√≥lio, que √© uma fun√ß√£o da volatilidade $\sigma$.

II. O Vega verdadeiro √© definido como a derivada parcial de $P$ em rela√ß√£o a $\sigma$:
    $$V = \frac{\partial P}{\partial \sigma}$$

III. A estimativa de Vega usando Monte Carlo com n√∫meros aleat√≥rios comuns √©:
     $$\hat{V}_{CRN} = \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma}$$

IV. Tomando o limite quando $\Delta \sigma$ tende a zero:
    $$\lim_{\Delta \sigma \to 0} \hat{V}_{CRN} = \lim_{\Delta \sigma \to 0} \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma}$$

V. Pela defini√ß√£o de derivada, este limite √© igual √† derivada parcial de $P$ em rela√ß√£o a $\sigma$:
   $$\lim_{\Delta \sigma \to 0} \frac{P(\sigma + \Delta \sigma) - P(\sigma)}{\Delta \sigma} = \frac{\partial P}{\partial \sigma} = V$$

VI. Portanto, a estimativa de Monte Carlo de Vega converge para o Vega verdadeiro quando $\Delta \sigma$ tende a zero. Al√©m disso, com um n√∫mero infinito de simula√ß√µes de Monte Carlo, o erro de amostragem converge para zero, garantindo que a estimativa convirja para o valor esperado. ‚ñ†

**Lema 1:** Linearidade da Estimativa de Vega

*Se o portf√≥lio √© composto por m√∫ltiplas op√ß√µes, o Vega do portf√≥lio √© a soma dos Vegas de cada op√ß√£o individual.*

*Demonstra√ß√£o*: Seja $P = \sum_{i=1}^{n} P_i$ o valor do portf√≥lio composto por $n$ op√ß√µes, onde $P_i$ √© o pre√ßo da $i$-√©sima op√ß√£o. O Vega do portf√≥lio √©:

$$
V = \frac{\partial P}{\partial \sigma} = \frac{\partial}{\partial \sigma} \sum_{i=1}^{n} P_i = \sum_{i=1}^{n} \frac{\partial P_i}{\partial \sigma} = \sum_{i=1}^{n} V_i
$$

Onde $V_i$ √© o Vega da $i$-√©sima op√ß√£o. Portanto, o Vega do portf√≥lio √© a soma dos Vegas das op√ß√µes individuais. Isto simplifica o c√°lculo do Vega para grandes portf√≥lios, pois permite calcular o Vega de cada op√ß√£o individualmente e som√°-los.

**Prova do Lema 1:**

I. Seja o portf√≥lio $P$ composto por $n$ op√ß√µes, de forma que o valor do portf√≥lio seja a soma dos valores das op√ß√µes individuais:
   $$P = \sum_{i=1}^{n} P_i$$
   onde $P_i$ √© o valor da $i$-√©sima op√ß√£o.

II. O Vega do portf√≥lio √© a derivada do valor do portf√≥lio em rela√ß√£o √† volatilidade $\sigma$:
    $$V = \frac{\partial P}{\partial \sigma}$$

III. Substituindo $P$ pela soma dos valores das op√ß√µes:
     $$V = \frac{\partial}{\partial \sigma} \left( \sum_{i=1}^{n} P_i \right)$$

IV. Pela propriedade da derivada da soma, podemos escrever:
    $$V = \sum_{i=1}^{n} \frac{\partial P_i}{\partial \sigma}$$

V. Reconhecendo que $\frac{\partial P_i}{\partial \sigma}$ √© o Vega da $i$-√©sima op√ß√£o, denotado por $V_i$:
   $$V = \sum_{i=1}^{n} V_i$$

VI. Portanto, o Vega do portf√≥lio √© a soma dos Vegas das op√ß√µes individuais. ‚ñ†

> üí° **Exemplo Num√©rico:**
>
> Considere um portf√≥lio composto por tr√™s op√ß√µes europeias de compra sobre a mesma a√ß√£o, com as seguintes caracter√≠sticas:
>
> *   Op√ß√£o 1: 50 contratos, Vega = \$ 2.00 por contrato.
> *   Op√ß√£o 2: 100 contratos, Vega = \$ 1.50 por contrato.
> *   Op√ß√£o 3: 25 contratos, Vega = \$ 3.00 por contrato.
>
> Para calcular o Vega do portf√≥lio, multiplicamos o n√∫mero de contratos pelo Vega por contrato para cada op√ß√£o e somamos os resultados:
>
> *   Vega da Op√ß√£o 1: 50 contratos * \$ 2.00/contrato = \$ 100
> *   Vega da Op√ß√£o 2: 100 contratos * \$ 1.50/contrato = \$ 150
> *   Vega da Op√ß√£o 3: 25 contratos * \$ 3.00/contrato = \$ 75
>
> Vega do Portf√≥lio = Vega da Op√ß√£o 1 + Vega da Op√ß√£o 2 + Vega da Op√ß√£o 3 = \$ 100 + \$ 150 + \$ 75 = \$ 325
>
> Portanto, o Vega total do portf√≥lio √© \$ 325. Isso significa que, para cada aumento de 1% na volatilidade, espera-se que o valor do portf√≥lio aumente em \$ 325.
>
> Este exemplo demonstra a simplicidade da aplica√ß√£o do Lema 1: o c√°lculo do Vega de um portf√≥lio complexo √© reduzido a uma simples soma dos Vegas de cada componente individual.
>
> Em Python:
>
> ```python
> # Dados das op√ß√µes
> option1_contracts = 50
> option1_vega_per_contract = 2.00
>
> option2_contracts = 100
> option2_vega_per_contract = 1.50
>
> option3_contracts = 25
> option3_vega_per_contract = 3.00
>
> # C√°lculo do Vega de cada op√ß√£o
> option1_vega = option1_contracts * option1_vega_per_contract
> option2_vega = option2_contracts * option2_vega_per_contract
> option3_vega = option3_contracts * option3_vega_per_contract
>
> # C√°lculo do Vega total do portf√≥lio
> portfolio_vega = option1_vega + option2_vega + option3_vega
>
> print(f"Vega do portf√≥lio: ${portfolio_vega}")
> ```

### Conclus√£o

Os m√©todos de Monte Carlo fornecem uma ferramenta valiosa para estimar o risco Vega de um portf√≥lio de op√ß√µes [^316]. Ao repetir a simula√ß√£o com uma volatilidade ligeiramente perturbada e utilizando a mesma sequ√™ncia de n√∫meros aleat√≥rios, √© poss√≠vel isolar o efeito da mudan√ßa na volatilidade e obter uma estimativa precisa do risco Vega [^316]. A utiliza√ß√£o de n√∫meros aleat√≥rios comuns √© crucial para reduzir a vari√¢ncia da estimativa e melhorar a precis√£o dos resultados. Esses resultados podem ser usados para uma melhor administra√ß√£o do risco, para balancear um portfolio ou para opera√ß√µes de hedge.

### Refer√™ncias

[^316]: C√°lculo do risco Vega utilizando simula√ß√µes de Monte Carlo.
<!-- END -->