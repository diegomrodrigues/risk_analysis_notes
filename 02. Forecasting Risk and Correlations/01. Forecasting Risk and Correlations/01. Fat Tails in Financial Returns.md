## Forecasting Risk and Correlations: Understanding Fat Tails and Time-Varying Distributions

### Introdu√ß√£o
Este cap√≠tulo explora t√©cnicas para prever a varia√ß√£o no risco e nas correla√ß√µes nos mercados financeiros [^1]. Uma motiva√ß√£o chave √© a observa√ß√£o de que os mercados financeiros exibem volatilidade que varia ao longo do tempo [^1]. Modelar essa varia√ß√£o temporal √© crucial para uma gest√£o de risco eficaz, pois o aumento da volatilidade impacta diretamente medidas como o Value at Risk (VaR) [^1]. Esta se√ß√£o em particular foca em como a presen√ßa de *fat tails* nas distribui√ß√µes emp√≠ricas dos retornos financeiros pode ser explicada tanto por distribui√ß√µes estacion√°rias com *fat tails* inerentes, quanto por distribui√ß√µes que mudam ao longo do tempo, com per√≠odos de turbul√™ncia [^3]. Utilizaremos o exemplo da taxa de c√¢mbio d√≥lar americano/libra esterlina (\$/BP) para ilustrar estes conceitos [^2].

### Conceitos Fundamentais

A an√°lise de dados financeiros frequentemente revela que a distribui√ß√£o emp√≠rica dos retornos n√£o se ajusta perfeitamente a uma distribui√ß√£o normal [^3]. Especificamente, a distribui√ß√£o real tende a ter mais observa√ß√µes no centro e nas caudas, um fen√¥meno conhecido como *fat tails* [^3].

**Duas Perspectivas sobre Fat Tails:**

1.  **Distribui√ß√£o Estacion√°ria com Fat Tails:** Esta vis√£o postula que a distribui√ß√£o verdadeira √© estacion√°ria e, de fato, cont√©m *fat tails*. Neste caso, aproximar a distribui√ß√£o por uma normal seria inapropriado [^3]. A presen√ßa de *fat tails* √© uma caracter√≠stica intr√≠nseca dos dados, refletindo a ocorr√™ncia relativamente frequente de eventos extremos. Distribui√ß√µes como a t-Student e a distribui√ß√£o hiperb√≥lica s√£o frequentemente usadas para modelar dados com *fat tails*.

> üí° **Exemplo Num√©rico:** Suponha que os retornos di√°rios de um ativo sigam uma distribui√ß√£o t-Student com $\nu = 4$ graus de liberdade e escala $\sigma = 0.01$. A distribui√ß√£o t-Student tem *fat tails* comparada √† normal. Se modelarmos os retornos usando uma normal com a mesma vari√¢ncia, subestimar√≠amos a probabilidade de eventos extremos. Por exemplo, a probabilidade de um retorno ser maior que 3 desvios padr√£o seria significativamente maior na t-Student do que na normal.
>
> ```python
> import numpy as np
> from scipy.stats import t, norm
>
> # Par√¢metros
> nu = 4  # graus de liberdade
> sigma = 0.01  # escala
>
> # Probabilidade de um evento extremo (retorno > 3 sigma)
> prob_t = 2 * (1 - t.cdf(3, df=nu)) # Multiplica por 2 para ambas as caudas
> prob_normal = 2 * (1 - norm.cdf(3))
>
> print(f"Probabilidade (t-Student): {prob_t:.6f}")
> print(f"Probabilidade (Normal): {prob_normal:.6f}")
> ```
>
> Este c√≥digo calcula a probabilidade de observar um valor extremo (maior que 3 desvios padr√£o) tanto para uma distribui√ß√£o t-Student quanto para uma distribui√ß√£o normal. A distribui√ß√£o t-Student, com seus graus de liberdade mais baixos, demonstra uma probabilidade maior de ocorr√™ncia de eventos extremos em compara√ß√£o com a distribui√ß√£o normal. Isso ilustra a import√¢ncia de considerar distribui√ß√µes com *fat tails* ao modelar dados financeiros para capturar adequadamente o risco de eventos raros.

2.  **Distribui√ß√£o Time-Varying:** Alternativamente, a distribui√ß√£o pode mudar ao longo do tempo [^3]. Em per√≠odos de turbul√™ncia, um modelo estacion√°rio pode interpretar grandes observa√ß√µes como *outliers*, quando, na realidade, elas s√£o provenientes de uma distribui√ß√£o com maior dispers√£o tempor√°ria [^3]. Esta perspectiva enfatiza que a volatilidade n√£o √© constante, mas sim aglomerada em certos per√≠odos [^1]. Modelos GARCH (Generalized Autoregressive Conditional Heteroskedasticity) s√£o projetados para capturar essa varia√ß√£o temporal da volatilidade.

> üí° **Exemplo Num√©rico:** Considere um ativo com retornos que exibem *volatility clustering*. Em per√≠odos de baixa volatilidade, a volatilidade di√°ria √© de 0.5%, enquanto em per√≠odos de alta volatilidade, a volatilidade di√°ria √© de 2%. Se usarmos um modelo com volatilidade constante, como um modelo normal com volatilidade m√©dia de 1.25%, subestimaremos o risco durante os per√≠odos de alta volatilidade e superestimaremos o risco durante os per√≠odos de baixa volatilidade. Um modelo GARCH(1,1) ajustaria dinamicamente a volatilidade com base nos retornos passados, fornecendo uma estimativa de risco mais precisa.
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
>
> # Simula√ß√£o de retornos com mudan√ßa de volatilidade
> np.random.seed(42)
> num_days = 500
> volatility = np.zeros(num_days)
> returns = np.zeros(num_days)
>
> # Per√≠odos de baixa e alta volatilidade
> low_volatility = 0.005  # 0.5%
> high_volatility = 0.02  # 2%
>
> # Definir volatilidade ao longo do tempo
> volatility[:250] = low_volatility
> volatility[250:] = high_volatility
>
> # Gerar retornos com base na volatilidade
> for t in range(num_days):
>     returns[t] = np.random.normal(0, volatility[t])
>
> # Calcular volatilidade m√©dia
> average_volatility = np.mean(volatility)
>
> # Plotagem dos retornos e da volatilidade
> fig, ax1 = plt.subplots(figsize=(10, 6))
>
> color = 'tab:blue'
> ax1.set_xlabel('Tempo (Dias)')
> ax1.set_ylabel('Retornos', color=color)
> ax1.plot(returns, color=color, linewidth=0.5)
> ax1.tick_params(axis='y', labelcolor=color)
>
> ax2 = ax1.twinx()  # Segundo eixo y
>
> color = 'tab:red'
> ax2.set_ylabel('Volatilidade', color=color)  # R√≥tulo do segundo eixo y
> ax2.plot(volatility, color=color, linestyle='--', linewidth=1.5)
> ax2.tick_params(axis='y', labelcolor=color)
>
> fig.tight_layout()  # Ajusta o layout para n√£o sobrepor r√≥tulos
> plt.title('Retornos Simulados com Volatilidade Vari√°vel')
> plt.show()
>
> print(f"Volatilidade m√©dia: {average_volatility:.4f}")
> ```
>
> Esta simula√ß√£o visualiza como a volatilidade vari√°vel afeta os retornos. Usar uma volatilidade m√©dia constante n√£o representaria adequadamente os per√≠odos de maior risco.

**Lema 1:** *A combina√ß√£o de distribui√ß√µes normais com vari√¢ncias diferentes ao longo do tempo pode resultar em uma distribui√ß√£o marginal com fat tails.*

*Prova (Esbo√ßo):* Considere uma sequ√™ncia de retornos $r_t$ onde $r_t \sim N(0, \sigma_t^2)$, e $\sigma_t^2$ varia ao longo do tempo. A distribui√ß√£o marginal de $r_t$ √© uma mistura de normais. Se a distribui√ß√£o de $\sigma_t^2$ tiver uma cauda pesada (isto √©, per√≠odos de alta volatilidade ocorrem com frequ√™ncia n√£o desprez√≠vel), ent√£o a distribui√ß√£o marginal de $r_t$ ter√° *fat tails* em compara√ß√£o com uma distribui√ß√£o normal com vari√¢ncia constante.

*Prova:*

I. Seja $r_t$ uma sequ√™ncia de retornos, onde $r_t$ segue uma distribui√ß√£o normal com m√©dia zero e vari√¢ncia $\sigma_t^2$, ou seja, $r_t \sim N(0, \sigma_t^2)$.
II. Assumimos que a vari√¢ncia $\sigma_t^2$ varia ao longo do tempo, e a distribui√ß√£o de $\sigma_t^2$ possui uma cauda pesada. Isto significa que valores altos de $\sigma_t^2$ (per√≠odos de alta volatilidade) ocorrem com uma frequ√™ncia n√£o desprez√≠vel.
III. A distribui√ß√£o marginal de $r_t$, denotada por $f(r)$, pode ser expressa como a integral da distribui√ß√£o condicional $f(r | \sigma^2)$ ponderada pela distribui√ß√£o de $\sigma^2$, denotada por $g(\sigma^2)$:
$$f(r) = \int_0^\infty f(r | \sigma^2) g(\sigma^2) d\sigma^2$$
IV.  Dado que $f(r | \sigma^2)$ √© uma distribui√ß√£o normal com vari√¢ncia $\sigma^2$, temos:
$$f(r | \sigma^2) = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{r^2}{2\sigma^2}}$$
V.  Como a distribui√ß√£o de $\sigma^2$, $g(\sigma^2)$, possui uma cauda pesada, a integral em (III) ir√° acumular probabilidade adicional nas caudas da distribui√ß√£o marginal $f(r)$, em compara√ß√£o com uma distribui√ß√£o normal com vari√¢ncia constante. Isto ocorre porque, para valores grandes de $r$, a contribui√ß√£o de $f(r | \sigma^2)$ ser√° maior quando $\sigma^2$ for grande.
VI. Portanto, a distribui√ß√£o marginal de $r_t$ ter√° *fat tails* em compara√ß√£o com uma distribui√ß√£o normal com vari√¢ncia constante. ‚ñ†

**An√°lise da Taxa de C√¢mbio \$/BP:**

Para ilustrar esses conceitos, o texto analisa a taxa de c√¢mbio \$/BP no per√≠odo de 1990 a 1994 [^2]. Este per√≠odo incluiu faixas estreitas de negocia√ß√£o, bem como grandes flutua√ß√µes [^2]. Um evento not√°vel foi a sa√≠da da libra esterlina do Sistema Monet√°rio Europeu (SME) em setembro de 1992, ap√≥s tentativas fracassadas do Banco da Inglaterra de sustentar a libra contra o marco alem√£o [^2]. Este evento foi marcado por grandes movimentos na taxa de c√¢mbio, como a queda de 6% da libra em 17 de setembro [^2].
![This graph displays the movements of the dollar/BP exchange rate from 1990 to 1994](./../images/dollar_bp_exchange_rate_movements.jpg)

A volatilidade di√°ria m√©dia neste per√≠odo foi de 0,694%, o que equivale a 11,02% ao ano [^3]. No entanto, essa medida de risco n√£o foi constante ao longo do tempo [^3]. A an√°lise sugere que a varia√ß√£o temporal no risco pode explicar por que a distribui√ß√£o emp√≠rica dos retornos n√£o se encaixa perfeitamente em uma distribui√ß√£o normal [^3].
![The graph compares the normal and empirical distributions of the U.S. dollar/British pound ($/BP) exchange rate](./../images/normal_empirical_distributions.jpg)

**Teorema 1:** *Se os retornos financeiros seguem um processo GARCH(1,1), ent√£o a distribui√ß√£o incondicional dos retornos tem caudas mais pesadas do que uma distribui√ß√£o normal.*

*Prova (Esbo√ßo):* Em um modelo GARCH(1,1), a vari√¢ncia condicional no tempo $t$ √© dada por $\sigma_t^2 = \alpha_0 + \alpha_1 r_{t-1}^2 + \beta_1 \sigma_{t-1}^2$. A distribui√ß√£o incondicional dos retornos √© uma mistura de distribui√ß√µes normais com vari√¢ncias que dependem dos valores passados dos retornos e volatilidades. A persist√™ncia da volatilidade (alta $\beta_1$) leva a per√≠odos prolongados de alta ou baixa volatilidade, resultando em caudas mais pesadas na distribui√ß√£o incondicional. A demonstra√ß√£o formal envolve o c√°lculo dos momentos da distribui√ß√£o incondicional e a compara√ß√£o com os momentos da distribui√ß√£o normal.

*Prova:*

I.  Considere um modelo GARCH(1,1) onde a vari√¢ncia condicional $\sigma_t^2$ no tempo $t$ √© dada por:
$$\sigma_t^2 = \alpha_0 + \alpha_1 r_{t-1}^2 + \beta_1 \sigma_{t-1}^2$$
   onde $\alpha_0 > 0$, $\alpha_1 \geq 0$, $\beta_1 \geq 0$, e $\alpha_1 + \beta_1 < 1$ (para garantir estacionariedade).

II. Assumimos que os retornos condicionados √† vari√¢ncia passada seguem uma distribui√ß√£o normal:
$$r_t | \sigma_{t-1}^2 \sim N(0, \sigma_t^2)$$

III. A distribui√ß√£o incondicional de $r_t$ √© a distribui√ß√£o marginal obtida integrando a distribui√ß√£o condicional sobre todos os valores poss√≠veis de $\sigma_{t-1}^2$:
$$f(r_t) = \int_0^\infty f(r_t | \sigma_{t-1}^2) g(\sigma_{t-1}^2) d\sigma_{t-1}^2$$
   onde $g(\sigma_{t-1}^2)$ √© a distribui√ß√£o da vari√¢ncia condicional no tempo $t-1$.

IV. Para demonstrar que a distribui√ß√£o incondicional tem caudas mais pesadas do que uma normal, podemos analisar os momentos superiores da distribui√ß√£o. Em particular, vamos analisar o curtose, que mede o "peso" das caudas da distribui√ß√£o.

V.  A curtose da distribui√ß√£o normal √© 3. Se a curtose da distribui√ß√£o incondicional de $r_t$ for maior que 3, ent√£o a distribui√ß√£o tem caudas mais pesadas do que a normal.
VI.  Calcular analiticamente a curtose da distribui√ß√£o incondicional de um modelo GARCH(1,1) √© complexo. No entanto, podemos argumentar que a persist√™ncia da volatilidade, dada por um alto valor de $\beta_1$, leva a per√≠odos prolongados de alta ou baixa volatilidade. Isso implica que a distribui√ß√£o incondicional √© uma mistura de distribui√ß√µes normais com diferentes vari√¢ncias.

VII. Conforme demonstrado no Lema 1, a mistura de distribui√ß√µes normais com diferentes vari√¢ncias pode resultar em uma distribui√ß√£o com caudas mais pesadas do que uma distribui√ß√£o normal com vari√¢ncia constante.

VIII. Portanto, se os retornos financeiros seguem um processo GARCH(1,1), a distribui√ß√£o incondicional dos retornos tem caudas mais pesadas do que uma distribui√ß√£o normal. ‚ñ†

> üí° **Exemplo Num√©rico:** Considere um modelo GARCH(1,1) com par√¢metros $\alpha_0 = 0.000001$, $\alpha_1 = 0.1$, e $\beta_1 = 0.85$. Esses par√¢metros implicam uma alta persist√™ncia na volatilidade (devido ao alto valor de $\beta_1$). Se simul√°ssemos retornos usando esse modelo, observar√≠amos que a distribui√ß√£o emp√≠rica dos retornos teria *fat tails* em compara√ß√£o com uma distribui√ß√£o normal com a mesma vari√¢ncia. Um modelo GARCH(1,1) captura a depend√™ncia temporal da volatilidade, o que resulta em uma melhor modelagem dos retornos financeiros.
>
> ```python
> import numpy as np
> import matplotlib.pyplot as plt
>
> # Par√¢metros GARCH(1,1)
> alpha0 = 0.000001
> alpha1 = 0.1
> beta1 = 0.85
>
> # N√∫mero de simula√ß√µes
> num_simulations = 1000
> num_periods = 500
>
> # Inicializa√ß√£o
> volatility = np.zeros(num_periods)
> returns = np.zeros(num_periods)
> volatility[0] = np.sqrt(alpha0 / (1 - alpha1 - beta1))  # Inicializa√ß√£o da volatilidade
>
> # Simula√ß√£o GARCH(1,1)
> for i in range(1, num_periods):
>     returns[i] = np.random.normal(0, volatility[i-1])
>     volatility[i] = np.sqrt(alpha0 + alpha1 * returns[i-1]**2 + beta1 * volatility[i-1]**2)
>
> # Plotagem dos retornos simulados
> plt.figure(figsize=(10, 6))
> plt.plot(returns)
> plt.title('Retornos Simulados com Modelo GARCH(1,1)')
> plt.xlabel('Tempo')
> plt.ylabel('Retornos')
> plt.show()
>
> # An√°lise da distribui√ß√£o dos retornos
> plt.figure(figsize=(10, 6))
> plt.hist(returns, bins=50, density=True, alpha=0.6, label='Retornos Simulados')
>
> # Sobrepor a distribui√ß√£o normal para compara√ß√£o
> from scipy.stats import norm
> mu, std = norm.fit(returns)
> x = np.linspace(min(returns), max(returns), 100)
> p = norm.pdf(x, mu, std)
> plt.plot(x, p, 'k', linewidth=2, label='Distribui√ß√£o Normal')
>
> plt.title('Distribui√ß√£o dos Retornos Simulados vs. Normal')
> plt.xlabel('Retornos')
> plt.ylabel('Densidade')
> plt.legend()
> plt.show()
> ```
> Este c√≥digo simula retornos usando um modelo GARCH(1,1) e compara a distribui√ß√£o resultante com uma distribui√ß√£o normal. A distribui√ß√£o dos retornos simulados exibir√° *fat tails* em rela√ß√£o √† distribui√ß√£o normal, o que demonstra o efeito da modelagem da volatilidade vari√°vel na captura das caracter√≠sticas da distribui√ß√£o dos retornos financeiros.

**Implica√ß√µes para a Modelagem:**

A compreens√£o das causas das *fat tails* tem implica√ß√µes significativas para a modelagem do risco [^1]. Se a distribui√ß√£o √© inerentemente n√£o-normal, modelos que assumem normalidade podem levar a subestima√ß√µes do risco [^3]. Se a distribui√ß√£o √© time-varying, modelos que n√£o capturam essa varia√ß√£o podem ser inadequados em per√≠odos de turbul√™ncia [^3]. Portanto, a previs√£o da varia√ß√£o do risco √© particularmente relevante para a gest√£o de risco [^3]. Modelos como GARCH e suas extens√µes, bem como modelos de volatilidade estoc√°stica, s√£o cruciais para capturar a din√¢mica temporal da volatilidade e, assim, modelar melhor as *fat tails*. Al√©m disso, a escolha entre uma distribui√ß√£o estacion√°ria com *fat tails* (como a t-Student) e um modelo time-varying (como GARCH) pode depender do horizonte de tempo da an√°lise. Para per√≠odos curtos, um modelo time-varying pode ser mais apropriado, enquanto para per√≠odos mais longos, uma distribui√ß√£o estacion√°ria com *fat tails* pode fornecer uma melhor representa√ß√£o da distribui√ß√£o marginal dos retornos.

### Conclus√£o
Em resumo, a presen√ßa de *fat tails* nos retornos financeiros pode ser explicada por distribui√ß√µes estacion√°rias com *fat tails* ou distribui√ß√µes time-varying com per√≠odos de turbul√™ncia [^3]. A taxa de c√¢mbio \$/BP exemplifica essa varia√ß√£o temporal no risco, com eventos como a sa√≠da do SME causando grandes flutua√ß√µes [^2]. A modelagem precisa do risco requer a considera√ß√£o dessas caracter√≠sticas para evitar subestima√ß√µes e garantir uma gest√£o de risco eficaz [^1]. A escolha do modelo e da distribui√ß√£o deve ser guiada por uma an√°lise cuidadosa dos dados e uma compreens√£o das propriedades estat√≠sticas dos retornos financeiros.

### Refer√™ncias
[^1]: P√°gina 219: *‚ÄúThe purpose of this chapter is to present techniques to forecast vari-ation in risk and correlations. Section 9.1 motivates the problem by taking the example of a series that underwent structural changes leading to pre-dictable patterns in volatility.‚Äù*
[^2]: P√°gina 220: *‚ÄúAs an illustration, we will walk through this chapter focusing on the U.S. dollar/British pound ($/BP) exchange rate measured at daily intervals. Movements in the exchange rate are displayed in Figure 9-1. The 1990‚Äì1994 period was fairly typical, covering narrow trading ranges and wide swings. September 1992 was particularly tumultuous. After vain attempts by the Bank of England to support the pound against the German mark, the pound exited the European Monetary System. There were several days with very large moves. On September 17 alone, the pound fell by 6 percent against the mark and also against the dollar. Hence we can expect interesting patterns in volatility. In particular, the question is whether this structural change led to predictable time variation in risk.‚Äù*
[^3]: P√°gina 221: *‚ÄúOver this period, the average daily volatility was 0.694 percent, which translates into 11.02 percent per annum (using a 252-trading-day adjustment). This risk measure, however, surely was not constant over time. In addition, time variation in risk could explain the fact that the empirical distribution of returns does not quite exactly fit a normal distribution. Figure 9-2 compares the normal approximation with the actual empirical distribution of the $/BP exchange rate. Relative to the normal model, the actual distribution contains more observations in the center and in the tails. These fat tails can be explained by two alternative viewpoints. The first view is that the true distribution is stationary and indeed contains fat tails, in which case a normal approximation is clearly inappropriate. The other view is that the distribution does change through time. As a result, in times of turbulence, a stationary model could view large observations as outliers when they are really drawn from a distribution with temporarily greater dispersion. In practice, both explanations carry some truth. This is why fore-casting variation in risk is particularly fruitful for risk management. In‚Äù*
<!-- END -->