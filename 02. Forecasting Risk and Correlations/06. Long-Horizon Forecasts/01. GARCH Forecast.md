## Forecasting Risk and Correlations: Long-Horizon GARCH Forecasts

### Introdu√ß√£o
Este cap√≠tulo explora t√©cnicas para prever a varia√ß√£o do risco e das correla√ß√µes, elementos cruciais na gest√£o de risco financeiro e no c√°lculo do Value at Risk (VAR). A capacidade de prever a volatilidade do mercado financeiro tem implica√ß√µes significativas para a gest√£o de risco, pois permite que os investidores ajustem seus portf√≥lios para reduzir a exposi√ß√£o a ativos cuja volatilidade est√° prevista para aumentar [^1]. Como vimos anteriormente, a volatilidade parece se *clusterizar* de maneira previs√≠vel, e os modelos GARCH (Generalized Autoregressive Conditional Heteroskedastic) surgiram como ferramentas fundamentais para capturar essas din√¢micas [^1, 5]. Esta se√ß√£o se aprofunda na aplica√ß√£o de modelos GARCH para previs√µes de longo prazo.

### Conceitos Fundamentais

A modelagem da varia√ß√£o do risco ao longo do tempo √© crucial para a medi√ß√£o do VAR [^21]. Os modelos GARCH oferecem uma abordagem para extrapolar a volatilidade em v√°rios horizontes de tempo de maneira consistente [^9]. Assumindo que o modelo seja estimado usando intervalos di√°rios, a primeira etapa √© decompor o retorno multiperi√≥dico em retornos di√°rios, conforme a Equa√ß√£o (4.27) [^9]:
$r_{t,T} = r_{t,t} + r_{t+1,t+1} + r_{t+2,t+2} + ... + r_{T,T}$
onde $r_{t,T}$ representa o retorno acumulado do per√≠odo $t$ at√© $T$.
Definimos $n$ como o n√∫mero de dias, tal que $n = T - t + 1$ [^9].

> üí° **Exemplo Num√©rico:** Suponha que estamos em $t = \text{1 de Janeiro}$ e queremos calcular o retorno acumulado at√© $T = \text{10 de Janeiro}$. Ent√£o, $n = 10 - 1 + 1 = 10$ dias. O retorno acumulado seria a soma dos retornos di√°rios de 1 de Janeiro at√© 10 de Janeiro.

O objetivo √© obter a previs√£o da vari√¢ncia para um horizonte de $n$ dias. Se os retornos n√£o forem correlacionados entre os dias, a vari√¢ncia de longo prazo, a partir de $t-1$, √© dada por [^10]:
$$E_{t-1}(r_{t,T}^2) = E_{t-1}(r_t^2) + E_{t-1}(r_{t+1}^2) + E_{t-1}(r_{t+2}^2) + \ldots + E_{t-1}(r_T^2)$$
Para determinar a previs√£o GARCH em dois dias, usamos a previs√£o de amanh√£, que √© [^10]:
$$E_{t-1}(r_{t+1}^2) = E_{t-1}(\alpha_0 + \alpha_1 r_t^2 + \beta h_t) = \alpha_0 + \alpha_1 h_t + \beta h_t$$
Isso ocorre porque $E_{t-1}(r_t^2) = h_t$ [^10]. Para o dia seguinte [^10]:
$$E_{t-1}(r_{t+2}^2) = E_{t-1}(\alpha_0 + \alpha_1 r_{t+1}^2 + \beta h_{t+1}) = \alpha_0 + (\alpha_1 + \beta)[\alpha_0 + (\alpha_1 + \beta)h_t]$$
Substituindo $n$ dias no futuro, a previs√£o da vari√¢ncia "forward" em $T$ √© [^10]:
$$E_{t-1}(r_T^2) = \frac{\alpha_0}{1 - (\alpha_1 + \beta)} + \frac{1 - (\alpha_1 + \beta)^{n-1}}{1 - (\alpha_1 + \beta)} (\alpha_1 + \beta)^{n-1} h_t \qquad (9.6)$$
A vari√¢ncia total de agora at√© $T$ √© ent√£o [^10]:
$$E_{t-1}(r_{t,T}^2) = \frac{\alpha_0}{1 - (\alpha_1 + \beta)} \left[ (n-1) - \frac{1 - (\alpha_1 + \beta)^n}{1 - (\alpha_1 + \beta)} \right] + \frac{1 - (\alpha_1 + \beta)^n}{1 - (\alpha_1 + \beta)} h_t \qquad (9.7)$$

> üí° **Exemplo Num√©rico:**
>
> Vamos supor que estimamos um modelo GARCH(1,1) e obtivemos os seguintes par√¢metros: $\alpha_0 = 0.01$, $\alpha_1 = 0.05$, e $\beta = 0.90$. A vari√¢ncia condicional atual √© $h_t = 0.02$. Queremos prever a vari√¢ncia total para um horizonte de $n = 10$ dias.
>
> $\text{Passo 1: Calcular } \alpha_1 + \beta = 0.05 + 0.90 = 0.95$
>
> $\text{Passo 2: Calcular } \frac{\alpha_0}{1 - (\alpha_1 + \beta)} = \frac{0.01}{1 - 0.95} = \frac{0.01}{0.05} = 0.2$
>
> $\text{Passo 3: Calcular } \frac{1 - (\alpha_1 + \beta)^n}{1 - (\alpha_1 + \beta)} = \frac{1 - (0.95)^{10}}{1 - 0.95} = \frac{1 - 0.5987}{0.05} = \frac{0.4013}{0.05} = 8.026$
>
> $\text{Passo 4: Substituir na Equa√ß√£o (9.7):}$
>
> $E_{t-1}(r_{t,T}^2) = 0.2 \left[ (10-1) - 8.026 \right] + 8.026 \cdot 0.02 = 0.2 \left[ 9 - 8.026 \right] + 0.16052 = 0.2 \cdot 0.974 + 0.16052 = 0.1948 + 0.16052 = 0.35532$
>
> Portanto, a previs√£o da vari√¢ncia total para 10 dias √© 0.35532. Isso significa que, com base no modelo GARCH, a volatilidade acumulada durante esses 10 dias √© esperada ser consider√°vel.

**Proposi√ß√£o 1**
A Equa√ß√£o (9.7) pode ser simplificada para:
$$E_{t-1}(r_{t,T}^2) = \frac{(n-1)\alpha_0}{1 - (\alpha_1 + \beta)} - \frac{\alpha_0(1 - (\alpha_1 + \beta)^n)}{(1 - (\alpha_1 + \beta))^2} + \frac{1 - (\alpha_1 + \beta)^n}{1 - (\alpha_1 + \beta)} h_t$$

*Proof:* A Proposi√ß√£o 1 √© uma simples reescrita da equa√ß√£o 9.7, apenas para fins de organiza√ß√£o e clareza.

Esta equa√ß√£o demonstra que a extrapola√ß√£o da vari√¢ncia do dia seguinte para um horizonte mais longo √© uma fun√ß√£o complexa do processo de vari√¢ncia e da condi√ß√£o inicial. Portanto, a regra simples da raiz quadrada do tempo falha devido ao fato de que os retornos n√£o s√£o identicamente distribu√≠dos [^10]. √â interessante notar que, se partirmos de uma posi√ß√£o que seja a m√©dia de longo prazo, ou seja, $h_t = h = \alpha_0/[1 - (\alpha_1 + \beta)]$, essa express√£o se simplifica para [^10]:
$$E_{t-1}(r_{t,T}^2) = hn \qquad (9.8)$$
Aqui, a volatilidade de *n* dias √© a volatilidade de 1 dia multiplicada pela raiz quadrada de *n*. Em outras palavras, a extrapola√ß√£o do VAR usando a raiz quadrada do tempo s√≥ √© v√°lida quando a posi√ß√£o inicial coincide com o valor de longo prazo [^10]. Se a posi√ß√£o inicial for maior que o valor de longo prazo, a regra da raiz quadrada do tempo superestimar√° o risco. Se a posi√ß√£o inicial for menor que o valor de longo prazo, a regra da raiz quadrada do tempo subestimar√° o risco [^10].

> üí° **Exemplo Num√©rico:**
>
> Usando os par√¢metros do exemplo anterior ($\alpha_0 = 0.01$, $\alpha_1 = 0.05$, $\beta = 0.90$), vamos calcular a m√©dia de longo prazo da vari√¢ncia:
>
> $h = \frac{\alpha_0}{1 - (\alpha_1 + \beta)} = \frac{0.01}{1 - (0.05 + 0.90)} = \frac{0.01}{0.05} = 0.2$
>
> Agora, vamos comparar a previs√£o da vari√¢ncia para 10 dias usando a Equa√ß√£o (9.8) (regra da raiz quadrada do tempo) com a previs√£o anterior da Equa√ß√£o (9.7), assumindo que $h_t = h = 0.2$:
>
> $E_{t-1}(r_{t,T}^2) = hn = 0.2 \cdot 10 = 2$
>
> Notice que o valor √© muito diferente do resultado anterior (0.35532), onde $h_t = 0.02$. Isso ilustra a import√¢ncia de considerar a vari√¢ncia condicional atual ($h_t$) ao prever a volatilidade a longo prazo. Se usarmos a regra da raiz quadrada do tempo, estaremos assumindo que a vari√¢ncia atual j√° est√° em seu n√≠vel de longo prazo, o que pode n√£o ser verdade.

Al√©m disso, podemos analisar o comportamento da vari√¢ncia de longo prazo quando $n$ tende ao infinito.

**Teorema 2**
Assumindo que o processo GARCH seja estacion√°rio, ou seja, $\alpha_1 + \beta < 1$, ent√£o a vari√¢ncia esperada de longo prazo converge para um valor finito quando $n$ tende ao infinito. Especificamente,
$$\lim_{n \to \infty} \frac{E_{t-1}(r_{t,T}^2)}{n} = \frac{\alpha_0}{1 - (\alpha_1 + \beta)}$$
*Proof:*
Dividindo a equa√ß√£o (9.7) por $n$, temos:
$$\frac{E_{t-1}(r_{t,T}^2)}{n} = \frac{\alpha_0}{1 - (\alpha_1 + \beta)} \left[ \frac{n-1}{n} - \frac{1 - (\alpha_1 + \beta)^n}{n(1 - (\alpha_1 + \beta))} \right] + \frac{1 - (\alpha_1 + \beta)^n}{n(1 - (\alpha_1 + \beta))} h_t$$
Quando $n \to \infty$ e $\alpha_1 + \beta < 1$, $(\alpha_1 + \beta)^n \to 0$, ent√£o:
$$\lim_{n \to \infty} \frac{E_{t-1}(r_{t,T}^2)}{n} = \frac{\alpha_0}{1 - (\alpha_1 + \beta)} \left[ 1 - 0 \right] + 0 = \frac{\alpha_0}{1 - (\alpha_1 + \beta)}$$
Isto implica que, no longo prazo, a vari√¢ncia cresce linearmente com o horizonte de tempo, e a taxa de crescimento √© dada pela vari√¢ncia incondicional. ‚ñ†

> üí° **Exemplo Num√©rico:**
>
> Usando os mesmos par√¢metros ($\alpha_0 = 0.01$, $\alpha_1 = 0.05$, $\beta = 0.90$), a vari√¢ncia incondicional √©:
>
> $\frac{\alpha_0}{1 - (\alpha_1 + \beta)} = \frac{0.01}{1 - (0.05 + 0.90)} = \frac{0.01}{0.05} = 0.2$
>
> Isso significa que, no longo prazo, a vari√¢ncia esperada por dia converge para 0.2. Se olharmos para um horizonte de tempo muito longo (digamos, 1000 dias), a vari√¢ncia total esperada seria aproximadamente $0.2 \times 1000 = 200$.

A Figura 9-6 [^11] ilustra o efeito de diferentes par√¢metros de persist√™ncia ($\alpha_1 + \beta$) na vari√¢ncia. Partindo do valor de longo prazo para a vari√¢ncia, por exemplo, 0.51, um choque move a vari√¢ncia condicional para o dobro do seu valor, aproximadamente 1.02. Isso representa um choque significativo. Alta persist√™ncia significa que o choque diminuir√° lentamente [^11]. Por exemplo, com persist√™ncia de 0.99, a vari√¢ncia condicional ainda √© 0.93 ap√≥s 20 dias. Com uma persist√™ncia de 0.8, a vari√¢ncia cai muito perto de seu valor de longo prazo ap√≥s apenas 20 dias [^11].
![Este gr√°fico ilustra o efeito de diferentes par√¢metros de persist√™ncia na vari√¢ncia em modelos GARCH](./../images/garch_persistence_variance_effect.jpg)

Em s√©ries financeiras t√≠picas, o GARCH apresenta persist√™ncia em torno de 0.95 a 0.99 para dados di√°rios [^11]. A Figura 9-6 mostra que os choques diminuem rapidamente em horizontes longos, al√©m de 1 m√™s. De fato, poder√≠amos reestimar um processo GARCH amostrado em intervalos mensais, e os coeficientes $\alpha_1$ e $\beta$ seriam muito menores [^11]. Como resultado, se o horizonte de risco for longo, as oscila√ß√µes no VAR devem ser muito menores do que para um horizonte di√°rio. Christoffersen e Diebold (2000) chegam a argumentar que h√° pouca evid√™ncia de previsibilidade da volatilidade em horizontes superiores a 10 dias [^11]. Portanto, h√° pouco sentido em prever a varia√ß√£o temporal da volatilidade em horizontes mais longos [^11].

Dado que a persist√™ncia dos modelos GARCH √© crucial para a previs√£o da volatilidade a longo prazo, podemos investigar como diferentes distribui√ß√µes para os res√≠duos afetam a estimativa desses par√¢metros e, consequentemente, as previs√µes de risco.

**Proposi√ß√£o 3**

A escolha da distribui√ß√£o dos res√≠duos no modelo GARCH (e.g., Normal, t-Student) influencia a estimativa dos par√¢metros $\alpha_0$, $\alpha_1$ e $\beta$, especialmente em amostras finitas. Distribui√ß√µes com caudas mais pesadas, como a t-Student, tendem a gerar estimativas mais robustas para $\alpha_1$ e $\beta$ em presen√ßa de outliers, o que pode afetar a persist√™ncia estimada e, consequentemente, as previs√µes de longo prazo.

*Proof (Estrat√©gia):* A prova desta proposi√ß√£o envolve simula√ß√µes de Monte Carlo. Podemos gerar dados sob diferentes modelos GARCH com diferentes distribui√ß√µes para os res√≠duos (Normal e t-Student). Em seguida, estimamos os par√¢metros do modelo GARCH para cada conjunto de dados simulado e comparamos as estimativas dos par√¢metros $\alpha_0$, $\alpha_1$ e $\beta$. A presen√ßa de outliers √© simulada adicionando valores extremos aleat√≥rios aos dados. A robustez das estimativas pode ser avaliada comparando o vi√©s e a vari√¢ncia das estimativas dos par√¢metros sob as diferentes distribui√ß√µes de res√≠duos e na presen√ßa de outliers.

> üí° **Exemplo Num√©rico:**
>
> Para ilustrar a Proposi√ß√£o 3, vamos simular 1000 retornos usando um modelo GARCH(1,1) com $\alpha_0 = 0.01$, $\alpha_1 = 0.05$, e $\beta = 0.90$. Primeiro, simulamos com res√≠duos Normais e, em seguida, com res√≠duos t-Student (com 5 graus de liberdade). Depois, adicionamos alguns outliers (retornos extremos) aos dados simulados. Finalmente, estimamos os par√¢metros GARCH usando ambos os conjuntos de dados (com e sem outliers) e comparamos os resultados.
>
> ```python
> import numpy as np
> import scipy.stats as st
> from arch import arch_model
>
> # Par√¢metros GARCH
> alpha0 = 0.01
> alpha1 = 0.05
> beta = 0.90
>
> # Tamanho da amostra
> n = 1000
>
> # Fun√ß√£o para simular dados GARCH
> def simulate_garch(alpha0, alpha1, beta, n, distribution='normal', df=5):
>     errors = np.random.normal(0, 1, n) if distribution == 'normal' else st.t.rvs(df, size=n)
>     sigma2 = np.zeros(n)
>     returns = np.zeros(n)
>     sigma2[0] = alpha0 / (1 - alpha1 - beta)  # Inicializar com a vari√¢ncia incondicional
>     returns[0] = np.sqrt(sigma2[0]) * errors[0]
>
>     for t in range(1, n):
>         sigma2[t] = alpha0 + alpha1 * returns[t-1]**2 + beta * sigma2[t-1]
>         returns[t] = np.sqrt(sigma2[t]) * errors[t]
>     return returns
>
> # Simular dados
> returns_normal = simulate_garch(alpha0, alpha1, beta, n, distribution='normal')
> returns_tstudent = simulate_garch(alpha0, alpha1, beta, n, distribution='tstudent')
>
> # Adicionar outliers
> def add_outliers(returns, num_outliers=5, magnitude=5):
>     idx = np.random.choice(len(returns), num_outliers, replace=False)
>     returns[idx] *= magnitude
>     return returns
>
> returns_normal_outliers = add_outliers(returns_normal.copy())
> returns_tstudent_outliers = add_outliers(returns_tstudent.copy())
>
> # Estimar modelos GARCH
> def estimate_garch(returns, distribution='normal'):
>     am = arch_model(returns, vol='GARCH', p=1, o=0, q=1, dist='Normal' if distribution == 'normal' else 't')
>     res = am.fit(disp='off')
>     return res.params
>
> # Estimar par√¢metros
> params_normal = estimate_garch(returns_normal)
> params_tstudent = estimate_garch(returns_tstudent, distribution='tstudent')
> params_normal_outliers = estimate_garch(returns_normal_outliers)
> params_tstudent_outliers = estimate_garch(returns_tstudent_outliers, distribution='tstudent')
>
> # Imprimir resultados
> print("Par√¢metros (Normal):", params_normal)
> print("Par√¢metros (t-Student):", params_tstudent)
> print("Par√¢metros (Normal com Outliers):", params_normal_outliers)
> print("Par√¢metros (t-Student com Outliers):", params_tstudent_outliers)
> ```
>
> Este c√≥digo simula dados GARCH com distribui√ß√µes Normais e t-Student, adiciona outliers e, em seguida, estima os par√¢metros do modelo GARCH. Ao comparar os par√¢metros estimados, voc√™ observar√° que a distribui√ß√£o t-Student produz estimativas mais robustas (menos afetadas) em presen√ßa de outliers, especialmente para os par√¢metros $\alpha_1$ e $\beta$. Isso ocorre porque a distribui√ß√£o t-Student atribui maior probabilidade a valores extremos, tornando o modelo menos sens√≠vel a outliers espec√≠ficos na amostra.

Para dar mais clareza, podemos adicionar alguns passos intermedi√°rios √†s equa√ß√µes GARCH.
Come√ßando com a previs√£o GARCH em dois dias:

$E_{t-1}(r_{t+1}^2) = E_{t-1}(\alpha_0 + \alpha_1 r_t^2 + \beta h_t) = \alpha_0 + \alpha_1 h_t + \beta h_t$

Aqui est√° uma prova disso:

I. O modelo GARCH(1,1) √© definido como:
   $$h_t = \alpha_0 + \alpha_1 r_{t-1}^2 + \beta h_{t-1}$$
   Onde $h_t$ √© a vari√¢ncia condicional no tempo $t$, $r_{t-1}$ √© o retorno no tempo $t-1$, e $\alpha_0$, $\alpha_1$, e $\beta$ s√£o par√¢metros.

II. Para prever a vari√¢ncia no tempo $t+1$ com base nas informa√ß√µes dispon√≠veis no tempo $t-1$, aplicamos o operador de expectativa condicional $E_{t-1}$ √† equa√ß√£o do modelo GARCH(1,1):
   $$E_{t-1}(h_{t+1}) = E_{t-1}(\alpha_0 + \alpha_1 r_t^2 + \beta h_t)$$

III. Assumindo que os par√¢metros $\alpha_0$, $\alpha_1$ e $\beta$ s√£o constantes, eles podem ser retirados da expectativa condicional:
   $$E_{t-1}(h_{t+1}) = \alpha_0 + \alpha_1 E_{t-1}(r_t^2) + \beta E_{t-1}(h_t)$$

IV. Pela defini√ß√£o de vari√¢ncia condicional, $E_{t-1}(r_t^2) = h_t$, e $E_{t-1}(h_t) = h_t$. Substituindo isso na equa√ß√£o acima, temos:
    $$E_{t-1}(h_{t+1}) = \alpha_0 + \alpha_1 h_t + \beta h_t$$
    Portanto, a previs√£o GARCH em um passo (ou um dia) √©:
   $$E_{t-1}(r_{t+1}^2) = \alpha_0 + \alpha_1 h_t + \beta h_t$$ ‚ñ†

Para o dia seguinte:
$$E_{t-1}(r_{t+2}^2) = E_{t-1}(\alpha_0 + \alpha_1 r_{t+1}^2 + \beta h_{t+1}) = \alpha_0 + \alpha_1 E_{t-1}(r_{t+1}^2) + \beta E_{t-1}(h_{t+1})$$

Aqui est√° uma prova disso:

I. Usando a equa√ß√£o GARCH(1,1):
   $$h_{t+2} = \alpha_0 + \alpha_1 r_{t+1}^2 + \beta h_{t+1}$$

II. Condicionando no tempo $t-1$:
   $$E_{t-1}(h_{t+2}) = E_{t-1}(\alpha_0 + \alpha_1 r_{t+1}^2 + \beta h_{t+1})$$

III. Tirando as constantes para fora da expectativa:
    $$E_{t-1}(h_{t+2}) = \alpha_0 + \alpha_1 E_{t-1}(r_{t+1}^2) + \beta E_{t-1}(h_{t+1})$$

IV. Substituindo $E_{t-1}(r_{t+1}^2)$ com $h_{t+1} =  \alpha_0 + \alpha_1 h_t + \beta h_t$ do passo anterior:
    $$E_{t-1}(h_{t+2}) = \alpha_0 + (\alpha_1 + \beta) E_{t-1}(h_{t+1}) = \alpha_0 + (\alpha_1 + \beta)[\alpha_0 + (\alpha_1 + \beta)h_t]$$
    Assim:
    $$E_{t-1}(r_{t+2}^2) = \alpha_0 + (\alpha_1 + \beta)[\alpha_0 + (\alpha_1 + \beta)h_t]$$ ‚ñ†

### Conclus√£o
Esta se√ß√£o detalhou a aplica√ß√£o dos modelos GARCH para previs√µes de longo prazo, demonstrando a import√¢ncia de considerar a persist√™ncia da volatilidade e suas implica√ß√µes para a precis√£o das previs√µes de VAR. Ao analisar o impacto de diferentes par√¢metros de persist√™ncia e as limita√ß√µes da regra da raiz quadrada do tempo, podemos entender melhor as nuances da modelagem da volatilidade em diferentes horizontes temporais. Em √∫ltima an√°lise, a escolha do modelo e dos par√¢metros deve ser guiada pelas caracter√≠sticas espec√≠ficas dos dados e pelos objetivos da an√°lise de risco.

### Refer√™ncias
[^1]: Chapter 9: Forecasting Risk and Correlations, p. 219.
[^5]: Chapter 9: Forecasting Risk and Correlations, p. 223.
[^9]: Chapter 9: Forecasting Risk and Correlations, p. 227.
[^10]: Chapter 9: Forecasting Risk and Correlations, p. 228.
[^11]: Chapter 9: Forecasting Risk and Correlations, p. 229.
[^21]: Chapter 9: Forecasting Risk and Correlations, p. 240.
<!-- END -->